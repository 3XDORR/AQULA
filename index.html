<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AQULA Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/@okxweb3/coin-ethereum@latest/dist/index.umd.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
      :root {
        --background: 222.2 84% 4.9%;
        --foreground: 210 40% 98%;
        --card: 222.2 84% 4.9%;
        --card-foreground: 210 40% 98%;
        --border: 217.2 32.6% 17.5%;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        overflow-x: hidden;
        overflow-y: hidden;
        background: linear-gradient(to bottom right, #000000, #1e293b);
        color: #f1f5f9;
        overscroll-behavior: none;
      }
      body {
        display: flex;
        flex-direction: column;
        min-height: 100vh;
        font-family: system-ui, sans-serif;
      }
      .sidebar {
        width: 310px;
        height: calc(100vh - 4rem);
        position: fixed;
        top: 4rem;
        left: 0;
        overflow-y: auto;
        padding: 1rem;
        background: rgba(15, 23, 42, 0.8);
        border-right: 1px solid rgba(51, 65, 85, 0.5);
      }
      .main-content {
        margin-left: 310px;
        padding: 1.5rem;
        height: calc(100vh - 4rem);
        margin-top: 0;
        overflow-y: auto;
        background: transparent;
      }
      .card {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid rgba(51, 65, 85, 0.5);
        border-radius: 0.5rem;
        transition: transform 0.2s, box-shadow 0.2s;
      }
      .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }
      .flip-card {
        perspective: 1000px;
      }
      .flip-card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s;
        transform-style: preserve-3d;
      }
      .flip-card-front,
      .flip-card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        backface-visibility: hidden;
        border-radius: 0.5rem;
      }
      .flip-card-back {
        transform: rotateY(180deg);
        background: rgba(15, 23, 42, 0.95);
      }
      .trophy {
        filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.5));
      }
      button {
        border-radius: 0.375rem;
        transition: background-color 0.2s, transform 0.1s;
      }
      button:hover {
        transform: translateY(-1px);
      }
      .nav-active {
        background: rgba(30, 41, 59, 0.5);
        color: #22d3ee !important;
      }
      .animate-spin-slow {
        animation: spin-slow 3s linear infinite;
      }
      .animate-spin-slower {
        animation: spin-slower 6s linear infinite;
      }
      @keyframes spin-slow {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }
      @keyframes spin-slower {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(-360deg);
        }
      }
      #authModal {
        display: flex; /* Show by default */
      }
      
      #loadingOverlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        z-index: 100;
        transition: opacity 0.3s;
      }
      #loadingOverlay.hidden {
        opacity: 0;
        pointer-events: none;
      }
      .page {
        transition: opacity 0.3s, transform 0.3s;
      }
      .page-hidden {
        opacity: 0;
        transform: translateY(20px);
        display: none;
      }
      .content-hidden {
        display: none; /* Hide all content initially */
      }
      @media (max-width: 768px) {
        .sidebar {
          width: 200px;
          transform: translateX(-100%);
          transition: transform 0.3s;
        }
        .sidebar.open {
          transform: translateX(0);
        }
        .main-content {
          margin-left: 0;
          padding: 1rem;
        }
      }
      html,
      body {
        scrollbar-width: none;
        -ms-overflow-style: none;
      }
      body::-webkit-scrollbar,
      .sidebar::-webkit-scrollbar,
      .main-content::-webkit-scrollbar {
        display: none;
      }
      .chat-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .chat-messages {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }
      .chat-message {
        display: flex;
        flex-direction: column;
        max-width: 80%;
        padding: 0.75rem;
        border-radius: 0.5rem;
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(51, 65, 85, 0.5);
      }
      .chat-message.mine {
        align-self: flex-end;
        background: rgba(34, 211, 238, 0.2);
        border-color: rgba(34, 211, 238, 0.5);
      }
      .chat-message .avatar {
        width: 1.5rem;
        height: 1.5rem;
        border-radius: 50%;
        background: rgba(34, 211, 238, 0.5);
        color: #fff;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.75rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      .chat-message .content {
        font-size: 0.875rem;
        color: #e2e8f0;
      }
      .chat-message .meta {
        font-size: 0.75rem;
        color: #94a3b8;
        margin-top: 0.25rem;
      }
      .chat-input {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .toast {
  position: fixed;
  top: 5rem;
  right: 1rem;
  z-index: 9999;
  padding: 1rem;
  border-radius: 0.5rem;
  color: white;
  background-color: rgba(0, 0, 0, 0.8);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  pointer-events: none;
}
      .flip-card:hover .flip-card-inner {
        transform: rotateY(180deg);
      }
      .flip-card-front {
        background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.9) 100%);
        border: 1px solid rgba(71, 85, 105, 0.3);
      }
      .flip-card-back {
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(2, 6, 23, 0.95) 100%);
        transform: rotateY(180deg);
        border: 1px solid rgba(100, 116, 139, 0.2);
      }
      .card {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .card:hover {
        transform: translateY(-6px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      }
      .badge {
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        line-height: 1rem;
        font-weight: 500;
        display: inline-block;
      }
      .chat-input-container {
        @apply flex space-x-3 mt-6 items-center;
      }
      textarea::-webkit-scrollbar {
        width: 6px;
      }
      textarea::-webkit-scrollbar-track {
        @apply bg-slate-800/30 rounded-full;
      }
      textarea::-webkit-scrollbar-thumb {
        @apply bg-slate-600/50 rounded-full hover:bg-slate-500/60;
      }
      .mining-ripple {
        position: absolute;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.7);
        transform: scale(0);
        animation: mining-ripple 600ms linear;
        pointer-events: none;
        width: 100px;
        height: 100px;
        margin-top: -50px;
        margin-left: -50px;
      }
      @keyframes mining-ripple {
        to {
          transform: scale(4);
          opacity: 0;
        }
      }
      #toggleMiningBtn {
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }
      #toggleMiningBtn.starting {
        box-shadow: 0 0 15px rgba(46, 204, 113, 0.6);
        background: linear-gradient(135deg, #2ecc71, #27ae60);
      }
      #toggleMiningBtn.stopping {
        box-shadow: 0 0 15px rgba(231, 76, 60, 0.6);
        background: linear-gradient(135deg, #e74c3c, #c0392b);
      }
      #toggleMiningBtn.mining-active {
        animation: mining-pulse 2s infinite;
        box-shadow: 0 0 20px rgba(52, 152, 219

, 0.8);
      }
      @keyframes mining-pulse {
        0% { box-shadow: 0 0 10px rgba(52, 152, 219, 0.8); }
        50% { box-shadow: 0 0 20px rgba(52, 152, 219, 1); }
        100% { box-shadow: 0 0 10px rgba(52, 152, 219, 0.8); }
      }

      .input-error {
    @apply border-red-500/80 bg-red-900/10 ring-1 ring-red-500/30;
}

.input-error + .error-message {
    @apply block text-red-400 text-xs mt-1;
}

@keyframes shake {
    0% { transform: translateX(0); }
    20% { transform: translateX(-5px); }
    40% { transform: translateX(5px); }
    60% { transform: translateX(-5px); }
    80% { transform: translateX(5px); }
    100% { transform: translateX(0); }
}

.shake {
    animation: shake 0.5s ease-in-out;
}

.error-message {
    color: red;
    font-size: 12px; /* Ukuran lebih kecil */
    margin-top: 4px;
}

.error-text {
    display: flex;
    align-items: center;
    gap: 5px;
}

.input-error {
    border-color: red !important;
}

.shake {
    animation: shake 0.5s;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    20%, 60% { transform: translateX(-5px); }
    40%, 80% { transform: translateX(5px); }
}
/* Voice Message Styles */
.voice-message-container {
    margin-top: 8px;
    max-width: 280px;
}

.voice-message {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background-color: #f0f2f5;
    border-radius: 8px;
}

.voice-message.mine {
    background-color: #d9fdd3;
}

.play-pause-btn {
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 24px;
    height: 24px;
    color: #3b4a54;
}

.waveform-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.waveform {
    height: 4px;
    background-color: rgba(11, 20, 26, 0.15);
    border-radius: 2px;
    overflow: hidden;
    position: relative;
}

.progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background-color: #3b4a54;
    border-radius: 2px;
    transition: width 0.1s linear;
}

.duration {
    font-size: 11px;
    color: #3b4a54;
    align-self: flex-start;
}

.status {
    font-size: 14px;
    color: #8696a0;
    margin-left: 4px;
}
* Styling untuk daftar saran autocompletion */
#mentionSuggestions {
    z-index: 10;
}

.suggestion-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px;
    transition: background-color 0.2s;
}

.suggestion-item:hover {
    background: #F3F4F6 !important;
}

.suggestion-item .avatar {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.875rem;
}

/* Responsivitas */
@media (max-width: 640px) {
    .chat-message {
        max-width: 85%;
    }
    .voice-message-container {
        max-width: 100%;
    }
    #mentionSuggestions {
        max-width: 100%;
    }
}
p {
      margin: 0 0 10px 0;
      text-align: justify;
    }
    strong {
      font-weight: bold;
    }
    
    </style>
  </head>
  <body class="dark relative">
    <canvas
      id="particleCanvas"
      class="absolute inset-0 w-full h-full opacity-30 pointer-events-none content-hidden"
    ></canvas>


    
    <header class="w-full bg-slate-900/80 backdrop-blur-md border-b border-slate-800 p-4 z-10 fixed top-0" style="height: 4rem; padding: 0 1rem;">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <img src="AQLALOG.png" alt="A Icon" class="h-12 w-12 object-contain" />
          <span class="text-2xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">
            AQULA
          </span>
        </div>
        <div class="flex items-center space-x-6">
          <div class="hidden md:flex items-center space-x-1 bg-slate-800/50 rounded-full px-3 py-1.5 border border-slate-700/50 backdrop-blur-sm">
            <i data-lucide="search" class="h-4 w-4 text-slate-400"></i>
            <input
              type="text"
              placeholder="Search systems..."
              class="bg-transparent border-none focus:outline-none text-sm w-40 placeholder:text-slate-500"
            />
          </div>
          <div class="flex items-center space-x-3">
            <div class="relative">
              <button class="text-slate-400 hover:text-slate-100 p-2" title="Notifications" aria-label="View notifications">
                <i data-lucide="bell" class="h-5 w-5"></i>
                <span class="absolute -top-1 -right-1 h-2 w-2 bg-cyan-500 rounded-full animate-pulse"></span>
              </button>
            </div>
            <button
              title="Toggle theme"
              id="themeToggle"
              class="text-slate-400 hover:text-slate-100 p-2"
            >
              <i data-lucide="moon" class="h-5 w-5"></i>
            </button>
            <div id="userSection" class="flex items-center space-x-2">
              <button
                id="loginBtn"
                class="text-slate-100 bg-cyan-600 hover:bg-cyan-700 rounded-md px-3 py-1.5 flex items-center"
              >
                <i data-lucide="user" class="h-4 w-4 mr-2"></i> Login
              </button>
            </div>
          </div>
        </div>
      </div>
    </header>
    
    <div class="flex flex-1 overflow-hidden pt-16 bg-transparent content-hidden">
      <div class="sidebar">
        <!-- Sidebar content remains unchanged -->
      </div>
      <main class="main-content">
        <!-- Main content remains unchanged -->
      </main>
    </div>

    <div id="loadingOverlay" class="flex items-center justify-center hidden">
      <div class="flex flex-col items-center">
        <div class="relative w-24 h-24">
          <div
            class="absolute inset-0 border-4 border-cyan-500/30 rounded-full animate-ping"
          ></div>
          <div
            class="absolute inset-2 border-4 border-t-cyan-500 border-r-transparent border-b-transparent border-l-transparent rounded-full animate-spin"
          ></div>
          <div
            class="absolute inset-4 border-4 border-r-purple-500 border-t-transparent border-b-transparent border-l-transparent rounded-full animate-spin-slow"
          ></div>
          <div
            class="absolute inset-6 border-4 border-b-blue-500 border-t-transparent border-r-transparent border-l-transparent rounded-full animate-spin-slower"
          ></div>
          <div
            class="absolute inset-8 border-4 border-l-green-500 border-t-transparent border-r-transparent border-b-transparent rounded-full animate-spin"
          ></div>
        </div>
        <div class="mt-4 text-cyan-500 font-mono text-sm tracking-wider">
          SYSTEM INITIALIZING
        </div>
      </div>
    </div>

    <div id="authModal"
    class="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 overflow-y-auto py-8">
    <div
      class="bg-gradient-to-br from-slate-900 via-slate-800/80 to-slate-900 border border-slate-700/30 rounded-xl p-8 w-full max-w-md shadow-2xl shadow-cyan-500/10 transform transition-all duration-300 scale-95">
      <div class="flex justify-between items-center mb-8">
        <div>
          <h2
            class="text-2xl font-bold text-slate-100 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24"
              stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
            </svg>
            <span class="bg-gradient-to-r from-cyan-400 to-cyan-600 bg-clip-text text-transparent">Welcome Back</span>
          </h2>
          <p class="text-xs text-slate-500 mt-1">Access your premium dashboard</p>
        </div>
        <button id="closeAuthModal" class="text-slate-400 hover:text-slate-200 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      <div class="space-y-6">
        <!-- LOGIN FORM -->
        <div id="loginForm">
          <div class="space-y-5">
            <!-- Email Input -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Email Address</label>
              <div class="relative">
                <input id="emailInput" type="email"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="you@example.com" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>
            </div>
  
            <!-- Password Input -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Password</label>
              <div class="relative">
                <input id="passwordInput" type="password"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="••••••••" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <!-- Tombol Mata dengan data-target -->
                <button class="absolute right-3 top-3 text-slate-500 hover:text-slate-300 transition-colors show-password" data-target="passwordInput">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
              <div class="flex justify-end mt-2">
                <button class="text-xs text-cyan-400 hover:text-cyan-300 transition-colors">Forgot password?</button>
              </div>
            </div>
  
            <!-- Submit Button -->
            <button id="emailAuthBtn"
              class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-500 hover:to-cyan-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center group">
              <span class="group-hover:translate-x-1 transition-transform">Continue</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </div>
        </div>
  
        <!-- REGISTER FORM -->
        <div id="registerForm" class="hidden">
          <div class="space-y-5">
  
            <!-- Full Name -->
            <div id="fullNameGroup">
              <label class="block text-sm font-medium text-slate-400 mb-2">Full Name</label>
              <div class="relative">
                <input id="fullNameInput" type="text"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="John Doe" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
              </div>
            </div>
  
            <!-- Email -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Email Address</label>
              <div class="relative">
                <input id="regEmailInput" type="email"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="you@example.com" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
              </div>
            </div>
  
            <!-- Password -->
            <div>
              <label class="block text-sm font-medium text-slate-400 mb-2">Password</label>
              <div class="relative">
                <input id="regPasswordInput" type="password"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="••••••••" />
                <div class="error-message hidden"></div>
                <div
                  class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
                <!-- Tombol Mata dengan data-target -->
                <button class="absolute right-3 top-3 text-slate-500 hover:text-slate-300 transition-colors show-password" data-target="regPasswordInput">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                </button>
              </div>
            </div>
  
            <!-- Referral Code -->
            <div id="referralCodeGroup">
              <label class="block text-sm font-medium text-slate-400 mb-2">Referral Code
                <span class="text-slate-500 text-xs">(optional)</span></label>
              <div class="relative">
                <input id="referralInput" type="text"
                  class="w-full bg-slate-800/50 border border-slate-700/30 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500 placeholder-slate-500/70 pl-10 transition-all"
                  placeholder="ABCD1234" />
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none"
                    viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                  </svg>
                </div>
              </div>
            </div>
  
            <!-- Register Button -->
            <button id="registerBtn"
              class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-500 hover:to-cyan-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center group">
              <span class="group-hover:translate-x-1 transition-transform">Create Account</span>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 opacity-0 group-hover:opacity-100 transition-opacity"
                fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </button>
          </div>
        </div>
  
        <!-- Divider -->
        <div class="relative">
          <div class="absolute inset-0 flex items-center">
            <div class="w-full border-t border-slate-700/30"></div>
          </div>
          <div class="relative flex justify-center text-sm">
            <span class="px-2 bg-slate-900 text-slate-400">Or continue with</span>
          </div>
        </div>
  
        <!-- Social Auth Buttons -->
        <div class="grid grid-cols-2 gap-3">
          <button id="googleAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://www.google.com/favicon.ico" alt="Google" class="h-4 w-4" />
            <span>Google</span>
          </button>
          <button id="metamaskAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://metamask.io/favicon.ico" alt="MetaMask" class="h-4 w-4" />
            <span>MetaMask</span>
          </button>
          <button id="phantomAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://mate.tools/s/dGOqmKUm" alt="Phantom" class="h-4 w-4" />
            <span>Phantom</span>
          </button>
          <button id="okxAuthBtn"
            class="flex items-center justify-center space-x-2 border border-slate-700/30 bg-slate-800/30 hover:bg-slate-700/20 rounded-lg py-2.5 px-4 text-sm font-medium transition-colors hover:border-slate-600/50">
            <img src="https://mate.tools/s/WNjPYxYj" alt="OKX" class="h-4 w-4" />
            <span>OKX</span>
          </button>
        </div>
  
        <!-- Toggle Auth -->
        <div class="text-center text-sm text-slate-400">
          <button id="toggleAuthBtn"
            class="text-cyan-400 hover:text-cyan-300 font-medium transition-colors">
            Need an account? <span class="underline">Register here</span>
          </button>
        </div>
      </div>
    </div>
  </div>
    <div
      id="deleteAccountModal"
      class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden"
    >
      <div
        class="bg-slate-900 text-slate-100 border border-slate-700 rounded-lg p-6 w-full max-w-md card"
      >
        <h2 class="text-xl font-bold mb-4">Confirm Account Deletion</h2>
        <p class="text-sm text-slate-400 mb-6">
          Are you sure you want to delete your account? This action cannot be
          undone.
        </p>
        <div class="flex justify-end space-x-4">
          <button
            id="cancelDeleteBtn"
            class="px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-md"
          >
            No
          </button>
          <button
            id="confirmDeleteBtn"
            class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-md"
          >
            Yes
          </button>
        </div>
      </div>
    </div>
    </div>
    
    <div class="sidebar">
      <div class="bg-slate-900/50 border border-slate-700/50 rounded-xl p-5 h-full card">
        <div id="userProfile" class="mb-6 p-4 bg-gradient-to-br from-slate-800/60 to-slate-800/30 rounded-xl border border-slate-700/50 shadow-lg">
          <div class="flex items-start space-x-3 mb-4">
            <div id="sidebarProfilePicture" class="h-12 w-12 rounded-full bg-gradient-to-br from-cyan-600 to-blue-600 text-white flex items-center justify-center font-medium flex-shrink-0">
              <span id="profileInitial" class="text-lg">U</span>
            </div>
            <div class="min-w-0">
              <div id="userEmail" class="text-sm font-medium text-slate-100 truncate max-w-[180px] hover:max-w-none transition-all duration-200"></div>
              <div id="userWallet" class="text-xs text-slate-300/80 truncate max-w-[180px] hover:max-w-none transition-all duration-200 mt-1"></div>
            </div>
          </div>
          <div class="space-y-3 pt-2 border-t border-slate-700/40">
            <div class="flex justify-between items-center text-xs">
              <span class="text-slate-300/80">Points</span>
              <span id="userPoints" class="font-medium text-cyan-400 bg-cyan-400/10 px-2 py-0.5 rounded-full">0</span>
            </div>
            <div class="flex justify-between items-center text-xs">
              <span class="text-slate-300/80">Device Score</span>
              <span id="deviceScore" class="font-medium text-emerald-400 bg-emerald-400/10 px-2 py-0.5 rounded-full">0</span>
            </div>
            <div class="flex justify-between items-center text-xs">
              <span class="text-slate-300/80">Booster</span>
              <span id="userBooster" class="font-medium text-purple-400 bg-purple-400/10 px-2 py-0.5 rounded-full">None</span>
            </div>
          </div>
        </div>
        <nav class="space-y-1.5">
          <button
            id="navDashboard"
            class="w-full flex items-center text-cyan-400 bg-gradient-to-r from-cyan-900/30 to-cyan-900/10 rounded-lg px-4 py-2.5 nav-active transition-all duration-200 hover:bg-cyan-900/20 group"
          >
            <i data-lucide="command" class="h-4 w-4 mr-3 text-cyan-300 group-hover:text-cyan-200"></i> 
            <span class="font-medium">Dashboard</span>
          </button>
          
          <button
            id="navBooster"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="activity" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Booster</span>
          </button>
          
          <button
            id="navDataCenter"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="database" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Data Center</span>
            <span class="ml-auto text-[10px] bg-blue-400/20 text-blue-300 px-2 py-0.5 rounded-full border border-blue-400/30">Soon</span>
          </button>
        
          <button
            id="navNetwork"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="globe" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Network</span>
            <span class="ml-auto text-[10px] bg-blue-400/20 text-blue-300 px-2 py-0.5 rounded-full border border-blue-400/30">Soon</span>
          </button>
        
          <button
            id="navSecurity"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="shield" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Security</span>
          </button>
          
          <button
            id="navLeaderboard"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="trophy" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Leaderboard</span>
          </button>
          
          <button
            id="navCommunications"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="message-square" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i>
            <span class="font-medium">Communications</span>
          </button>
          
          <button
            id="navSettings"
            class="w-full flex items-center text-slate-300 hover:text-white rounded-lg px-4 py-2.5 transition-all duration-200 hover:bg-slate-800/50 group"
          >
            <i data-lucide="settings" class="h-4 w-4 mr-3 text-slate-400 group-hover:text-slate-200"></i> 
            <span class="font-medium">Settings</span>
          </button>
        </nav>

        
       
     

    
        
<div class="mt-auto pt-6">
  <div class="text-xs text-slate-400/80 mb-3 font-medium tracking-wider">AQULA VISUALIZATION</div>
  <div id="particleContainer" class="w-full h-20 relative rounded-xl overflow-hidden bg-gradient-to-br from-slate-900/80 to-slate-800/80 border border-slate-700/40 shadow-lg">
    <!-- 3D Particle Animation will render here -->
  </div>
</div>
</div>
</div>
</div>
</div>



<div class="main-content">
  <div id="pageDashboard" class="page">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left Column (2/3 width) -->
      <div class="col-span-2 space-y-6">
        <!-- Mining Controls Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">MINING CONTROLS</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-5">
              <!-- Mining Status -->
              <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                  <span class="text-sm font-medium text-slate-300">Mining Status</span>
                </div>
                <span id="miningStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-gradient-to-r from-red-900/40 to-red-800/30 text-red-400 border border-red-700/50">
                  <span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span>
                  Inactive
                </span>
              </div>
              <!-- Current Points -->
              <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="text-sm font-medium text-slate-300">Current Points</span>
                </div>
                <div id="currentPoints" class="text-sm font-bold text-cyan-400 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                  0
                </div>
              </div>
              <!-- Device Score -->
              <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                  </svg>
                  <span class="text-sm font-medium text-slate-300">Device Score</span>
                </div>
                <div id="currentDeviceScore" class="text-sm font-bold text-cyan-400 flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                  </svg>
                  0
                </div>
              </div>
              <!-- Booster -->
             <!-- Booster -->
  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z" />
      </svg>
      <span class="text-sm font-medium text-slate-300">Booster</span>
    </div>
    <div id="currentBooster" class="text-sm font-medium text-amber-400 bg-gradient-to-r from-amber-900/30 to-amber-800/20 px-3 py-1 rounded-full border border-amber-700/50">
      None
    </div>
  </div>
  <!-- Referral Speed -->
  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all mt-2">
    <div class="flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <span class="text-sm font-medium text-slate-300">Referral Speed</span>
    </div>
    <div id="referralSpeed" class="text-sm font-medium text-cyan-400 bg-gradient-to-r from-cyan-900/30 to-cyan-800/20 px-3 py-1 rounded-full border border-cyan-700/50">
      0x
    </div>
  </div>
  <!-- Mining Button -->
  <button id="toggleMiningBtn" class="w-full bg-gradient-to-r from-cyan-600/90 to-cyan-700 hover:from-cyan-500/90 hover:to-cyan-600/90 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/30 flex items-center justify-center group">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 group-hover:animate-pulse" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
    </svg>
    Start Mining
    <span class="ml-2 text-xs opacity-70 group-hover:opacity-100">(CTRL+M)</span>
  </button>
</div>
</div>
</div>

        <!-- System Overview Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                </svg>
                <h3 class="text-lg font-semibold text-slate-100 tracking-wide">SYSTEM OVERVIEW</h3>
              </div>
              <div class="flex items-center space-x-2">
                <span class="bg-gradient-to-r from-cyan-600/20 to-blue-600/20 text-cyan-400 border border-cyan-500/50 rounded-md px-2 py-1 text-xs flex items-center">
                  <span class="h-1.5 w-1.5 rounded-full bg-cyan-500 mr-1 animate-pulse"></span>
                  LIVE MONITORING
                </span>
                <button class="text-slate-400 hover:text-cyan-400 p-2 transition-colors" title="Refresh System Status">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <!-- CPU Usage -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-cyan-500/30 p-5 relative overflow-hidden">
                <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-cyan-500/10"></div>
                <div class="flex items-center justify-between mb-4">
                  <div class="text-sm text-slate-400 font-medium">CPU USAGE</div>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
                  </svg>
                </div>
                <div id="cpuUsage" class="text-3xl font-bold mb-1 text-slate-100 flex items-end">
                  --<span class="text-lg text-slate-400 ml-1">%</span>
                </div>
                <div class="text-xs text-slate-500 font-mono">3.8 GHz | 12 Cores</div>
                <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                  <div class="cpu-bar h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full" style="width: 0%"></div>
                </div>
              </div>
              <!-- Memory Usage -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-purple-500/30 p-5 relative overflow-hidden">
                <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-purple-500/10"></div>
                <div class="flex items-center justify-between mb-4">
                  <div class="text-sm text-slate-400 font-medium">MEMORY</div>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
                  </svg>
                </div>
                <div id="memoryUsage" class="text-3xl font-bold mb-1 text-slate-100 flex items-end">
                  --<span class="text-lg text-slate-400 ml-1">%</span>
                </div>
                <div class="text-xs text-slate-500 font-mono">-- GB / -- GB</div>
                <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                  <div class="memory-bar h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: 0%"></div>
                </div>
              </div>
              <!-- Network Usage -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-xl border border-blue-500/30 p-5 relative overflow-hidden">
                <div class="absolute -right-6 -top-6 h-16 w-16 rounded-full bg-blue-500/10"></div>
                <div class="flex items-center justify-between mb-4">
                  <div class="text-sm text-slate-400 font-medium">NETWORK</div>
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-500/70" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0" />
                  </svg>
                </div>
                <div id="networkUsage" class="text-3xl font-bold mb-1 text-slate-100 flex items-end">
                  --<span class="text-lg text-slate-400 ml-1">%</span>
                </div>
                <div class="text-xs text-slate-500 font-mono">-- GB/s | -- ms</div>
                <div class="mt-4 h-1.5 bg-slate-700/50 rounded-full overflow-hidden">
                  <div class="network-bar h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full" style="width: 0%"></div>
                </div>
              </div>
            </div>
            <!-- Performance Chart Tabs -->
            <div class="mt-8">
              <div class="flex items-center justify-between mb-4">
                <!-- Tab Buttons -->
                <div class="flex space-x-1 bg-slate-800/50*50 p-1 rounded-lg border border-slate-700/50">
                  <button id="tabPerformance">Performance</button>
                  <button id="tabProcesses">Processes</button>
                  <button id="tabStorage">Storage</button>
                </div>
                <!-- Legend -->
                <div class="flex items-center space-x-3 text-xs text-slate-400">
                  <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-cyan-500 mr-1.5"></div>CPU</div>
                  <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-purple-500 mr-1.5"></div>Memory</div>
                  <div class="flex items-center"><div class="h-2 w-2 rounded-full bg-blue-500 mr-1.5"></div>Network</div>
                </div>
              </div>
              <!-- Performance Chart -->
              <div id="performanceTab" class="h-72 bg-gradient-to-br from-slate-800/30 to-slate-900/40 rounded-xl border border-slate-700/50 overflow-hidden relative">
                <div class="absolute inset-0 bg-[url('data:image/svg+xml;base64,...')] opacity-20"></div>
                <div class="h-full w-full flex items-end justify-between px-4 pt-4 pb-8 relative">
                  <!-- Y-Axis Labels -->
                  <div class="absolute left-3 top-0 h-full flex flex-col justify-between py-4">
                    <div class="text-xs text-slate-500/80">100%</div>
                    <div class="text-xs text-slate-500/80">75%</div>
                    <div class="text-xs text-slate-500/80">50%</div>
                    <div class="text-xs text-slate-500/80">25%</div>
                    <div class="text-xs text-slate-500/80">0%</div>
                  </div>
                  <!-- Horizontal Lines -->
                  <div class="absolute left-0 right-0 top-0 h-full flex flex-col justify-between py-4 px-10">
                    <div class="border-b border-slate-700/30 w-full"></div>
                    <div class="border-b border-slate-700/30 w-full"></div>
                    <div class="border-b border-slate-700/30 w-full"></div>
                    <div class="border-b border-slate-700/30 w-full"></div>
                    <div class="border-b border-slate-700/30 w-full"></div>
                  </div>
                  <!-- Chart Container -->
                  <div id="performanceChart" class="flex-1 h-full flex items-end justify-between px-2 z-10"></div>
                  <!-- Waktu X-Axis -->
                  <div class="absolute bottom-0 left-0 right-0 flex justify-between px-10">
                    <div class="text-xs text-slate-500/80">00:00</div>
                    <div class="text-xs text-slate-500/80">06:00</div>
                    <div class="text-xs text-slate-500/80">12:00</div>
                    <div class="text-xs text-slate-500/80">18:00</div>
                    <div class="text-xs text-slate-500/80">24:00</div>
                  </div>
                  <!-- System Load Display -->
                  <div class="absolute bottom-4 right-4 bg-slate-900/80 backdrop-blur-sm rounded-lg px-3 py-2 border border-slate-700/50 shadow-lg">
                    <div class="text-xs text-slate-400 uppercase tracking-wider">System Load</div>
                    <div id="systemLoad" class="text-xl font-mono text-cyan-400">42<span class="text-sm">%</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Security Status Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">SECURITY STATUS</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- Firewall -->
              <div id="firewallStatus" class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Firewall</div>
                <span id="firewallBadge" class="bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs">Active</span>
              </div>
              <!-- Intrusion Detection -->
              <div id="intrusionStatus" class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Intrusion Detection</div>
                <span id="intrusionBadge" class="bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs">Active</span>
              </div>
              <!-- Encryption -->
              <div id="encryptionStatus" class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Encryption</div>
                <span id="encryptionBadge" class="bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs">Active</span>
              </div>
              <!-- Threat Database -->
              <div class="flex items-center justify-between py-2 px-3 bg-slate-800/30 rounded-lg border border-slate-700/50 hover:border-green-500/30 transition-all">
                <div class="text-sm text-slate-300">Threat Database</div>
                <div id="threatDbTime" class="text-sm text-cyan-400">
                  Updated <span class="text-slate-500">12 min ago</span>
                </div>
              </div>
              <!-- Security Level -->
              <div class="pt-2 mt-2 border-t border-slate-700/50">
                <div class="flex items-center justify-between mb-2">
                  <div class="text-sm font-medium text-slate-300">Security Level</div>
                  <div id="securityLevelText" class="text-sm text-cyan-400">75%</div>
                </div>
                <div class="h-2 bg-slate-700 rounded-full overflow-hidden">
                  <div id="securityLevelBar" class="h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full" style="width: 75%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- System Alerts Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">SYSTEM ALERTS</h3>
            </div>
          </div>
          <div id="systemAlertsContainer" class="p-6 space-y-3">
            <!-- Alert akan ditambahkan di sini -->
          </div>
          <div id="systemAlertsContainer" class="p-6 space-y-3"></div>
<div id="alertPaginationContainer" class="mt-4 flex justify-center items-center space-x-2"></div>
        </div>


        <!-- Premium AI Communications Log -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="absolute -top-1 -right-1">
              <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-cyan-500 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-cyan-600"></span>
              </span>
            </div>
            <div class="flex items-center justify-between">
              <div class="flex items-center space-x-3">
                <div class="p-2 bg-cyan-600/20 rounded-lg border border-cyan-500/30 shadow-sm">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                  </svg>
                </div>
                <div>
                  <h3 class="text-lg font-semibold text-slate-100 tracking-tight">AI Communications</h3>
                  <p class="text-xs text-slate-400 flex items-center mt-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
                    </svg>
                    Secure connection • Real-time updates
                  </p>
                </div>
              </div>
              <span class="bg-gradient-to-r from-cyan-900/30 to-blue-800/30 text-cyan-400 border border-cyan-700/50 rounded-lg px-3 py-1.5 text-xs font-medium flex items-center shadow-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                </svg>
                <span id="new-messages">0 New Messages</span>
              </span>
            </div>
          </div>
          <div class="p-6 max-h-96 overflow-y-auto" id="log-container">
            <div class="space-y-4" id="log-messages">
              <div class="flex items-start">
                <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                  </svg>
                </div>
                <div class="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-sm text-slate-300">
                  <div class="font-medium text-cyan-400 mb-1 flex items-center">
                    AI Assistant
                    <span class="ml-2 text-xs px-2 py-0.5 bg-slate-700/50 rounded-full text-slate-400">System</span>
                  </div>
                  <p>Welcome to your secure AI communication channel. How may I assist you today?</p>
                  <div class="text-xs text-slate-500 mt-2 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Just now
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="p-4 border-t border-slate-700/60 bg-gradient-to-b from-slate-800/70 to-slate-900/90">
            <div class="flex items-center space-x-3">
              <button id="attach-file-btn" class="p-2 rounded-lg bg-slate-800/50 border border-slate-700/50 hover:bg-slate-700/50 transition-all text-slate-400 hover:text-slate-300" title="Attach File">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                </svg>
              </button>
              <input type="file" id="file-input" accept="image/*" class="hidden" />
              <input
                type="text"
                id="message-input"
                placeholder="Type your message..."
                class="flex-1 bg-slate-800/50 border border-slate-700/50 rounded-xl px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/30 focus:border-cyan-500/50 transition-all placeholder-slate-500 text-slate-300"
              />
              <button
                id="send-button"
                class="bg-gradient-to-r from-cyan-600 to-blue-700 hover:from-cyan-500 hover:to-blue-600 rounded-xl p-3 transition-all shadow-md hover:shadow-cyan-500/20 flex items-center justify-center"
                title="Send Message"
                aria-label="Send Message"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </button>
            </div>
            <div class="flex items-center justify | between mt-3 px-1">
              <div id="template-panel" class="flex items-center space-x-4 hidden">
                <button class="text-xs text-slate-500 hover:text-slate-400 transition-all" data-template="What are the main features of Aqula mining?">Features</button>
                <button class="text-xs text-slate-500 hover:text-slate-400 transition-all" data-template="How does Aqula mining work?">How it works</button>
                <button class="text-xs text-slate-500 hover:text-slate-400 transition-all" data-template="What is the future vision of Aqula?">Future vision</button>
              </div>
              <div class="text-xs text-slate-500 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                </svg>
                End-to-end encrypted
              </div>
            </div>
            <button id="toggle-templates" class="text-xs text-slate-500 hover:text-slate-400 flex items-center mt-2 transition-all">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Show Templates
            </button>
          </div>
        </div>
      </div>

      <!-- Right Column (1/3 width) -->
      <div class="space-y-6">
        <!-- System Time Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="bg-gradient-to-br from-slate-800 to-slate-900/90 p-6 border-b border-slate-700/50">
            <div class="text-center">
              <div class="text-xs text-slate-500 mb-1 font-mono tracking-wider">SYSTEM TIME</div>
              <div id="systemTime" class="text-4xl font-mono text-cyan-400 mb-1 tracking-tighter">
                00:00:00
              </div>
              <div id="systemDate" class="text-sm text-slate-400 font-medium">
                Jan 1, 2025
              </div>
            </div>
          </div>
          <div class="p-5">
            <div class="grid grid-cols-2 gap-3">
              <!-- UPTIME -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-lg p-3 border border-slate-700/50">
                <div class="text-xs text-slate-500 mb-1 font-mono">UPTIME</div>
                <div id="uptime" class="text-sm font-mono text-slate-200">
                  00d 00:00:00
                </div>
              </div>
              <!-- TIME ZONE -->
              <div class="bg-gradient-to-br from-slate-800/50 to-slate-900/50 rounded-lg p-3 border border-slate-700/50">
                <div class="text-xs text-slate-500 mb-1 font-mono">TIME ZONE</div>
                <div id="timezone" class="text-sm font-mono text-slate-200">
                  UTC+00:00
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Premium Quick Actions Dashboard -->
        <div class="card bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl overflow-hidden border border-slate-700/40 shadow-2xl backdrop-blur-sm">
          <div class="p-5 border-b border-slate-700/40 bg-gradient-to-r from-slate-800/90 to-slate-900/90 relative overflow-hidden">
            <div class="absolute inset-0 opacity-10 [background-image:linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] [background-size:24px_24px]"></div>
            <div class="flex items-center relative z-10">
              <div class="p-1.5 bg-cyan-500/10 rounded-lg border border-cyan-500/20 mr-3 backdrop-blur-sm">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide flex-1">QUICK ACTIONS</h3>
              <div class="h-1.5 w-8 bg-gradient-to-r from-cyan-500/70 to-blue-500/70 rounded-full"></div>
            </div>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-2 gap-3">
              <!-- Security Scan Button -->
              <button id="btnSecurityScan" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Security Scan</span>
              </button>
              <!-- View Log Button -->
              <button id="btnViewLog" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">View Scan Log</span>
              </button>
              <!-- Sync Data Button -->
              <button id="btnSyncData" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Sync Data</span>
              </button>
              <!-- Backup Button -->
              <button id="btnBackup" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Backup</span>
              </button>
              <!-- Console Button -->
              <button id="btnConsole" class="relative overflow-hidden border border-slate-700/40 bg-gradient-to-br from-slate-800/70 to-slate-900/70 hover:from-slate-700/60 hover:to-slate-800/60 rounded-xl py-4 px-2 flex flex-col items-center space-y-2 transition-all duration-300 group hover:shadow-lg hover:shadow-cyan-500/10">
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_center,var(--tw-gradient-stops))] from-cyan-500/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                <div class="p-2.5 bg-gradient-to-br from-cyan-500/15 to-cyan-600/15 rounded-lg border border-cyan-500/30 group-hover:border-cyan-400/50 group-hover:bg-cyan-500/20 transition-all duration-300 relative z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.75">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                  </svg>
                </div>
                <span class="text-xs font-medium text-slate-300 group-hover:text-cyan-400 transition-colors duration-300 relative z-10">Console</span>
              </button>
            </div>
            <!-- Scan Log Section -->
            <div class="mt-6">
              <div class="flex items-center justify-between mb-3">
                <h4 class="text-xs font-medium text-slate-400/90 uppercase tracking-wider">SCAN RESULT LOG</h4>
                <div class="flex space-x-2">
                  <button class="text-xs text-slate-500 hover:text-cyan-400 transition-colors duration-200">Clear</button>
                  <button class="text-xs text-slate-500 hover:text-cyan-400 transition-colors duration-200">Export</button>
                </div>
              </div>
              <div id="scanResultLog" class="bg-slate-900/60 border border-slate-700/30 rounded-lg p-4 h-48 overflow-y-auto font-mono text-xs text-slate-300 space-y-2 backdrop-blur-sm">
                <div class="text-slate-500">> Checking file permissions...</div>
              </div>
            </div>
            <!-- Progress Bar -->
            <div id="scanProgressContainer" class="mt-4 hidden">
              <div class="flex items-center justify-between text-xs text-slate-400 mb-1.5">
                <span>Scan Progress</span>
                <span id="scanProgressText">0%</span>
              </div>
              <div class="w-full bg-slate-800/60 rounded-full h-1.5 overflow-hidden">
                <div id="scanProgressBar" class="h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full transition-all duration-500 ease-out" style="width: 0%">
                  <div class="absolute inset-0 bg-white/20 animate-pulse"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Resource Allocation Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">RESOURCE ALLOCATION</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- Processing Power -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <div class="text-sm text-slate-400">Processing Power</div>
                  <div id="procPercent" class="text-xs text-cyan-400">42% allocated</div>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div id="procBar" class="h-full bg-gradient-to-r from-cyan-500 to-blue-500 rounded-full w-[42%]"></div>
                </div>
              </div>
              <!-- Memory Allocation -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <div class="text-sm text-slate-400">Memory Allocation</div>
                  <div id="memPercent" class="text-xs text-purple-400">68% allocated</div>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div id="memBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: 68%"></div>
                </div>
              </div>
              <!-- Network Bandwidth -->
              <div>
                <div class="flex items-center justify-between mb-1">
                  <div class="text-sm text-slate-400">Network Bandwidth</div>
                  <div id="netPercent" class="text-xs text-blue-400">35% allocated</div>
                </div>
                <div class="h-2 bg-slate-800 rounded-full overflow-hidden">
                  <div id="netBar" class="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full w-[35%]"></div>
                </div>
              </div>
              <!-- Priority Level -->
              <div class="pt-3 border-t border-slate-700/50">
                <div class="flex items-center justify-between text-sm">
                  <div class="text-slate-400">Priority Level</div>
                  <div class="flex items-center">
                    <input id="prioritySlider"
                      type="range"
                      min="1"
                      max="5"
                      value="3"
                      class="w-24 mr-2 accent-cyan-500"
                    />
                    <span id="priorityValue" class="text-cyan-400 font-mono">3/5</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Environment Controls Card -->
        <div class="card bg-gradient-to-br from-slate-800/70 to-slate-900/70 rounded-xl overflow-hidden border border-slate-700/50 shadow-xl">
          <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 to-slate-900/80">
            <div class="flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-cyan-400 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <!-- Icon (Placeholder, as original was empty) -->
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
              </svg>
              <h3 class="text-lg font-semibold text-slate-100 tracking-wide">ENVIRONMENT CONTROLS</h3>
            </div>
          </div>
          <div class="p-6">
            <div class="space-y-4">
              <!-- Power Management -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
                  </svg>
                  <span class="text-sm text-slate-300">Power Management</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input id="powerManagementToggle" type="checkbox" class="sr-only peer">
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
              <!-- Security Protocol -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                  <span class="text-sm text-slate-300">Security Protocol</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <label for="securityProtocolToggle" class="sr-only">Security Protocol Toggle</label>
                  <input 
                    id="securityProtocolToggle" 
                    type="checkbox" 
                    class="sr-only peer" 
                    checked
                    aria-label="Toggle security protocol"
                    title="Enable or disable security protocol"
                  >
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
              <!-- Power Saving Mode -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  <span class="text-sm text-slate-300">Power Saving Mode</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input id="powerSavingModeToggle" type="checkbox" class="sr-only peer">
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
              <!-- Auto Shutdown -->
              <div class="flex items-center justify-between p-3 bg-gradient-to-r from-slate-800/50 to-slate-900/40 rounded-lg border border-slate-700/50 hover:border-cyan-500/30 transition-all">
                <div class="flex items-center">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                  </svg>
                  <span class="text-sm text-slate-300">Auto Shutdown</span>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                  <input id="autoShutdownToggle" type="checkbox" class="sr-only peer" checked>
                  <div class="w-9 h-5 bg-slate-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-cyan-600"></div>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


    <div id="pageBooster" class="page page-hidden">
      <div class="mb-8">
        <h2 class="text-2xl font-bold text-slate-100 mb-2 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 mr-3 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.933 12.8a1 1 0 000-1.6L6.6 7.2A1 1 0 005 8v8a1 1 0 001.6.8l5.333-4zM19.933 12.8a1 1 0 000-1.6l-5.333-4A1 1 0 0013 8v8a1 1 0 001.6.8l5.333-4z" />
          </svg>
          Performance Boosters
        </h2>
        <p class="text-slate-400">Upgrade your mining experience with powerful boosters</p>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Elite Booster -->
        <div class="flip-card card group">
          <div class="flip-card-inner">
            <div class="flip-card-front p-6 flex flex-col">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <div class="flex items-center gap-2">
                    <i data-lucide="zap" class="h-5 w-5 text-cyan-400"></i>
                    <h3 class="text-xl font-bold text-cyan-400">Elite Booster</h3>
                  </div>
                  <div class="badge bg-cyan-900/40 text-cyan-400 border-cyan-400/30 mt-1">Popular</div>
                </div>
                <div class="text-3xl font-bold text-slate-100 font-mono">3x</div>
              </div>
              <div class="flex-1 space-y-4">
                <div class="flex items-center text-slate-300">
                  <i data-lucide="clock" class="h-4 w-4 mr-2 text-cyan-400"></i>
                  <span class="text-sm">30-day validity</span>
                </div>
                <div class="flex items-center text-slate-300">
                  <i data-lucide="bar-chart-2" class="h-4 w-4 mr-2 text-cyan-400"></i>
                  <span class="text-sm">Triple mining speed</span>
                </div>
              </div>
              <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs text-slate-400">Price</span>
                  <span class="text-lg font-bold text-slate-100">0.0001 ETH</span>
                </div>
                <button class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 purchase-btn" data-booster="elite" data-price="0.0001">
                  <i data-lucide="shopping-cart" class="h-4 w-4"></i>
                  Purchase Now
                </button>
              </div>
            </div>
            <div class="flip-card-back p-6 flex flex-col">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="zap" class="h-5 w-5 text-cyan-400"></i>
                <h4 class="text-lg font-bold text-cyan-400">Elite Benefits</h4>
              </div>
              <ul class="space-y-3 flex-1">
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Triple your mining speed with advanced algorithms</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">30-day full access to premium features</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Priority customer support 24/7</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Daily bonus rewards</span>
                </li>
              </ul>
              <div class="mt-6">
                <button class="w-full bg-gradient-to-r from-cyan-600 to-cyan-700 hover:from-cyan-700 hover:to-cyan-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-cyan-500/20 hover:shadow-cyan-500/30 purchase-btn" data-booster="elite" data-price="0.0001">
                  <i data-lucide="credit-card" class="h-4 w-4"></i>
                  Buy Now
                </button>
                <p class="text-xs text-center text-slate-500 mt-2">Boost your mining with Elite power!</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Epic Booster -->
        <div class="flip-card card group">
          <div class="flip-card-inner">
            <div class="flip-card-front p-6 flex flex-col">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <div class="flex items-center gap-2">
                    <i data-lucide="sparkles" class="h-5 w-5 text-purple-400"></i>
                    <h3 class="text-xl font-bold text-purple-400">Epic Booster</h3>
                  </div>
                  <div class="badge bg-purple-900/40 text-purple-400 border-purple-400/30 mt-1">Best Value</div>
                </div>
                <div class="text-3xl font-bold text-slate-100 font-mono">5x</div>
              </div>
              <div class="flex-1 space-y-4">
                <div class="flex items-center text-slate-300">
                  <i data-lucide="clock" class="h-4 w-4 mr-2 text-purple-400"></i>
                  <span class="text-sm">45-day validity</span>
                </div>
                <div class="flex items-center text-slate-300">
                  <i data-lucide="bar-chart-2" class="h-4 w-4 mr-2 text-purple-400"></i>
                  <span class="text-sm">5x mining speed</span>
                </div>
              </div>
              <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs text-slate-400">Price</span>
                  <span class="text-lg font-bold text-slate-100">0.0003 ETH</span>
                </div>
                <button class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-purple-500/20 hover:shadow-purple-500/30 purchase-btn" data-booster="epic" data-price="0.0003">
                  <i data-lucide="shopping-cart" class="h-4 w-4"></i>
                  Purchase Now
                </button>
              </div>
            </div>
            <div class="flip-card-back p-6 flex flex-col">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="sparkles" class="h-5 w-5 text-purple-400"></i>
                <h4 class="text-lg font-bold text-purple-400">Epic Benefits</h4>
              </div>
              <ul class="space-y-3 flex-1">
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">5x mining speed with optimized performance</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">45-day premium access period</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Enhanced analytics dashboard</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Weekly bonus rewards</span>
                </li>
              </ul>
              <div class="mt-6">
                <button class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-purple-500/20 hover:shadow-purple-500/30 purchase-btn" data-booster="epic" data-price="0.0003">
                  <i data-lucide="credit-card" class="h-4 w-4"></i>
                  Buy Now
                </button>
                <p class="text-xs text-center text-slate-500 mt-2">Unleash epic mining performance!</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Pro Booster -->
        <div class="flip-card card group">
          <div class="flip-card-inner">
            <div class="flip-card-front p-6 flex flex-col">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <div class="flex items-center gap-2">
                    <i data-lucide="crown" class="h-5 w-5 text-blue-400"></i>
                    <h3 class="text-xl font-bold text-blue-400">Pro Booster</h3>
                  </div>
                  <div class="badge bg-blue-900/40 text-blue-400 border-blue-400/30 mt-1">Advanced</div>
                </div>
                <div class="text-3xl font-bold text-slate-100 font-mono">10x</div>
              </div>
              <div class="flex-1 space-y-4">
                <div class="flex items-center text-slate-300">
                  <i data-lucide="clock" class="h-4 w-4 mr-2 text-blue-400"></i>
                  <span class="text-sm">60-day validity</span>
                </div>
                <div class="flex items-center text-slate-300">
                  <i data-lucide="bar-chart-2" class="h-4 w-4 mr-2 text-blue-400"></i>
                  <span class="text-sm">10x mining speed</span>
                </div>
              </div>
              <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs text-slate-400">Price</span>
                  <span class="text-lg font-bold text-slate-100">0.009 ETH</span>
                </div>
                <button class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 purchase-btn" data-booster="pro" data-price="0.009">
                  <i data-lucide="shopping-cart" class="h-4 w-4"></i>
                  Purchase Now
                </button>
              </div>
            </div>
            <div class="flip-card-back p-6 flex flex-col">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="crown" class="h-5 w-5 text-blue-400"></i>
                <h4 class="text-lg font-bold text-blue-400">Pro Benefits</h4>
              </div>
              <ul class="space-y-3 flex-1">
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">10x mining speed with professional tools</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">60-day extended premium access</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Premium support & advanced insights</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Exclusive Pro mining pools</span>
                </li>
              </ul>
              <div class="mt-6">
                <button class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-blue-500/20 hover:shadow-blue-500/30 purchase-btn" data-booster="pro" data-price="0.009">
                  <i data-lucide="credit-card" class="h-4 w-4"></i>
                  Buy Now
                </button>
                <p class="text-xs text-center text-slate-500 mt-2">Go pro with unmatched mining speed!</p>
              </div>
            </div>
          </div>
        </div>
        <!-- Diamond Booster -->
        <div class="flip-card card group">
          <div class="flip-card-inner">
            <div class="flip-card-front p-6 flex flex-col">
              <div class="flex justify-between items-start mb-4">
                <div>
                  <div class="flex items-center gap-2">
                    <i data-lucide="gem" class="h-5 w-5 text-amber-400"></i>
                    <h3 class="text-xl font-bold text-amber-400">Diamond Booster</h3>
                  </div>
                  <div class="badge bg-amber-900/40 text-amber-400 border-amber-400/30 mt-1">VIP</div>
                </div>
                <div class="text-3xl font-bold text-slate-100 font-mono">15x</div>
              </div>
              <div class="flex-1 space-y-4">
                <div class="flex items-center text-slate-300">
                  <i data-lucide="clock" class="h-4 w-4 mr-2 text-amber-400"></i>
                  <span class="text-sm">90-day validity</span>
                </div>
                <div class="flex items-center text-slate-300">
                  <i data-lucide="bar-chart-2" class="h-4 w-4 mr-2 text-amber-400"></i>
                  <span class="text-sm">15x mining speed</span>
                </div>
              </div>
              <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                  <span class="text-xs text-slate-400">Price</span>
                  <span class="text-lg font-bold text-slate-100">0.01 ETH</span>
                </div>
                <button class="w-full bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-amber-500/20 hover:shadow-amber-500/30 purchase-btn" data-booster="diamond" data-price="0.01">
                  <i data-lucide="shopping-cart" class="h-4 w-4"></i>
                  Purchase Now
                </button>
              </div>
            </div>
            <div class="flip-card-back p-6 flex flex-col">
              <div class="flex items-center gap-2 mb-4">
                <i data-lucide="gem" class="h-5 w-5 text-amber-400"></i>
                <h4 class="text-lg font-bold text-amber-400">Diamond Benefits</h4>
              </div>
              <ul class="space-y-3 flex-1">
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">15x ultimate mining speed performance</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">90-day VIP access period</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">VIP features & exclusive rewards</span>
                </li>
                <li class="flex items-start">
                  <i data-lucide="check-circle" class="h-4 w-4 mt-1 mr-2 text-green-400 flex-shrink-0"></i>
                  <span class="text-sm text-slate-300">Personal account manager</span>
                </li>
              </ul>
              <div class="mt-6">
                <button class="w-full bg-gradient-to-r from-amber-600 to-amber-700 hover:from-amber-700 hover:to-amber-800 text-white rounded-lg py-3 px-4 flex items-center justify-center gap-2 transition-all duration-300 shadow-lg shadow-amber-500/20 hover:shadow-amber-500/30 purchase-btn" data-booster="diamond" data-price="0.01">
                  <i data-lucide="credit-card" class="h-4 w-4"></i>
                  Buy Now
                </button>
                <p class="text-xs text-center text-slate-500 mt-2">Shine bright with diamond-tier mining!</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
       
    
    
   

<div id="pageLeaderboard" class="page page-hidden">
  <div class="card max-w-9xl mx-auto">
    <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-800 to-slate-900">
      <h3 class="text-2xl font-bold text-slate-100 flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
        </svg>
        <span class="bg-gradient-to-r from-amber-400 to-amber-600 bg-clip-text text-transparent">Top Miners</span>
      </h3>
      <p class="text-sm text-slate-400 mt-1">The most productive miners this week</p>
    </div>
    
    <div class="p-6">
      <div class="grid grid-cols-12 text-xs font-medium text-slate-400 border-b border-slate-700/30 py-3">
        <div class="col-span-1 text-center">Rank</div>
        <div class="col-span-1"></div>
        <div class="col-span-5">User</div>
        <div class="col-span-2">Booster</div>
        <div class="col-span-3 text-right">Points</div>
      </div>
      
      <div id="leaderboardList" class="divide-y divide-slate-700/30"></div>
    </div>
  </div>
</div>
      <div id="pageSecurity" class="page page-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="col-span-2 space-y-6">
            <div class="card border border-slate-700/50 rounded-xl overflow-hidden">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800 to-slate-900/50">
                <div class="flex items-center">
                  <i data-lucide="shield" class="h-6 w-6 text-green-400 mr-3"></i>
                  <h3 class="text-lg font-semibold text-slate-100">Device Security Monitoring</h3>
                </div>
              </div>
              <div class="p-6">
                <div class="space-y-5">
                  <!-- User Agent -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="monitor" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">User Agent</span>
                    </div>
                    <span id="userAgent" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- DevTools Status -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="code" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">DevTools Status</span>
                    </div>
                    <span id="devtoolsStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-900/30 text-red-400 border border-red-700/50">
                      <span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span>
                      Closed
                    </span>
                  </div>
                  <!-- Device Fingerprint -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="fingerprint" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Device Fingerprint</span>
                    </div>
                    <span id="deviceFingerprint" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- IP Address -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="globe" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">IP Address</span>
                    </div>
                    <span id="ipAddress" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Location -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="map-pin" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Location</span>
                    </div>
                    <span id="locationInfo" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Scan Button -->
                  <button id="runSecurityScanBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-green-500/20 flex items-center justify-center">
                    <i data-lucide="refresh-cw" class="h-5 w-5 mr-2"></i>
                    Run Security Scan
                  </button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="p-4 border-b border-slate-700/50">
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <i data-lucide="activity" class="h-5 w-5 text-green-500 mr-2"></i>
                    <h3 class="text-slate-100">Security Log</h3>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span
                      class="bg-slate-800/50 text-green-400 border border-green-500/50 rounded-md px-2 py-1 text-xs flex items-center"
                    >
                      <span
                        class="h-1.5 w-1.5 rounded-full bg-green-500 mr-1 animate-pulse"
                      ></span>
                      LIVE
                    </span>
                    <button class="text-slate-400 p-2">
                      <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <div id="securityLog" class="space-y-3">
                  <!-- Logs will be populated dynamically -->
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-6">
            <div class="card">
              <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-slate-100">Security Actions</h3>
                  <i data-lucide="info" class="h-5 w-5 text-slate-400"></i>
                </div>
                <div class="space-y-3">
                  <button
                    id="clearSecurityLogBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="trash" class="h-4 w-4 mr-2"></i>
                    Clear Security Logs
                  </button>
                  <button
                    id="configureAlertsBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="bell" class="h-4 w-4 mr-2"></i>
                    Configure Alerts
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div> 
      

      <div id="pageCommunications" class="page">
        <!-- Premium Communication Card -->
        <div class="card bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl overflow-hidden border border-slate-700/40 shadow-2xl backdrop-blur-sm">
            <!-- Card Header with Glow Effect -->
            <div class="p-5 border-b border-slate-700/40 bg-gradient-to-r from-slate-800/90 to-slate-900/90 relative overflow-hidden">
                <!-- Subtle grid pattern background -->
                <div class="absolute inset-0 opacity-10 [background-image:linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] [background-size:24px_24px]"></div>
                <!-- Animated gradient border effect -->
                <div class="absolute inset-0 border-t border-transparent bg-[length:300%_300%] bg-gradient-to-r from-transparent via-cyan-500/20 to-transparent animate-gradient-border"></div>
                
                <div class="flex items-center justify-between relative z-10">
                    <div class="flex items-center">
                        <div class="p-1.5 bg-cyan-500/10 rounded-lg border border-cyan-500/20 mr-3 backdrop-blur-sm shadow-sm">
                            <i data-lucide="messages-square" class="h-5 w-5 text-cyan-400"></i>
                        </div>
                        <div>
                            <h2 class="text-lg font-semibold text-slate-100 tracking-wide flex items-center">
                                <span>Global Communications</span>
                                <span class="ml-2 px-2 py-0.5 text-xs font-medium bg-cyan-500/10 text-cyan-400 rounded-full border border-cyan-500/20">PRO</span>
                            </h2>
                            <p class="text-xs text-slate-400 mt-0.5 flex items-center">
                                <i data-lucide="users" class="h-3 w-3 mr-1"></i>
                                <span>24 active participants</span>
                            </p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="voiceCallBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-emerald-500/30 transition-all duration-300 group tooltip" data-tooltip="Start voice call">
                            <i data-lucide="phone" class="h-4 w-4 text-slate-400 group-hover:text-emerald-400"></i>
                        </button>
                        <button id="videoCallBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-purple-500/30 transition-all duration-300 group tooltip" data-tooltip="Start video call">
                            <i data-lucide="video" class="h-4 w-4 text-slate-400 group-hover:text-purple-400"></i>
                        </button>
                        <button id="refreshChatBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-cyan-500/30 transition-all duration-300 group tooltip" data-tooltip="Refresh messages">
                            <i data-lucide="refresh-cw" class="h-4 w-4 text-slate-400 group-hover:text-cyan-400 group-hover:rotate-180 transition-all duration-500"></i>
                        </button>
                    </div>
                </div>
            </div>
    
            <!-- Card Body -->
            <div class="p-6">
                <!-- Status Bar -->
                <div class="flex items-center justify-between mb-4 text-xs">
                    <div class="flex items-center text-slate-400">
                        <i data-lucide="shield-check" class="h-3 w-3 mr-1 text-emerald-400"></i>
                        <span>End-to-end encrypted</span>
                    </div>
                    <div class="flex items-center space-x-3">
                        <span class="flex items-center text-slate-400">
                            <i data-lucide="wifi" class="h-3 w-3 mr-1 text-blue-400"></i>
                            <span>Connected</span>
                        </span>
                        <span class="flex items-center text-slate-400">
                            <i data-lucide="clock" class="h-3 w-3 mr-1 text-amber-400"></i>
                            <span id="connectionLatency">27ms</span>
                        </span>
                    </div>
                </div>
    
                <!-- Admin Messages -->
                <div id="adminMessages" class="admin-messages-container bg-slate-900/60 border border-slate-700/30 rounded-xl p-4 max-h-[200px] overflow-y-auto mb-4 backdrop-blur-sm shadow-inner shadow-slate-900/50">
                    <!-- Admin message example -->
                    <div class="flex mb-3 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-amber-500/20 to-amber-600/20 border border-amber-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="shield-alert" class="h-4 w-4 text-amber-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-amber-400 mr-2">System Alert</div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span>2 min ago</span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                                Scheduled maintenance tonight at 2:00 AM UTC. Expected downtime: 15 minutes.
                            </div>
                        </div>
                    </div>
                    
                    <!-- Admin message example 2 -->
                    <div class="flex mb-3 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="megaphone" class="h-4 w-4 text-blue-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-blue-400 mr-2">Announcement</div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span>Today, 10:15 AM</span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                                Welcome to our new communication platform! Please read the pinned guidelines.
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Chat Messages -->
                <div id="chatMessages" class="chat-messages bg-slate-900/60 border border-slate-700/30 rounded-xl p-4 max-h-[400px] overflow-y-auto backdrop-blur-sm shadow-inner shadow-slate-900/50">
                    <!-- Date separator -->
                    <div class="flex items-center my-4">
                        <div class="flex-1 border-t border-slate-700/40"></div>
                        <span class="px-3 text-xs text-slate-500 bg-slate-900/50 rounded-full border border-slate-700/30">Today</span>
                        <div class="flex-1 border-t border-slate-700/40"></div>
                    </div>
    
                    <!-- Example chat message 1 -->
                    <div class="flex mb-4 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-blue-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-blue-400 mr-2">John_Doe</div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span>10:42 AM</span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                                Has everyone reviewed the new project specifications? We need feedback by EOD.
                            </div>
                            <div class="flex items-center mt-2 space-x-3">
                                <button class="text-xs text-slate-400 hover:text-cyan-400 flex items-center">
                                    <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                                    <span>Like</span>
                                </button>
                                <button class="text-xs text-slate-400 hover:text-amber-400 flex items-center">
                                    <i data-lucide="message-square" class="h-3 w-3 mr-1"></i>
                                    <span>Reply</span>
                                </button>
                                <button class="text-xs text-slate-400 hover:text-rose-400 flex items-center">
                                    <i data-lucide="flag" class="h-3 w-3 mr-1"></i>
                                    <span>Report</span>
                                </button>
                            </div>
                        </div>
                    </div>
    
                    <!-- Example chat message 2 (user) -->
                    <div class="flex mb-4 last:mb-0 flex-row-reverse">
                        <div class="flex-shrink-0 ml-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-cyan-500/20 to-cyan-600/20 border border-cyan-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-cyan-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0 text-right">
                            <div class="flex items-baseline mb-1 justify-end">
                                <div class="text-xs text-slate-500 flex items-center mr-2">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span>10:45 AM</span>
                                </div>
                                <div class="text-xs font-medium text-cyan-400">You</div>
                            </div>
                            <div class="text-sm text-slate-300 bg-gradient-to-r from-cyan-600/20 to-blue-600/20 rounded-lg p-3 border border-cyan-500/30 inline-block">
                                I've reviewed them and have some suggestions. Will share shortly.
                            </div>
                            <div class="flex items-center mt-2 space-x-3 justify-end">
                                <span class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="check" class="h-3 w-3 mr-1 text-emerald-400"></i>
                                    <span>Delivered</span>
                                </span>
                            </div>
                        </div>
                    </div>
    
                    <!-- Example chat message 3 -->
                    <div class="flex mb-4 last:mb-0">
                        <div class="flex-shrink-0 mr-3">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-purple-400"></i>
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline mb-1">
                                <div class="text-xs font-medium text-purple-400 mr-2">Sarah_Design</div>
                                <div class="text-xs text-slate-500 flex items-center">
                                    <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                                    <span>10:48 AM</span>
                                </div>
                            </div>
                            <div class="text-sm text-slate-300 bg-slate-800/50 rounded-lg p-3 border border-slate-700/30">
                                <div class="mb-2">I've attached the updated mockups:</div>
                                <div class="grid grid-cols-2 gap-2">
                                    <div class="bg-slate-800/70 border border-slate-700/40 rounded-lg overflow-hidden cursor-pointer hover:border-cyan-500/40 transition-all duration-200">
                                        <img src="https://via.placeholder.com/300x200/1e293b/64748b?text=Design+1" alt="Design mockup" class="w-full h-auto">
                                        <div class="p-2 text-xs text-slate-400 truncate">homepage-mockup-v2.jpg</div>
                                    </div>
                                    <div class="bg-slate-800/70 border border-slate-700/40 rounded-lg overflow-hidden cursor-pointer hover:border-cyan-500/40 transition-all duration-200">
                                        <img src="https://via.placeholder.com/300x200/1e293b/64748b?text=Design+2" alt="Design mockup" class="w-full h-auto">
                                        <div class="p-2 text-xs text-slate-400 truncate">dashboard-mockup-v2.jpg</div>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center mt-2 space-x-3">
                                <button class="text-xs text-slate-400 hover:text-cyan-400 flex items-center">
                                    <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                                    <span>Like</span>
                                </button>
                                <button class="text-xs text-slate-400 hover:text-amber-400 flex items-center">
                                    <i data-lucide="message-square" class="h-3 w-3 mr-1"></i>
                                    <span>Reply</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
    
                <!-- Typing Indicator -->
                <div id="typingIndicator" class="typing-indicator hidden text-xs text-slate-400 mt-2 flex items-center">
                    <div class="typing-dots flex space-x-1 mr-2">
                        <div class="h-2 w-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 0ms"></div>
                        <div class="h-2 w-2 bg-slate-500 rounded-full animate-bounce delay-150"></div>
                        <div class="h-2 w-2 bg-slate-500 rounded-full animate-bounce" style="animation-delay: 300ms"></div>
                    </div>
                    <span>Sarah_Design is typing...</span>
                </div>
    
                <!-- Chat Input Container -->
                <div id="chatInputContainer" class="relative flex items-center space-x-2 mt-4">
                    <button id="emojiPickerBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-amber-500/30 transition-all duration-300 tooltip" data-tooltip="Emoji">
                        <i data-lucide="smile" class="h-4 w-4 text-slate-400 hover:text-amber-400"></i>
                    </button>
                    <textarea id="chatInput" class="flex-1 p-3 border rounded-lg bg-slate-800/50 border-slate-700/30 text-slate-100 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500/30 transition-all duration-200 resize-none" placeholder="Type your message..." rows="1"></textarea>
                    <div class="flex items-center space-x-1">
                        <button id="uploadImageButton" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-cyan-500/30 transition-all duration-300 tooltip" data-tooltip="Attach file">
                            <i data-lucide="paperclip" class="h-4 w-4 text-slate-400 hover:text-cyan-400"></i>
                        </button>
                        <input type="file" id="imageInput" class="hidden" accept="image/*">
                        <button id="recordVoiceBtn" class="p-2 bg-slate-800/40 hover:bg-slate-700/60 rounded-lg border border-slate-700/30 hover:border-rose-500/30 transition-all duration-300 tooltip" data-tooltip="Voice message">
                            <i data-lucide="mic" class="h-4 w-4 text-slate-400 hover:text-rose-400"></i>
                        </button>
                        <button id="sendMessageBtn" class="p-2 bg-cyan-600/90 hover:bg-cyan-500 rounded-lg border border-cyan-600/80 hover:border-cyan-400/80 transition-all duration-300 shadow-sm shadow-cyan-500/20 tooltip" data-tooltip="Send message">
                            <i data-lucide="send" class="h-4 w-4 text-white"></i>
                        </button>
                    </div>
                    <div id="mentionSuggestions" class="hidden absolute bottom-12 w-full bg-slate-800/90 border border-slate-700/30 rounded-lg shadow-lg max-h-40 overflow-y-auto backdrop-blur-sm z-10"></div>
                </div>
            </div>
    
            <!-- Online Users Panel -->
            <div class="border-t border-slate-700/40 p-3 bg-slate-900/50">
                <div class="flex items-center justify-between text-xs text-slate-400 mb-2">
                    <div class="flex items-center">
                        <i data-lucide="users" class="h-3 w-3 mr-1"></i>
                        <span>Online (5)</span>
                    </div>
                    <button id="expandUsersBtn" class="text-cyan-400 hover:text-cyan-300 transition-colors">
                        <i data-lucide="chevron-down" class="h-3 w-3"></i>
                    </button>
                </div>
                <div id="onlineUsersList" class="flex space-x-2 overflow-x-auto pb-1">
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-blue-500/20 to-blue-600/20 border border-blue-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-blue-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">John</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-purple-500/20 to-purple-600/20 border border-purple-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-purple-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">Sarah</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-amber-500/20 to-amber-600/20 border border-amber-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-amber-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">Mike</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-emerald-500/20 to-emerald-600/20 border border-emerald-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-emerald-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-emerald-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">Lisa</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <div class="relative">
                            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-rose-500/20 to-rose-600/20 border border-rose-500/30 flex items-center justify-center shadow-sm">
                                <i data-lucide="user" class="h-4 w-4 text-rose-400"></i>
                            </div>
                            <div class="absolute bottom-0 right-0 h-2 w-2 bg-amber-500 rounded-full border border-slate-900"></div>
                        </div>
                        <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">Alex</span>
                    </div>
          
    
        <!-- Toast Notifications -->
        <div id="toastContainer" class="fixed bottom-6 right-6 flex flex-col-reverse pointer-events-none z-50 space-y-3 w-80"></div>
    </div>
    </div>
    
    <!-- Hidden File Input -->
    <input type="file" id="imageInput" accept="image/*" class="hidden" />
  </div>
</div>


    
    <style>
        @keyframes gradient-border {
            0% { background-position: 0% 50%; }
            100% { background-position: 100% 50%; }
        }
        
        .animate-gradient-border {
            animation: gradient-border 3s ease infinite alternate;
        }
        
        .tooltip {
            position: relative;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(15, 23, 42, 0.9);
            color: #e2e8f0;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            border: 1px solid rgba(100, 116, 139, 0.3);
            z-index: 10;
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
            bottom: calc(100% + 5px);
        }
    </style>
      
    




      <div id="pageSecurity" class="page page-hidden">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <div class="col-span-2 space-y-6">
            <div class="card border border-slate-700/50 rounded-xl overflow-hidden">
              <div class="p-5 border-b border-slate-700/50 bg-gradient-to-r from-slate-800 to-slate-900/50">
                <div class="flex items-center">
                  <i data-lucide="shield" class="h-6 w-6 text-green-400 mr-3"></i>
                  <h3 class="text-lg font-semibold text-slate-100">Device Security Monitoring</h3>
                </div>
              </div>
              <div class="p-6">
                <div class="space-y-5">
                  <!-- User Agent -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="monitor" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">User Agent</span>
                    </div>
                    <span id="userAgent" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- DevTools Status -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="code" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">DevTools Status</span>
                    </div>
                    <span id="devtoolsStatus" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-900/30 text-red-400 border border-red-700/50">
                      <span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span>
                      Closed
                    </span>
                  </div>
                  <!-- Device Fingerprint -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="fingerprint" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Device Fingerprint</span>
                    </div>
                    <span id="deviceFingerprint" class="text-sm font-medium text-slate-400 truncate max-w-xs">Unknown</span>
                  </div>
                  <!-- IP Address -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="globe" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">IP Address</span>
                    </div>
                    <span id="ipAddress" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Location -->
                  <div class="flex items-center justify-between py-3 px-4 bg-slate-800/50 rounded-lg border border-slate-700/30">
                    <div class="flex items-center">
                      <i data-lucide="map-pin" class="h-5 w-5 text-slate-400 mr-3"></i>
                      <span class="text-sm font-medium text-slate-300">Location</span>
                    </div>
                    <span id="locationInfo" class="text-sm font-medium text-slate-400">Unknown</span>
                  </div>
                  <!-- Scan Button -->
                  <button id="runSecurityScanBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-500 hover:to-green-600 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-green-500/20 flex items-center justify-center">
                    <i data-lucide="refresh-cw" class="h-5 w-5 mr-2"></i>
                    Run Security Scan
                  </button>
                </div>
              </div>
            </div>
            <div class="card">
              <div class="p-4 border-b border-slate-700/50">
                <div class="flex items-center justify-between">
                  <div class="flex items-center">
                    <i data-lucide="activity" class="h-5 w-5 text-green-500 mr-2"></i>
                    <h3 class="text-slate-100">Security Log</h3>
                  </div>
                  <div class="flex items-center space-x-2">
                    <span
                      class="bg-slate-800/50 text-green-400 border border-green-500/50 rounded-md px-2 py-1 text-xs flex items-center"
                    >
                      <span
                        class="h-1.5 w-1.5 rounded-full bg-green-500 mr-1 animate-pulse"
                      ></span>
                      LIVE
                    </span>
                    <button class="text-slate-400 p-2">
                      <i data-lucide="refresh-cw" class="h-4 w-4"></i>
                    </button>
                  </div>
                </div>
              </div>
              <div class="p-6">
                <div id="securityLog" class="space-y-3">
                  <!-- Logs will be populated dynamically -->
                </div>
              </div>
            </div>
          </div>
          <div class="space-y-6">
            <div class="card">
              <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                  <h3 class="text-lg font-semibold text-slate-100">Security Actions</h3>
                  <i data-lucide="info" class="h-5 w-5 text-slate-400"></i>
                </div>
                <div class="space-y-3">
                  <button
                    id="clearSecurityLogBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="trash" class="h-4 w-4 mr-2"></i>
                    Clear Security Logs
                  </button>
                  <button
                    id="configureAlertsBtn"
                    class="w-full bg-slate-800/50 hover:bg-slate-700/50 rounded-md px-3 py-2 text-sm text-slate-100 flex items-center"
                  >
                    <i data-lucide="bell" class="h-4 w-4 mr-2"></i>
                    Configure Alerts
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
         
      

      <div id="pageSettings" class="page page-hidden">
  <div class="card max-w-8xl mx-auto overflow-hidden">
    <!-- Header Section -->
    <div class="p-6 border-b border-slate-700/50 bg-gradient-to-r from-slate-800/80 via-slate-800/60 to-slate-900/80 backdrop-blur-sm">
      <div class="flex items-start justify-between">
        <div>
          <h3 class="text-2xl font-bold text-slate-100 flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            Account Settings
          </h3>
          <p class="text-sm text-slate-400/90 mt-1.5 ml-9">Kelola profil dan preferensi akun Anda</p>
        </div>
        <button class="flex items-center space-x-2 bg-slate-700/50 hover:bg-slate-700/70 border border-slate-600/30 rounded-lg px-4 py-2 text-sm text-slate-300 transition-all duration-200 hover:text-white hover:shadow-sm">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
          </svg>
          <span>Refresh</span>
        </button>
      </div>
    </div>
    
    <!-- Main Content -->
    <div class="p-6 bg-slate-900/20">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left Column - Main Settings -->
        <div class="lg:col-span-2 space-y-8">
          <!-- Profile Section -->
          <div class="bg-slate-800/30 rounded-xl p-6 border border-slate-700/50 shadow-lg backdrop-blur-sm">
            <div class="flex items-center justify-between mb-6">
              <h4 class="text-lg font-semibold text-slate-200 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.8">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                Informasi Profil
              </h4>
              <span class="text-xs bg-cyan-500/10 text-cyan-400 px-3 py-1 rounded-full">Wajib diisi</span>
            </div>
            
            <!-- Profile Picture -->
            <div class="mb-8">
              <label class="text-sm font-medium text-slate-400/90 flex items-center">
                Foto Profil
                <span class="text-xs text-slate-500 ml-2">(Opsional)</span>
              </label>
              <div class="mt-4 flex flex-col sm:flex-row items-start sm:items-center space-y-4 sm:space-y-0 sm:space-x-6">
                <div class="relative group">
                  <div id="profilePicturePreview" class="h-28 w-28 rounded-full bg-gradient-to-br from-cyan-600/80 to-slate-800 text-white flex items-center justify-center text-3xl font-bold shadow-lg ring-2 ring-cyan-500/30">
                    U
                  </div>
                  <div class="absolute inset-0 rounded-full bg-black/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                  </div>
                </div>
                
                <div class="flex-1 space-y-3">
                  <div class="flex flex-wrap gap-3">
                    <input type="file" id="profilePictureInput" accept="image/png,image/jpeg,image/webp" class="hidden" />
                    <button id="changeProfilePictureBtn" class="flex items-center space-x-2 bg-gradient-to-r from-cyan-600/90 to-teal-600/90 hover:from-cyan-700 hover:to-teal-700 text-white rounded-lg px-4 py-2.5 text-sm font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 active:scale-[0.98]">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                      </svg>
                      <span>Ganti Foto</span>
                    </button>
                    <button id="removeProfilePictureBtn" class="flex items-center space-x-2 bg-slate-700/60 hover:bg-slate-600/70 text-slate-300 hover:text-white rounded-lg px-4 py-2.5 text-sm font-medium transition-all border border-slate-600/30">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                      <span>Hapus</span>
                    </button>
                  </div>
                  <p class="text-xs text-slate-500/80 leading-relaxed">
                    Format: JPG, PNG, atau WEBP. Ukuran maksimal 15MB.<br>
                    Resolusi disarankan: 500×500px (1:1). Gambar akan dipotong secara proporsional.
                  </p>
                </div>
              </div>
            </div>
            
            <!-- Full Name -->
            <div class="mb-6">
              <label for="fullNameInput" class="block text-sm font-medium text-slate-400/90 mb-3 flex items-center">
                Nama Lengkap
                <span class="text-xs text-rose-400 ml-1.5">*</span>
              </label>
              <div class="relative group">
                <input id="settingsFullNameInput" type="text" class="w-full bg-slate-800/40 border border-slate-700/40 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/40 focus:border-cyan-500/70 placeholder-slate-500/60 pl-11 transition-all duration-200 group-hover:border-slate-600/70" placeholder="Contoh: John Doe" />
                <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500/80 group-focus-within:text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-400 opacity-0 group-focus-within:opacity-100 transition-opacity duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                </div>
              </div>
              <p class="text-xs text-slate-500/70 mt-2">Gunakan nama asli Anda untuk verifikasi akun</p>
            </div>
          
        
                  
                  <!-- Wallet Address Section -->
<div class="space-y-6 p-6 bg-slate-900/50 rounded-xl border border-slate-800 shadow-lg">
  <!-- Wallet Address Input -->
  <div class="space-y-2">
    <div class="flex items-center space-x-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
      </svg>
      <label for="walletAddressInput" class="text-sm font-medium text-slate-300">Alamat Dompet</label>
    </div>
    
    <div class="relative group">
      <input id="walletAddressInput" type="text" class="w-full bg-slate-800/70 border border-slate-700/50 rounded-lg px-4 py-3 pl-10 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500/70 transition-all duration-200 group-hover:border-slate-600" placeholder="0x71C7656EC7ab88b098defB751B7401B5f6d8976F" />
      
      <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 group-focus-within:text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      
      <div class="absolute inset-y-0 right-0 flex items-center pr-3">
        <button class="p-1 rounded-md hover:bg-slate-700/50 transition-colors duration-200" aria-label="Paste address">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400 hover:text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
          </svg>
        </button>
      </div>
    </div>
  </div>
  
  <!-- Connect Wallet Button -->
  <div class="pt-2">
    <button id="connectWalletBtn" class="w-full flex items-center justify-center space-x-2 bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white rounded-lg px-4 py-3 text-sm font-medium transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-purple-500/30 active:scale-[0.98]">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
      </svg>
      <span>Hubungkan Dompet</span>
    </button>
  </div>
</div>

                  
                  <!-- Email -->
                  <div class="mb-6">
                    <label class="block text-sm font-medium text-slate-400 mb-2">Alamat Email</label>
                    <div class="relative">
                      <input id="emailDisplay" type="email" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm text-slate-400" readonly />
                      <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                      </div>
                    </div>
                  </div>
      
                  <!-- Referral Section -->
                  <div class="mb-6">
                    <h4 class="text-lg font-semibold text-slate-200 mb-4 flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                      </svg>
                      Referral Program
                    </h4>
                   <!-- Referral Section -->
<div class="space-y-6 p-6 bg-slate-900/50 rounded-xl border border-slate-800 shadow-lg">
  <!-- Referral Code -->
  <div class="space-y-3">
    <div class="flex items-center space-x-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
      </svg>
      <label for="referralCodeInput" class="text-sm font-medium text-slate-300">Kode Referral Anda</label>
    </div>
    
    <div class="flex space-x-3">
      <div class="relative flex-1 group">
        <input id="referralCodeInput" type="text" class="w-full bg-slate-800/70 border border-slate-700/50 rounded-lg px-4 py-3 pl-10 text-sm text-emerald-400 focus:outline-none focus:ring-2 focus:ring-emerald-500/30 focus:border-emerald-500/50 transition-all duration-200 group-hover:border-slate-600" readonly />
        
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-emerald-500/80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
          </svg>
        </div>
      </div>
      
      <button id="copyReferralBtn" class="copy-btn flex items-center justify-center w-28 space-x-2 bg-gradient-to-r from-emerald-600 to-teal-600 hover:from-emerald-700 hover:to-teal-700 text-white rounded-lg px-4 py-3 text-sm font-medium transition-all duration-300 shadow-lg hover:shadow-xl hover:shadow-emerald-500/20 active:scale-[0.98] overflow-hidden">
        <span class="copy-text flex items-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 copy-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
          </svg>
          <span>Salin</span>
        </span>
        <span class="success-text hidden items-center space-x-2">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          <span>Berhasil!</span>
        </span>
      </button>
    </div>
    
    <div class="flex items-start space-x-2 pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-emerald-400/80 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <p class="text-xs text-slate-400/80">Bagikan kode referral Anda dan dapatkan bonus khusus!</p>
    </div>
  </div>
  
  <!-- Invited Users Count -->
  <div class="space-y-3">
    <div class="flex items-center space-x-2">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
        <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
      </svg>
      <label class="text-sm font-medium text-slate-300">Jumlah Pengguna yang Diundang</label>
    </div>
    
    <div class="relative group">
      <span id="invitedUsersCount" class="w-full bg-slate-800/70 border border-slate-700/50 rounded-lg px-4 py-3 pl-10 text-sm text-cyan-400 inline-block">0</span>
      <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-500/80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
        </svg>
      </div>
    </div>
    
    <div class="flex items-start space-x-2 pt-1">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-cyan-400/80 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
      </svg>
      <p class="text-xs text-slate-400/80">Anda akan mendapatkan reward untuk setiap pengguna yang bergabung menggunakan kode Anda</p>
    </div>
  </div>
</div>
</div>

<style>
  .copy-btn {
    position: relative;
  }
  
  .copy-text, .success-text {
    transition: all 0.3s ease;
    position: absolute;
    display: flex;
    align-items: center;
  }
  
  .copy-btn.copied .copy-text {
    transform: translateY(-40px);
    opacity: 0;
  }
  
  .copy-btn.copied .success-text {
    transform: translateY(0);
    opacity: 1;
  }
  
  .success-text {
    transform: translateY(40px);
    opacity: 0;
  }
</style>

<script>
  document.getElementById('copyReferralBtn').addEventListener('click', function() {
    const btn = this;
    btn.classList.add('copied');
    
    // Reset button after 2 seconds
    setTimeout(() => {
      btn.classList.remove('copied');
    }, 2000);
    
    // Copy to clipboard functionality would go here
    // navigator.clipboard.writeText(document.getElementById('referralCodeInput').value);
  });
</script>
                  
                  <!-- Save Button -->
                  <div class="mt-8 pt-6 border-t border-slate-700/50">
                    <button id="saveProfileBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                      </svg>
                      Simpan Perubahan Profil
                    </button>
                  </div>
                </div>
                
                <!-- Password Section -->
                <div class="bg-slate-800/50 rounded-xl p-6 border border-slate-700/50">
                  <h4 class="text-lg font-semibold text-slate-200 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    Ganti Kata Sandi
                  </h4>
                  
                  <div class="space-y-4">
                    <div>
                      <label for="currentPasswordInput" class="block text-sm font-medium text-slate-400 mb-2">Kata Sandi Saat Ini</label>
                      <div class="relative">
                        <input id="currentPasswordInput" type="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500" placeholder="Masukkan kata sandi saat ini" />
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 cursor-pointer hover:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </div>
                      </div>
                    </div>
                    
                    <div>
                      <label for="newPasswordInput" class="block text-sm font-medium text-slate-400 mb-2">Kata Sandi Baru</label>
                      <div class="relative">
                        <input id="newPasswordInput" type="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500" placeholder="Masukkan kata sandi baru" />
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 cursor-pointer hover:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </div>
                      </div>
                    </div>
                    
                    <div>
                      <label for="confirmNewPasswordInput" class="block text-sm font-medium text-slate-400 mb-2">Konfirmasi Kata Sandi Baru</label>
                      <div class="relative">
                        <input id="confirmNewPasswordInput" type="password" class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50 focus:border-cyan-500 placeholder-slate-500" placeholder="Konfirmasi kata sandi baru" />
                        <div class="absolute inset-y-0 right-0 flex items-center pr-3">
                          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500 cursor-pointer hover:text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                          </svg>
                        </div>
                      </div>
                    </div>
                    
                    <div class="pt-4">
                      <button id="changePasswordBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-cyan-500/20 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                        Perbarui Kata Sandi
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Right Column - Danger Zone -->
              <div class="lg:col-span-1">
                <div class="bg-slate-800/50 rounded-xl p-6 border border-red-900/50 sticky top-6">
                  <h4 class="text-lg font-semibold text-red-400 mb-4 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    Zona Bahaya
                  </h4>
                  
                  <p class="text-sm text-slate-400 mb-6">Aksi ini tidak dapat dibatalkan. Harap lanjutkan dengan hati-hati.</p>
                  
                  <div>
                    <label class="block text-sm font-medium text-red-400 mb-2">Hapus Akun</label>
                    <p class="text-xs text-slate-500 mb-4">Setelah Anda menghapus akun Anda, tidak ada jalan kembali. Semua data Anda akan dihapus secara permanen.</p>
                    <button id="deleteAccountBtn" class="w-full bg-red-600 hover:bg-red-700 text-white rounded-lg py-3 px-4 font-medium transition-all hover:shadow-lg hover:shadow-red-500/20 flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                      </svg>
                      Hapus Akun Saya
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/fingerprintjs@3.3.1/dist/fingerprint.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
      <script src="https://unpkg.com/@okxweb3/web3.js@latest/umd/index.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/2.4.0/purify.min.js"></script>
      <script>
        // Mendapatkan modul ipcRenderer dari Electron untuk komunikasi antar proses
        const { ipcRenderer } = require("electron");
      </script>
      
      <script>
        // START: Polyfill untuk fitur navigator.locks (jika belum didukung oleh browser)
        if (!navigator.locks) {
          navigator.locks = {
            request: async (name, options, callback) => {
              if (typeof options === 'function') {
                callback = options;
                options = {};
              }
              await callback({});
            },
            query: async () => ({ held: [], pending: [] })
          };
        }
        // END: Polyfill untuk fitur navigator.locks
      
        // START: Polyfill untuk fitur crypto.randomUUID (jika belum didukung oleh browser)
        if (!crypto.randomUUID) {
          crypto.randomUUID = function () {
            const bytes = new Uint8Array(16);
            crypto.getRandomValues(bytes);
            bytes[6] = (bytes[6] & 0x0f) | 0x40;
            bytes[8] = (bytes[8] & 0x3f) | 0x80;
            return Array.from(bytes, (byte) =>
              byte.toString(16).padStart(2, "0")
            ).join("");
          };
        }
        // END: Polyfill untuk fitur crypto.randomUUID
      
        // START: Inisialisasi klien Supabase
        const supabase = window.supabase.createClient(
          "https://mnobniomzmjgpyyqartz.supabase.co",
          "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ub2JuaW9tem1qZ3B5eXFhcnR6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDU3NDQ0NzYsImV4cCI6MjA2MTMyMDQ3Nn0.N1w5Ro7TGWu5zdTHhNCyop-iMTl7So7h6UwZfuybx1k"
        );
        // END: Inisialisasi klien Supabase
      
        // START: Konfigurasi variabel
        const PROXY_URL = 'http://localhost:3000/ask'; // URL proxy untuk permintaan ke AI
        const blockedWords = ['token', 'source code', 'contract', 'bypass', 'funding']; // Daftar kata-kata terlarang
        // END: Konfigurasi variabel
      
        // START: Elemen DOM
        const sendButton = document.getElementById('send-button'); // Tombol untuk mengirim pesan
        const messageInput = document.getElementById('message-input'); // Input untuk menulis pesan
        const logMessages = document.getElementById('log-messages'); // Area untuk menampilkan log pesan
        const newMessages = document.getElementById('new-messages'); // Elemen untuk menampilkan jumlah pesan baru
        const attachFileBtn = document.getElementById('attach-file-btn'); // Tombol untuk melampirkan file
        const fileInput = document.getElementById('file-input'); // Input untuk memilih file
        const toggleTemplatesBtn = document.getElementById('toggle-templates'); // Tombol untuk menampilkan/menyembunyikan template
        const templatePanel = document.getElementById('template-panel'); // Panel yang berisi template pertanyaan
        // END: Elemen DOM

        // START: Variabel state
let theme = "dark";
        let systemStatus = 85;
        let cpuUsage = 42;
        let memoryUsage = 68;
        let networkStatus = 92;
        let securityLevel = 75;
        let isMining = false;
        let miningInterval = null;
        let points = 0; // Akan diinisialisasi di DOMContentLoaded
        let deviceScore = 0;
        let boosterSpeed = 1;
        let user = null;
        let isLogin = true;
        let currentPage = "dashboard";
        // END: Variabel state
      
        // START: Konfigurasi booster
        const boosterConfig = {
          elite: { speed: 3, price: 0.0001 },
          epic: { speed: 5, price: 0.0003 },
          pro: { speed: 10, price: 0.009 },
          diamond: { speed: 15, price: 0.01 },
        };
        // END: Konfigurasi booster
      
        // START: Elemen DOM untuk berbagai fitur
        const loadingOverlay = document.getElementById("loadingOverlay");
        const authModal = document.getElementById("authModal");
        const authTitle = document.getElementById("authTitle");
        const emailInput = document.getElementById("emailInput");
        const passwordInput = document.getElementById("passwordInput");
        const emailAuthBtn = document.getElementById("emailAuthBtn");
        const googleAuthBtn = document.getElementById("googleAuthBtn");
        const metamaskAuthBtn = document.getElementById("metamaskAuthBtn");
        const phantomAuthBtn = document.getElementById("phantomAuthBtn");
        const okxAuthBtn = document.getElementById("okxAuthBtn");
        const toggleAuthBtn = document.getElementById("toggleAuthBtn");
        const themeToggle = document.getElementById("themeToggle");
        const userSection = document.getElementById("userSection");
        const loginBtn = document.getElementById("loginBtn");
        const userProfile = document.getElementById("userProfile");
        const userEmail = document.getElementById("userEmail");
        const userWallet = document.getElementById("userWallet");
        const userPoints = document.getElementById("userPoints");
        const userBooster = document.getElementById("userBooster");
        const deviceScoreEl = document.getElementById("deviceScore");
        const toggleMiningBtn = document.getElementById("toggleMiningBtn");
        const miningStatus = document.getElementById("miningStatus");
        const currentPoints = document.getElementById("currentPoints");
        const currentDeviceScore = document.getElementById("currentDeviceScore");
        const currentBooster = document.getElementById("currentBooster");
        const systemStatusEl = document.getElementById("systemStatus");
        const cpuUsageEl = document.getElementById("cpuUsage");
        const memoryUsageEl = document.getElementById("memoryUsage");
        const networkStatusEl = document.getElementById("networkStatus");
        const securityLevelEl = document.getElementById("securityLevel");
        const systemLoad = document.getElementById("systemLoad");
        const systemTime = document.getElementById("systemTime");
        const systemDate = document.getElementById("systemDate");
        const tabPerformance = document.getElementById("tabPerformance");
        const tabProcesses = document.getElementById("tabProcesses");
        const tabStorage = document.getElementById("tabStorage");
        const performanceTab = document.getElementById("performanceTab");
        const processesTab = document.getElementById("processesTab");
        const storageTab = document.getElementById("storageTab");
        const performanceChart = document.getElementById("performanceChart");
        const navDashboard = document.getElementById("navDashboard");
        const navBooster = document.getElementById("navBooster");
        const navLeaderboard = document.getElementById("navLeaderboard");
        const navSettings = document.getElementById("navSettings");
        const pageDashboard = document.getElementById("pageDashboard");
        const pageBooster = document.getElementById("pageBooster");
        const pageLeaderboard = document.getElementById("pageLeaderboard");
        const pageSettings = document.getElementById("pageSettings");
        const profilePictureInput = document.getElementById("profilePictureInput");
        const profilePicturePreview = document.getElementById("profilePicturePreview");
        const changeProfilePictureBtn = document.getElementById("changeProfilePictureBtn");
        const sidebarProfilePicture = document.getElementById("sidebarProfilePicture");
        const fullNameInput = document.getElementById("fullNameInput");
        const walletAddressInput = document.getElementById("walletAddressInput");
        const saveProfileBtn = document.getElementById("saveProfileBtn");
        const emailDisplay = document.getElementById("emailDisplay");
        const currentPasswordInput = document.getElementById("currentPasswordInput");
        const newPasswordInput = document.getElementById("newPasswordInput");
        const confirmNewPasswordInput = document.getElementById("confirmNewPasswordInput");
        const changePasswordBtn = document.getElementById("changePasswordBtn");
        const deleteAccountBtn = document.getElementById("deleteAccountBtn");
        const deleteAccountModal = document.getElementById("deleteAccountModal");
        const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
        const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
        // Added for Security page
        const navSecurity = document.getElementById("navSecurity");
        const pageSecurity = document.getElementById("pageSecurity");
        // Added for Communications page
        const navCommunications = document.getElementById("navCommunications");
        const pageCommunications = document.getElementById("pageCommunications");
      
        const fullNameGroup = document.getElementById("fullNameGroup");
        const referralCodeGroup = document.getElementById("referralCodeGroup");
        // END: Elemen DOM untuk berbagai fitur
      
        // START: Inisialisasi ikon Lucide
        lucide.createIcons();
        // END: Inisialisasi ikon Lucide
      
        // START: Elemen DOM untuk monitoring sistem
        const networkUsageEl = document.getElementById("networkUsage");
        const cpuBar = document.querySelector(".cpu-bar");
        const memoryBar = document.querySelector(".memory-bar");
        const networkBar = document.querySelector(".network-bar");
        // END: Elemen DOM untuk monitoring sistem
      
        // START: Variabel untuk status benchmark
        let isBenchmarkRunning = false;
        // END: Variabel untuk status benchmark
      
        // START: Fungsi Benchmark Sederhana untuk Estimasi CPU Load
        async function measureCPULoad() {
          const start = performance.now();
          let i = 0;
          const iterations = 1e7;
      
          for (; i < iterations; i++) {
            Math.sqrt(i);
          }
      
          const duration = performance.now() - start;
          const estimatedLoad = Math.min(100, Math.max(10, 100 - (duration / 10)));
          return estimatedLoad;
        }
        // END: Fungsi Benchmark Sederhana untuk Estimasi CPU Load
      
        // START: Fungsi Simulasi Beban CPU (tanpa file worker.js)
        function simulateHeavyTask() {
          if (isBenchmarkRunning) return;
      
          isBenchmarkRunning = true;
      
          // Membuat kode worker secara inline sebagai Blob
          const workerCode = `
            self.onmessage = function () {
              let i = 0;
              while (i < 1e8) {
                Math.sqrt(i);
                i++;
              }
              self.postMessage("done");
            };
          `;
      
          const blob = new Blob([workerCode], { type: "application/javascript" });
          const workerURL = URL.createObjectURL(blob);
      
          const worker = new Worker(workerURL);
      
          worker.onmessage = async () => {
            await new Promise(r => setTimeout(r, 500));
            isBenchmarkRunning = false;
            URL.revokeObjectURL(workerURL);
          };
      
          worker.postMessage("start");
        }
        // END: Fungsi Simulasi Beban CPU (tanpa file worker.js)
      
        // START: Fungsi Update UI Monitoring Dinamis
        async function updateSystemOverview() {
          if (!isBenchmarkRunning) simulateHeavyTask();
      
          cpuUsage = await measureCPULoad();
          if (cpuUsageEl) {
            cpuUsageEl.innerHTML = `${cpuUsage.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
          }
          if (cpuBar) cpuBar.style.width = `${cpuUsage}%`;
      
          // Update Memory Usage (Chrome-only)
          if (performance && performance.memory) {
            const mem = performance.memory;
            const used = (mem.usedJSHeapSize / mem.jsHeapSizeLimit) * 100;
            memoryUsage = Math.min(100, used);
            if (memoryUsageEl) {
              memoryUsageEl.innerHTML = `${memoryUsage.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
            }
            if (memoryBar) memoryBar.style.width = `${memoryUsage}%`;
          }
      
          // Update Network Status (simulasi)
          networkStatus = Math.min(Math.max(networkStatus + (Math.random() * 4 - 2), 0), 100);
          if (networkUsageEl) {
            networkUsageEl.innerHTML = `${networkStatus.toFixed(0)}<span class="text-lg text-slate-400 ml-1">%</span>`;
          }
          if (networkBar) networkBar.style.width = `${networkStatus}%`;
        }
        // END: Fungsi Update UI Monitoring Dinamis
      
        // START: Fungsi Jalankan Otomatis Setiap Beberapa Detik
        function startSystemMonitoring() {
          setInterval(async () => {
            await updateSystemOverview();
          }, 3000); // Update setiap 3 detik
        }
        // END: Fungsi Jalankan Otomatis Setiap Beberapa Detik
      
        document.addEventListener("DOMContentLoaded", () => {
          updateSystemOverview(); // Update awal
          startSystemMonitoring(); // Mulai monitoring otomatis
        });
      
        // START: Konfigurasi efek partikel premium
        const config = {
          particleCount: 150,
          baseHue: 200,         // Warna dasar biru
          hueRange: 30,          // Rentang variasi warna
          sizeRange: [0.5, 3],   // Ukuran partikel minimum dan maksimum
          speedRange: 0.5,       // Kecepatan gerakan
          lineDistance: 100,     // Jarak maksimum untuk menggambar garis
          lineOpacity: 0.15,     // Opasitas garis
          particleOpacity: 0.7   // Opasitas partikel
        };
        // END: Konfigurasi efek partikel premium
      
        // START: Inisialisasi canvas untuk efek partikel
        const canvas = document.getElementById("particleCanvas");
        const ctx = canvas.getContext("2d");
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        // END: Inisialisasi canvas untuk efek partikel
      
        // START: Kelas Partikel dengan fitur tambahan
        class Particle {
          constructor() {
            this.reset(true);
            this.velocity = {
              x: (Math.random() - 0.5) * config.speedRange,
              y: (Math.random() - 0.5) * config.speedRange
            };
            this.history = [];
            this.maxHistory = 5;
          }
      
          reset(initial = false) {
            this.x = initial ? Math.random() * canvas.width : 0;
            this.y = initial ? Math.random() * canvas.height : Math.random() * canvas.height;
            this.size = Math.random() * (config.sizeRange[1] - config.sizeRange[0]) + config.sizeRange[0];
            this.hue = config.baseHue + (Math.random() * config.hueRange - config.hueRange / 2);
            this.alpha = Math.random() * 0.5 + config.particleOpacity;
          }
      
          update() {
            // Simpan posisi sebelumnya untuk efek jejak
            this.history.unshift({ x: this.x, y: this.y });
            if (this.history.length > this.maxHistory) this.history.pop();
      
            // Perbarui posisi
            this.x += this.velocity.x;
            this.y += this.velocity.y;
      
            // Reset partikel yang keluar layar dengan transisi halus
            if (this.x > canvas.width + this.size || this.x < -this.size ||
              this.y > canvas.height + this.size || this.y < -this.size) {
              this.reset();
            }
          }
      
          draw() {
            // Gambar partikel
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.alpha})`;
            ctx.fill();
      
            // Gambar efek cahaya halus
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size * 1.5, 0, Math.PI * 2);
            ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.alpha * 0.3})`;
            ctx.fill();
      
            // Gambar jejak history
            for (let i = 0; i < this.history.length; i++) {
              const point = this.history[i];
              const ratio = (i + 1) / this.history.length;
      
              ctx.beginPath();
              ctx.arc(point.x, point.y, this.size * ratio, 0, Math.PI * 2);
              ctx.fillStyle = `hsla(${this.hue}, 80%, 70%, ${this.alpha * ratio * 0.5})`;
              ctx.fill();
            }
          }
        }
        // END: Kelas Partikel dengan fitur tambahan
      
        // START: Buat array partikel
        const particles = [];
        for (let i = 0; i < config.particleCount; i++) {
          particles.push(new Particle());
        }
        // END: Buat array partikel
      
        // START: Loop animasi dengan optimasi kinerja
        let lastTime = 0;
        const fps = 60;
        const interval = 1000 / fps;
      
        function animate(currentTime) {
          requestAnimationFrame(animate);
      
          // Batasi kecepatan frame untuk kinerja
          const deltaTime = currentTime - lastTime;
          if (deltaTime < interval) return;
      
          lastTime = currentTime - (deltaTime % interval);
      
          // Bersihkan canvas dengan efek fade halus untuk jejak
          ctx.fillStyle = `rgba(15, 23, 42, 0.1)`;
          ctx.fillRect(0, 0, canvas.width, canvas.height);
      
          // Gambar koneksi antar partikel
          drawConnections();
      
          // Perbarui dan gambar partikel
          particles.forEach(particle => {
            particle.update();
            particle.draw();
          });
        }
        // END: Loop animasi dengan optimasi kinerja
      
        // START: Gambar koneksi elegan antar partikel terdekat
        function drawConnections() {
          for (let i = 0; i < particles.length; i++) {
            for (let j = i + 1; j < particles.length; j++) {
              const p1 = particles[i];
              const p2 = particles[j];
              const distance = Math.sqrt(Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2));
      
              if (distance < config.lineDistance) {
                const opacity = 1 - (distance / config.lineDistance);
                ctx.beginPath();
                ctx.moveTo(p1.x, p1.y);
                ctx.lineTo(p2.x, p2.y);
                ctx.strokeStyle = `hsla(${config.baseHue}, 60%, 70%, ${opacity * config.lineOpacity})`;
                ctx.lineWidth = 0.5;
                ctx.stroke();
              }
            }
          }
        }
        // END: Gambar koneksi elegan antar partikel terdekat
      
        // START: Tangani perubahan ukuran jendela
        function handleResize() {
          canvas.width = window.innerWidth;
          canvas.height = window.innerHeight;
        }
        // END: Tangani perubahan ukuran jendela
      
        // START: Interaksi mouse - partikel bereaksi terhadap posisi mouse
        let mouseX = null;
        let mouseY = null;
        const mouseRadius = 100;
      
        function handleMouseMove(e) {
          mouseX = e.clientX;
          mouseY = e.clientY;
        }
      
        function handleMouseLeave() {
          mouseX = null;
          mouseY = null;
        }
        // END: Interaksi mouse - partikel bereaksi terhadap posisi mouse
      
        // START: Inisialisasi event listener untuk efek partikel
        window.addEventListener('resize', handleResize);
        window.addEventListener('mousemove', handleMouseMove);
        window.addEventListener('mouseleave', handleMouseLeave);
        animate();
        // END: Inisialisasi event listener untuk efek partikel
      
        // START: Fungsi untuk menampilkan notifikasi toast
        function showToast(title, description, variant = "default") {
          // Konfigurasi untuk setiap variant
          const variants = {
            default: {
              bg: 'bg-gradient-to-r from-cyan-500 to-blue-600',
              loading: 'from-blue-400 via-cyan-300 to-sky-500',
              icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>`
            },
            destructive: {
              bg: 'bg-gradient-to-r from-red-500 to-pink-600',
              loading: 'from-rose-400 via-red-300 to-pink-500',
              icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                      </svg>`
            },
            success: {
              bg: 'bg-gradient-to-r from-emerald-500 to-green-600',
              loading: 'from-green-400 via-emerald-300 to-teal-500',
              icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>`
            },
            warning: {
              bg: 'bg-gradient-to-r from-amber-500 to-yellow-600',
              loading: 'from-yellow-400 via-amber-300 to-orange-500',
              icon: `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                      </svg>`
            }
          };
      
          const selectedVariant = variants[variant] || variants.default;
      
          // Buat elemen toast
          const toast = document.createElement("div");
          toast.className = `fixed top-4 right-4 p-4 rounded-xl text-white z-[200] ${selectedVariant.bg} shadow-2xl backdrop-blur-sm w-80 overflow-hidden transition-all duration-400 ease-[cubic-bezier(0.68,-0.55,0.27,1.55)]`;
          toast.style.opacity = "0";
          toast.style.transform = "translateX(20px)";
      
          // Animasi loading bar
          const loadingBar = document.createElement("div");
          loadingBar.className = `absolute top-0 left-0 h-1 w-full bg-gradient-to-r ${selectedVariant.loading}`;
          loadingBar.style.animation = "loadingProgress 3s linear forwards";
      
          // Konten toast
          toast.innerHTML = `
            <div class="relative z-10 flex items-start gap-3">
              <div class="mt-0.5 flex-shrink-0 text-white/90">
                ${selectedVariant.icon}
              </div>
              <div class="flex-1">
                <div class="font-bold text-lg mb-1">${title}</div>
                <div class="text-sm opacity-90">${description}</div>
              </div>
              <button onclick="this.parentElement.parentElement.remove()" class="text-white/80 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
          `;
          toast.prepend(loadingBar);
          document.body.appendChild(toast);
      
          // Style untuk animasi
          const style = document.createElement("style");
          style.textContent = `
            @keyframes loadingProgress {
              0% { width: 100%; }
              100% { width: 0%; }
            }
          `;
          document.head.appendChild(style);
      
          // Animasi masuk
          requestAnimationFrame(() => {
            toast.style.opacity = "1";
            toast.style.transform = "translateX(0)";
          });
      
          // Animasi keluar dan hapus
          setTimeout(() => {
            toast.style.opacity = "0";
            toast.style.transform = "translateX(20px)";
            setTimeout(() => {
              toast.remove();
              style.remove();
            }, 400);
          }, 3000);
        }
        // END: Fungsi untuk menampilkan notifikasi toast
      
        // START: Fungsi debounce
        function debounce(func, wait) {
          let timeout;
          return function (...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
          };
        }
        // END: Fungsi debounce
      
        // START: Routing sisi klien
        function showPage(page) {
          const pages = {
            dashboard: pageDashboard,
            booster: pageBooster,
            leaderboard: pageLeaderboard,
            communications: pageCommunications,
            settings: pageSettings,
            security: pageSecurity,
          };
          const navs = {
            dashboard: navDashboard,
            booster: navBooster,
            leaderboard: navLeaderboard,
            communications: navCommunications,
            settings: navSettings,
            security: navSecurity,
          };
      
          Object.keys(pages).forEach((key) => {
            if (pages[key]) {
              pages[key].classList.add("page-hidden");
              navs[key].classList.remove("nav-active", "text-cyan-400");
              navs[key].classList.add("text-slate-400");
            }
          });
      
          if (pages[page]) {
            pages[page].classList.remove("page-hidden");
            navs[page].classList.add("nav-active", "text-cyan-400");
          }
      
          currentPage = page;
      
          if (page === "leaderboard") loadLeaderboard();
          if (page === "settings") loadSettings();
          if (page === "security") runSecurityScan();
          if (page === "communications") initializeChat();
        }
        // END: Routing sisi klien
      
        // START: Variabel global
        let messageCount = 0; // Jumlah pesan baru
        const aiAvatarUrl = '/assets/ai_avatar.png'; // URL avatar untuk AI
        // END: Variabel global
      
        // START: Fungsi untuk auto-scroll ke bawah
        function scrollToBottom() {
          logMessages.scrollTop = logMessages.scrollHeight;
        }
        // END: Fungsi untuk auto-scroll ke bawah
      
        // START: Fungsi untuk menambahkan pesan ke log
        function addMessage(sender, message, isUser = false) {
          const messageDiv = document.createElement('div');
          messageDiv.className = 'flex items-start space-x-3 p-3 rounded-lg bg-gradient-to-r from-slate-800/50 to-slate-900/40 border border-slate-700/50 hover:border-cyan-500/30 transition-all';
      
          const avatarUrl = isUser ? getUserAvatar() : aiAvatarUrl;
      
          messageDiv.innerHTML = `
            <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
              ${avatarUrl
                ? `<img src="${avatarUrl}" class="h-5 w-5 object-cover" alt="${sender} avatar" onerror="this.style.display='none'; this.parentElement.innerHTML='<svg xmlns=\\"http://www.w3.org/2000/svg\\" class=\\"h-5 w-5 text-cyan-400\\" fill=\\"none\\" viewBox=\\"0 0 24 24\\" stroke=\\"currentColor\\" stroke-width=\\"1.5\\"><path stroke-linecap=\\"round\\" stroke-linejoin=\\"round\\" d=\\"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z\\" /></svg>`
                : `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg>`
              }
            </div>
            <div class="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-sm text-slate-300 flex-1">
              <div class="font-medium text-cyan-400 mb-1 flex items-center">
                ${sender}
                ${!isUser ? '<span class="ml-2 text-xs px-2 py-0.5 bg-slate-700/50 rounded-full text-slate-400">System</span>' : ''}
              </div>
              <p>${message}</p>
              <div class="text-xs text-slate-500 mt-2 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                ${new Date().toLocaleTimeString()}
              </div>
            </div>
          `;
      
          logMessages.appendChild(messageDiv);
          scrollToBottom(); // Scroll otomatis ke bawah
        }
        // END: Fungsi untuk menambahkan pesan ke log
      
        // START: Fungsi untuk mendapatkan avatar pengguna dari Supabase
        function getUserAvatar() {
          if (user && user.profile && user.profile.avatar_url) {
            const { data } = supabase.storage.from('avatars').getPublicUrl(user.profile.avatar_url);
            return data.publicUrl || null;
          }
          return null;
        }
        // END: Fungsi untuk mendapatkan avatar pengguna dari Supabase
      
        // START: Fungsi untuk memperbarui jumlah pesan
        function updateMessageCount() {
          messageCount++;
          newMessages.textContent = `${messageCount} New Messages`;
        }
        // END: Fungsi untuk memperbarui jumlah pesan
      
        // START: Fungsi untuk memproses gambar dengan animasi loading
        async function processImage(file) {
          const formData = new FormData();
          formData.append('image', file);
          addMessage('You', `Mengunggah gambar: ${file.name}`, true);
      
          // Tampilkan animasi loading lingkaran
          const loadingContainer = document.createElement('div');
          loadingContainer.className = 'flex items-center space-x-3 p-3 rounded-lg bg-slate-800/60 border border-slate-700/50';
      
          const progressBar = document.createElement('div');
          progressBar.className = 'relative w-10 h-10';
          progressBar.innerHTML = `
            <svg class="w-full h-full" viewBox="0 0 36 36">
              <path
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831"
                fill="none"
                stroke="#3B82F6"
                stroke-width="2"
                stroke-dasharray="100"
                stroke-dashoffset="100"
                id="loading-circle-bg"
              />
              <circle cx="18" cy="18" r="15.9155" fill="none" stroke="#1E40AF" stroke-width="1" />
            </svg>
            <div id="loading-percent" class="absolute inset-0 flex items-center justify-center text-xs font-medium text-blue-400">0%</div>
          `;
      
          loadingContainer.innerHTML = `
            <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-cyan-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
              </svg>
            </div>
          `;
          loadingContainer.appendChild(progressBar);
          logMessages.appendChild(loadingContainer);
          scrollToBottom();
      
          let progress = 0;
          const percentText = progressBar.querySelector('#loading-percent');
          const circle = progressBar.querySelector('#loading-circle-bg');
      
          const interval = setInterval(() => {
            progress += 1;
            percentText.textContent = `${progress}%`;
            const dashOffset = 100 - (progress / 100) * 100;
            circle.style.strokeDashoffset = dashOffset;
            if (progress >= 100) {
              clearInterval(interval);
              setTimeout(() => {
                loadingContainer.remove();
              }, 300);
            }
            scrollToBottom();
          }, 30); // Kecepatan animasi
      
          try {
            const response = await fetch('http://localhost:3000/analyze-image', {
              method: 'POST',
              body: formData,
            });
            if (!response.ok) throw new Error('Gagal menganalisis gambar');
            const data = await response.json();
            if (data.description && data.description.trim()) {
              addMessage('AI Assistant', `Berdasarkan gambar: "${data.description}"`, false);
              sendToAI(data.description); // Kirim ke AI
            } else {
              addMessage('AI Assistant', 'Tidak ada teks terbaca dari gambar.', false);
            }
            updateMessageCount();
          } catch (error) {
            console.error('Error menganalisis gambar:', error);
            addMessage('AI Assistant', 'Error: Tidak dapat membaca teks dari gambar.', 'red', false);
          } finally {
            fileInput.value = ''; // Reset input file
          }
        }
        // END: Fungsi untuk memproses gambar dengan animasi loading
      
        // START: Fungsi untuk mengirim pesan ke AI
        async function sendToAI(message) {
          const lowerMessage = message.toLowerCase();
          const containsBlockedWord = blockedWords.some(word => lowerMessage.includes(word));
      
          if (containsBlockedWord) {
            addMessage('AI Assistant', 'Maaf, pertanyaan Anda di luar topik Project Aqula.', false);
            updateMessageCount();
            return;
          }
      
          // 🔥 Cek roadmap Aqula
          if (lowerMessage.includes("roadmap") || lowerMessage.includes("road map") || lowerMessage.includes("jalur perkembangan")) {
            const roadmapButtonContainer = document.createElement('div');
            roadmapButtonContainer.className = 'p-3';
      
            roadmapButtonContainer.innerHTML = `
              <button id="roadmap-button" class="
                group relative inline-flex items-center justify-center px-5 py-3 overflow-hidden font-medium
                tracking-tighter text-white bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg shadow-lg
                transition-all duration-300 hover:scale-105 hover:shadow-xl
              ">
                <span class="absolute w-0 h-full bg-cyan-400 top-0 left-0 block transition-all duration-300 ease-out group-hover:w-full"></span>
      
                <span class="relative flex items-center z-10">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 animate-pulse" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656 0L10 9.172a4 4 0 000 5.656l3 3a4 4 0 005.656-5.656l-3-3a4 4 0 00-5.656 0l-.707.707a1 1 0 001.414 1.414l.707-.707z" clip-rule="evenodd" />
                  </svg>
                  Lihat Roadmap Aqula
                </span>
              </button>
            `;
      
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3 p-3 rounded-lg bg-slate-800/60 border border-slate-700/50';
      
            messageDiv.innerHTML = `
              <div class="flex-shrink-0 bg-slate-700/50 p-2 rounded-lg border border-slate-700/50 mr-3">
                <img src="${aiAvatarUrl}" class="h-5 w-5 object-cover" alt="AI Avatar" />
              </div>
              <div class="bg-slate-800/60 border border-slate-700/50 rounded-xl p-4 text-sm text-slate-300 flex-1">
                <div class="font-medium text-cyan-400 mb-1 flex items-center">
                  AI Assistant
                  <span class="ml-2 text-xs px-2 py-0.5 bg-slate-700/50 rounded-full text-slate-400">System</span>
                </div>
                <p>Anda ingin melihat roadmap Aqula? Klik tombol di bawah ini:</p>
              </div>
            `;
      
            logMessages.appendChild(messageDiv);
            logMessages.appendChild(roadmapButtonContainer);
            scrollToBottom();
      
            document.getElementById('roadmap-button').addEventListener('click', () => {
              window.open('https://aqularoadmap.vercel.app', '_blank');
            });
      
            updateMessageCount();
            return;
          }
      
          // Lanjutkan ke API jika bukan roadmap
          const prompt = `
            Anda adalah AI Assistant resmi Project Aqula.
            Jawablah hanya seputar fungsi umum, fitur mining, dan visi masa depan Aqula.
            Jangan berikan jawaban teknis, kode, smart contract, atau informasi rahasia.
            Pertanyaan: ${message}
          `;
      
          try {
            const response = await fetch(PROXY_URL, {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ prompt }),
            });
            if (!response.ok) throw new Error('Gagal menghubungi server');
            const data = await response.json();
            addMessage('AI Assistant', data.completion, false);
            updateMessageCount();
          } catch (error) {
            console.error('Error:', error);
            addMessage('AI Assistant', 'Error: Tidak dapat menghubungi server.', 'red', false);
            updateMessageCount();
          }
        }
        // END: Fungsi untuk mengirim pesan ke AI
      
        // START: Event listeners
        document.addEventListener('DOMContentLoaded', async () => {
          try {
            await checkUser();
            user = window.currentUser ? { ...window.currentUser, profile: window.currentUser.profile } : null;
            initializeCommunicationsLog();
          } catch (error) {
            console.error('Error checking user:', error);
            user = null;
            initializeCommunicationsLog();
          }
      
          // Tombol Attach File
          attachFileBtn.addEventListener('click', () => fileInput.click());
      
          // Input file gambar
          fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
              processImage(file);
            } else {
              addMessage('AI Assistant', 'Silakan unggah file gambar.', 'red', false);
            }
          });
      
          // Tombol Send
          sendButton.addEventListener('click', () => {
            const message = messageInput.value.trim();
            if (message) {
              addMessage('You', message, true);
              sendToAI(message);
              messageInput.value = '';
              updateMessageCount();
            }
          });
      
          // Enter untuk kirim pesan
          messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              sendButton.click();
            }
          });
      
          // Toggle Templates
          toggleTemplatesBtn.addEventListener('click', () => {
            templatePanel.classList.toggle('hidden');
            toggleTemplatesBtn.textContent = templatePanel.classList.contains('hidden') ? 'Show Templates' : 'Hide Templates';
          });
      
          // Template pertanyaan
          templatePanel.querySelectorAll('button').forEach(button => {
            button.addEventListener('click', () => {
              const question = button.getAttribute('data-template');
              messageInput.value = question;
              addMessage('You', question, true);
              sendToAI(question);
              templatePanel.classList.add('hidden');
              toggleTemplatesBtn.textContent = 'Show Templates';
              updateMessageCount();
            });
          });
        });
        // END: Event listeners
      
        // START: Fungsi untuk inisialisasi Communications Log
        function initializeCommunicationsLog() {
          console.log('Menginisialisasi AI Communications...');
        }
        // END: Fungsi untuk inisialisasi Communications Log
      
        // START: Fungsi checkUser (diperbarui dengan subscription)
        async function checkUser() {
          try {
            console.log('Memulai pengecekan pengguna...');
            const { data: { session }, error: sessionError } = await supabase.auth.getSession();
            if (sessionError) throw sessionError;
            if (session && session.user) {
              console.log('Pengguna ditemukan:', session.user);
              window.currentUser = session.user;
              const { data, error: profileError } = await supabase
                .from('profiles')
                .select('id, email, points, wallet_address, avatar_url, full_name, booster, referral_code, mining_speed')
                .eq('id', session.user.id)
                .single();
              if (profileError) {
                console.error('Error mengambil profil:', profileError);
                if (profileError.message.includes('0 rows')) {
                  console.log('Buat profil default untuk:', session.user.id);
                  const { error: insertError } = await supabase.from('profiles').insert({
                    id: session.user.id,
                    email: session.user.email,
                    points: 0,
                    wallet_address: null,
                    avatar_url: null,
                    full_name: null,
                    booster: 0,
                    referral_code: '',
                    mining_speed: 0
                  });
                  if (insertError) throw insertError;
                  const { data: newProfile } = await supabase
                    .from('profiles')
                    .select('id, email, points, wallet_address, avatar_url, full_name, booster, mining_speed')
                    .eq('id', session.user.id)
                    .single();
                  window.currentUser.profile = newProfile;
                } else {
                  throw profileError;
                }
              } else {
                window.currentUser.profile = data;
              }
              console.log('Data profil lengkap:', window.currentUser.profile);

              // Setup Supabase Realtime Subscription
              const subscription = supabase
                .channel(`profiles:${window.currentUser.id}`)
                .on(
                  'postgres_changes',
                  {
                    event: 'UPDATE',
                    schema: 'public',
                    table: 'profiles',
                    filter: `id=eq.${window.currentUser.id}`,
                  },
                  (payload) => {
                    console.log('Realtime update received:', payload);
                    if (payload.new && payload.new.mining_speed !== undefined) {
                      console.log('Mining speed updated:', payload.new.mining_speed);
                      window.currentUser.profile.mining_speed = payload.new.mining_speed; // Update mining_speed di profil
                      console.log('Calling updateUI...');
                      updateUI();
                    }
                  }
                )
                .subscribe();

              // Bersihkan subscription saat logout atau halaman ditutup
              window.addEventListener('unload', () => {
                supabase.removeChannel(subscription);
              });

              // Panggil updateUI untuk memastikan UI diperbarui setelah login
              updateUI();
              authModal.style.display = "none"; // Pastikan modal login disembunyikan
              showPage("dashboard"); // Tampilkan halaman dashboard setelah login
            } else {
              window.currentUser = null;
              console.log('Tidak ada sesi pengguna.');
              updateUI();
              authModal.style.display = "flex"; // Tampilkan modal login jika tidak ada sesi
            }
          } catch (error) {
            console.error('Error dalam checkUser:', error);
            window.currentUser = null;
            updateUI();
            authModal.style.display = "flex";
          }
        }
        // END: Fungsi checkUser

        // START: Fungsi untuk memperbarui UI
        function updateUI() {
          const referralSpeed = document.getElementById('referralSpeed');
          const userProfile = document.getElementById('userProfile');
          const userSection = document.getElementById('userSection');
          const userEmail = document.getElementById('userEmail');
          const userWallet = document.getElementById('userWallet');
          const userPoints = document.getElementById('userPoints');
          const userBooster = document.getElementById('userBooster');
          const deviceScoreEl = document.getElementById('deviceScore');
          const currentPoints = document.getElementById('currentPoints');
          const currentDeviceScore = document.getElementById('currentDeviceScore');
          const currentBooster = document.getElementById('currentBooster');
          const emailDisplay = document.getElementById('emailDisplay');
          const fullNameInput = document.getElementById('fullNameInput');
          const walletAddressInput = document.getElementById('walletAddressInput');
          const profilePicturePreview = document.getElementById('profilePicturePreview');
          const sidebarProfilePicture = document.getElementById('sidebarProfilePicture');

          if (!referralSpeed || !userSection || !userProfile) {
            console.error('Required DOM elements not found:', { referralSpeed, userSection, userProfile });
            return;
          }

          console.log('Updating UI...');
          console.log('Current user:', window.currentUser);

          if (window.currentUser && window.currentUser.profile) {
            user = window.currentUser; // Sinkronkan variabel user dengan window.currentUser
            points = window.currentUser.profile.points || 0;
            boosterSpeed = window.currentUser.profile.booster ? boosterConfig[window.currentUser.profile.booster]?.speed || 1 : 1;

            userProfile.classList.remove('hidden');
            userSection.innerHTML = `
              <div class="flex items-center space-x-2">
                <div class="h-8 w-8 rounded-full bg-slate-700 text-cyan-500 flex items-center justify-center">
                  ${window.currentUser.profile.full_name ? window.currentUser.profile.full_name[0].toUpperCase() : window.currentUser.email[0].toUpperCase()}
                </div>
                <button id="logoutBtn" class="text-slate-100 bg-red-600 hover:bg-red-700 rounded-md px-3 py-1.5 flex items-center">
                  <i data-lucide="log-out" class="h-4 w-4 mr-2"></i> Logout
                </button>
              </div>
            `;

            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
              logoutBtn.addEventListener('click', handleLogout);
              console.log('Logout button event listener added');
            } else {
              console.error('Logout button not found after rendering');
            }

            const speed = window.currentUser.profile.mining_speed || 0;
            console.log('Fetched mining speed from profile:', speed);
            referralSpeed.textContent = `${speed}x`;
            console.log('Updated referralSpeed to:', `${speed}x`);
            referralSpeed.classList.toggle('text-cyan-400', speed > 0);
            referralSpeed.classList.toggle('text-slate-400', speed === 0);

            if (userEmail) userEmail.textContent = window.currentUser.profile.email || window.currentUser.email;
            if (userWallet) userWallet.textContent = window.currentUser.profile.wallet_address || 'Not set';
            if (userPoints) userPoints.textContent = points.toFixed(2);
            if (userBooster) userBooster.textContent = window.currentUser.profile.booster
              ? window.currentUser.profile.booster.charAt(0).toUpperCase() + window.currentUser.profile.booster.slice(1)
              : 'None';
            if (deviceScoreEl) deviceScoreEl.textContent = deviceScore.toFixed(2);
            if (currentPoints) currentPoints.textContent = points.toFixed(2);
            if (currentDeviceScore) currentDeviceScore.textContent = deviceScore.toFixed(2);
            if (currentBooster) currentBooster.textContent = window.currentUser.profile.booster
              ? window.currentUser.profile.booster.charAt(0).toUpperCase() + window.currentUser.profile.booster.slice(1)
              : 'None';
            if (emailDisplay) emailDisplay.value = window.currentUser.profile.email || window.currentUser.email;
            if (fullNameInput) fullNameInput.value = window.currentUser.profile.full_name || '';
            if (walletAddressInput) walletAddressInput.value = window.currentUser.profile.wallet_address || '';

            if (window.currentUser.profile.avatar_url) {
              const { data: avatarData, error: avatarError } = supabase.storage
                .from('avatars')
                .getPublicUrl(window.currentUser.profile.avatar_url);
              if (avatarError) {
                console.error('Avatar fetch error:', avatarError);
              } else if (avatarData.publicUrl) {
                console.log('Avatar URL:', avatarData.publicUrl);
                if (profilePicturePreview) profilePicturePreview.innerHTML = `<img src="${avatarData.publicUrl}" class="h-24 w-24 rounded-full object-cover" alt="Profile" />`;
                if (sidebarProfilePicture) sidebarProfilePicture.innerHTML = `<img src="${avatarData.publicUrl}" class="h-12 w-12 rounded-full object-cover" alt="Profile" />`;
              }
            } else {
              console.log('No avatar URL found for user');
            }

            lucide.createIcons();
            console.log('Lucide icons initialized');
            authModal.style.display = 'none'; // Pastikan modal disembunyikan setelah login
          } else {
            userProfile.classList.add('hidden');
            userSection.innerHTML = `
              <button id="loginBtn" class="text-slate-100 bg-cyan-600 hover:bg-cyan-700 rounded-md px-3 py-1.5 flex items-center">
                <i data-lucide="user" class="h-4 w-4 mr-2"></i> Login
              </button>
            `;

            const loginBtn = document.getElementById('loginBtn');
            if (loginBtn) {
              loginBtn.addEventListener('click', () => {
                authModal.style.display = 'flex';
              });
              console.log('Login button event listener added');
            } else {
              console.error('Login button not found after rendering');
            }

            referralSpeed.textContent = '0x';
            referralSpeed.classList.add('text-slate-400');
            console.log('No user or profile, set referralSpeed to 0x');

            if (currentBooster) {
              currentBooster.textContent = 'None';
              currentBooster.classList.add('text-amber-400');
            }

            lucide.createIcons();
            console.log('Lucide icons initialized for login UI');
          }
        }
        // END: Fungsi untuk memperbarui UI

        // START: Event listener navigasi
        navDashboard.addEventListener("click", () => showPage("dashboard"));
        navBooster.addEventListener("click", () => {
          if (!window.currentUser) {
            showToast("Error", "Please login to access Booster", "destructive");
            authModal.style.display = "flex";
            return;
          }
          showPage("booster");
        });
        navLeaderboard.addEventListener("click", () => showPage("leaderboard"));
        navCommunications.addEventListener("click", () => {
          if (!window.currentUser) {
            showToast("Error", "Please login to access Communications", "destructive");
            authModal.style.display = "flex";
            return;
          }
          showPage("communications");
        });
        navSettings.addEventListener("click", () => {
          if (!window.currentUser) {
            showToast("Error", "Please login to access Settings", "destructive");
            authModal.style.display = "flex";
            return;
          }
          showPage("settings");
        });
        navSecurity.addEventListener("click", () => {
          if (!window.currentUser) {
            showToast("Error", "Please login to access Security", "destructive");
            authModal.style.display = "flex";
            return;
          }
          showPage("security");
        });
        // END: Event listener navigasi

        // START: Fungsi untuk memeriksa sesi dan profil pengguna
        async function checkUser() {
          try {
            if (!userSection || !authModal || !userProfile || !loadingOverlay) {
              console.error("DOM elements not found:", {
                userSection,
                authModal,
                userProfile,
                loadingOverlay,
              });
              throw new Error("Required DOM elements are missing");
            }

            console.log("Starting user check...");
            loadingOverlay.classList.remove("hidden");

            const {
              data: { session },
              error: sessionError,
            } = await supabase.auth.getSession();
            if (sessionError) {
              console.error("Session error:", sessionError);
              throw sessionError;
            }

            console.log("Session data:", session);

            if (session && session.user) {
              console.log("User found, ID:", session.user.id);
              window.currentUser = session.user; // Simpan user ke variabel global untuk chat

              let profile;
              const { data, error: profileError } = await supabase
                .from("profiles")
                .select("id, email, points, wallet_address, avatar_url, full_name, booster, referral_code, mining_speed")
                .eq("id", session.user.id)
                .single();

              if (profileError) {
                console.error("Profile fetch error:", profileError);
                if (profileError.message.includes("0 rows")) {
                  console.log("No profile found, creating default profile for user:", session.user.id);
                  const { error: insertError } = await supabase.from("profiles").insert({
                    id: session.user.id,
                    email: session.user.email,
                    points: 0,
                    wallet_address: null,
                    booster: null,
                    avatar_url: null,
                    full_name: null,
                    referral_code: '',
                    mining_speed: 0
                  });
                  if (insertError) {
                    console.error("Profile creation error:", insertError);
                    throw insertError;
                  }

                  const { data: newProfile, error: newProfileError } = await supabase
                    .from("profiles")
                    .select("id, email, points, wallet_address, avatar_url, full_name, booster, referral_code, mining_speed")
                    .eq("id", session.user.id)
                    .single();
                  if (newProfileError) {
                    console.error("New profile fetch error:", newProfileError);
                    throw newProfileError;
                  }
                  profile = newProfile;
                } else {
                  throw profileError;
                }
              } else {
                profile = data;
              }

              console.log("Profile data:", profile);

              window.currentUser.profile = profile;
              user = window.currentUser;
              points = profile.points || 0;
              boosterSpeed = profile.booster ? boosterConfig[profile.booster]?.speed || 1 : 1;

              // Setup Supabase Realtime Subscription
              const subscription = supabase
                .channel(`profiles:${window.currentUser.id}`)
                .on(
                  'postgres_changes',
                  {
                    event: 'UPDATE',
                    schema: 'public',
                    table: 'profiles',
                    filter: `id=eq.${window.currentUser.id}`,
                  },
                  (payload) => {
                    console.log('Realtime update received:', payload);
                    if (payload.new && payload.new.mining_speed !== undefined) {
                      console.log('Mining speed updated:', payload.new.mining_speed);
                      window.currentUser.profile.mining_speed = payload.new.mining_speed;
                      console.log('Calling updateUI...');
                      updateUI();
                    }
                  }
                )
                .subscribe();

              // Bersihkan subscription saat logout atau halaman ditutup
              window.addEventListener('unload', () => {
                supabase.removeChannel(subscription);
              });

              updateUI();
              authModal.style.display = "none";
              console.log("Auth modal hidden after successful login");
              showPage("dashboard"); // Pastikan hanya dashboard yang ditampilkan setelah login

              if (isMining) {
                console.log("Starting mining process...");
                startMining();
              }
            } else {
              console.log("No active session, setting up login UI");
              user = null;
              window.currentUser = null;
              updateUI();
              authModal.style.display = "flex";
            }
          } catch (error) {
            console.error("Error in checkUser:", error);
            showToast("Error", error.message || "Failed to check user status", "destructive");
            user = null;
            window.currentUser = null;
            updateUI();
            authModal.style.display = "flex";
          } finally {
            loadingOverlay.classList.add("hidden");
            console.log("User check completed, hiding loading overlay");
          }
        }
        // END: Fungsi untuk memeriksa sesi dan profil pengguna

        // START: Fungsi untuk menangani logout
        async function handleLogout() {
          try {
            const { error } = await supabase.auth.signOut();
            if (error) throw error;
            user = null;
            window.currentUser = null;
            points = 0;
            localStorage.removeItem("mining_points");
            authModal.style.display = "flex";
            showToast("Success", "Logged out successfully");
            updateUI();
            showPage("dashboard"); // Kembali ke dashboard setelah logout
          } catch (error) {
            console.error("Logout error:", error);
            showToast("Error", "Failed to logout", "destructive");
          }
        }
        // END: Fungsi untuk menangani logout

        document.addEventListener("DOMContentLoaded", () => {
          // START: Fungsi untuk mereset semua error pada form
          function clearErrors() {
            document.querySelectorAll(".input-error").forEach(el => el.classList.remove("input-error"));
            document.querySelectorAll(".shake").forEach(el => el.classList.remove("shake"));
            document.querySelectorAll(".error-message").forEach(el => {
              el.textContent = "";
              el.classList.add("hidden");
            });
          }
          // END: Fungsi untuk mereset semua error pada form

          // START: Fungsi untuk menampilkan error pada input tertentu
          function showError(inputElement, message) {
            const parent = inputElement.closest(".relative") || inputElement.parentElement;
            const errorDiv = parent.querySelector(".error-message");
            if (!inputElement.classList.contains("input-error")) {
              inputElement.classList.add("input-error");
            }
            inputElement.classList.add("shake");
            setTimeout(() => inputElement.classList.remove("shake"), 500);
            if (errorDiv) {
              errorDiv.textContent = message;
              errorDiv.classList.remove("hidden");
            }
          }
          // END: Fungsi untuk menampilkan error pada input tertentu

          // START: Fungsi untuk menampilkan atau menyembunyikan pesan error pada input
          function toggleError(inputElement, hasError, message = "") {
            const parent = inputElement.closest(".relative") || inputElement.parentElement;
            const errorDiv = parent.querySelector(".error-message");

            if (hasError) {
              inputElement.classList.add("input-error", "shake");
              setTimeout(() => inputElement.classList.remove("shake"), 500);
              if (errorDiv) {
                errorDiv.innerHTML = `<span class="error-text"><i class="fas fa-exclamation-circle"></i> ${message}</span>`;
                errorDiv.classList.remove("hidden");
              }
            } else {
              inputElement.classList.remove("input-error", "shake");
              if (errorDiv) {
                errorDiv.innerHTML = "";
                errorDiv.classList.add("hidden");
              }
            }
          }
          // END: Fungsi untuk menampilkan atau menyembunyikan pesan error pada input

          // START: Fungsi untuk membuat kode referral acak dan memastikan unik
          async function generateReferralCode() {
            let unique = false;
            let newCode;
            while (!unique) {
              const randomNumbers = Math.floor(10000 + Math.random() * 90000);
              newCode = `AQULA${randomNumbers}`;
              const { data, error } = await supabase
                .from("profiles")
                .select("referral_code")
                .eq("referral_code", newCode);
              if (error) {
                console.error("Error checking referral code uniqueness:", error);
                throw error;
              }
              if (!data || data.length === 0) unique = true;
            }
            return newCode;
          }
          // END: Fungsi untuk membuat kode referral acak dan memastikan unik

          // START: Fungsi untuk memvalidasi kode referral
          async function validateReferralCode(code) {
            if (!code) return { valid: true, referrer: null };
            const { data, error } = await supabase
              .from("profiles")
              .select("id")
              .eq("referral_code", code)
              .single();
            if (error || !data) {
              return { valid: false, referrer: null };
            }
            return { valid: true, referrer: data.id };
          }
          // END: Fungsi untuk memvalidasi kode referral

          // START: Regex untuk validasi password kuat
          const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;
          // END: Regex untuk validasi password kuat

          // START: Validasi real-time untuk input email dan password
          document.getElementById("emailInput")?.addEventListener("input", function () {
            const value = this.value.trim();
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
            toggleError(this, !isValid, "Masukkan alamat email yang valid.");
          });

          document.getElementById("passwordInput")?.addEventListener("input", function () {
            const value = this.value;
            const isValid = value.length >= 6;
            toggleError(this, !isValid, "Kata sandi harus minimal 6 karakter.");
          });

          document.getElementById("regEmailInput")?.addEventListener("input", function () {
            const value = this.value.trim();
            const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
            toggleError(this, !isValid, "Masukkan alamat email yang valid.");
          });

          document.getElementById("regPasswordInput")?.addEventListener("input", function () {
            const value = this.value;
            const isValid = passwordRegex.test(value);
            toggleError(this, !isValid, "Kata sandi harus mengandung huruf besar, huruf kecil, angka, dan karakter khusus.");
          });

          document.getElementById("referralInput")?.addEventListener("input", async function () {
            const value = this.value.trim();
            if (value) {
              const { valid } = await validateReferralCode(value);
              toggleError(this, !valid, "Kode referral tidak valid.");
            } else {
              toggleError(this, false);
            }
          });
          // END: Validasi real-time untuk input email dan password

          // START: Toggle show/hide password
          document.querySelectorAll('.show-password').forEach(btn => {
            btn.addEventListener("click", function (e) {
              e.preventDefault();
              const targetId = this.getAttribute("data-target");
              if (!targetId) return;
              const input = document.getElementById(targetId);
              if (!input) return;
              const isPassword = input.type === "password";
              input.type = isPassword ? "text" : "password";
              const svg = this.querySelector("svg");
              if (!svg) return;
              svg.innerHTML = isPassword
                ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.975 9.975 0 011.689-2.908m2.121 2.121A3 3 0 1015 12a3 3 0 00-4.242 0m6.366 6.366A10.05 10.05 0 0012 19c-4.478 0-8.268-2.943-9.542-7a9.975 9.975 0 011.689-2.908m2.121 2.121A3 3 0 1015 12a3 3 0 00-4.242 0m6.366 6.366l2.121-2.121" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3l18 18" />`
                : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c-4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />`;
            });
          });
          // END: Toggle show/hide password

          // START: Event listener untuk tombol login dengan email
          emailAuthBtn.addEventListener("click", async () => {
            let hasError = false;
            const email = document.getElementById("emailInput").value.trim();
            const password = document.getElementById("passwordInput").value;

            clearErrors();

            const emailField = document.getElementById("emailInput");
            const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            toggleError(emailField, !emailValid, "Masukkan alamat email yang valid.");
            if (!emailValid) hasError = true;

            const passwordField = document.getElementById("passwordInput");
            const passwordValid = password.length >= 6;
            toggleError(passwordField, !passwordValid, "Kata sandi harus minimal 6 karakter.");
            if (!passwordValid) hasError = true;

            if (hasError) return;

            try {
              console.log("Attempting to login with email:", email);
              const { error } = await supabase.auth.signInWithPassword({ email, password });
              if (error) {
                console.error("Login error:", error.message);
                showToast("Error", error.message || "Gagal masuk. Periksa email dan kata sandi.", "destructive");
                return;
              }
              showToast("Sukses", "Berhasil masuk.");
              authModal.style.display = "none"; // Sembunyikan modal setelah login
              await checkUser();
            } catch (error) {
              console.error("Authentication error:", error.message);
              showToast("Error", error.message || "Terjadi kesalahan. Coba lagi.", "destructive");
            }
          });
          // END: Event listener untuk tombol login dengan email

          // START: Event listener untuk tombol register
          registerBtn.addEventListener("click", async () => {
            let hasError = false;
            const email = document.getElementById("regEmailInput").value.trim();
            const password = document.getElementById("regPasswordInput").value;
            const fullName = document.getElementById("fullNameInput").value.trim();
            const referralCode = document.getElementById("referralInput")?.value.trim();

            clearErrors();

            const emailField = document.getElementById("regEmailInput");
            const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            toggleError(emailField, !emailValid, "Masukkan alamat email yang valid.");
            if (!emailValid) hasError = true;

            const passwordField = document.getElementById("regPasswordInput");
            const passwordValid = passwordRegex.test(password);
            toggleError(passwordField, !passwordValid, "Kata sandi harus mengandung huruf besar, huruf kecil, angka, dan karakter khusus.");
            if (!passwordValid) hasError = true;

            const fullNameField = document.getElementById("fullNameInput");
            const fullNameValid = fullName.length > 0;
            toggleError(fullNameField, !fullNameValid, "Nama lengkap wajib diisi.");
            if (!fullNameValid) hasError = true;

            const referralField = document.getElementById("referralInput");
            let referralValid = true;
            let referrerId = null;
            if (referralCode) {
              const { valid, referrer } = await validateReferralCode(referralCode);
              referralValid = valid;
              referrerId = referrer;
              toggleError(referralField, !valid, "Kode referral tidak valid.");
              if (!valid) hasError = true;
            }

            if (hasError) return;

            try {
              console.log("Attempting to register with email:", email);
              const { data, error: signUpError } = await supabase.auth.signUp({
                email,
                password,
                options: {
                  redirectTo: `${window.location.origin}/confirm`,
                  data: { full_name: fullName }
                }
              });
              if (signUpError) {
                console.error("Sign-up error:", signUpError.message);
                showToast("Error", signUpError.message || "Pendaftaran gagal. Coba lagi.", "destructive");
                return;
              }
              console.log("Sign-up successful, data:", data);

              const generatedReferralCode = await generateReferralCode();
              console.log("Generated Referral Code:", generatedReferralCode);

              const userId = data.user.id;
              const initialPoints = referralCode ? 500 : 0;
              const { error: profileError, data: profileData } = await supabase.from("profiles").insert({
                id: userId,
                email: email,
                points: initialPoints,
                wallet_address: null,
                booster: null,
                avatar_url: null,
                full_name: fullName,
                referral_code: generatedReferralCode,
                referred_by: referralCode || null,
                mining_speed: 0
              }).select();

              if (profileError) {
                console.error("Profile insert error:", profileError.message);
                showToast("Error", profileError.message || "Gagal menyimpan profil. Periksa RLS.", "destructive");
                return;
              }
              console.log("Profile data inserted:", profileData);

              if (referralCode && referrerId) {
                const { error: referrerError } = await supabase
                  .from("profiles")
                  .update({
                    points: supabase.raw("points + 1000"),
                    mining_speed: supabase.raw("mining_speed + 1")
                  })
                  .eq("id", referrerId);

                if (referrerError) {
                  console.error("Referrer reward error:", referrerError.message);
                  showToast("Error", "Gagal memberikan reward referral.", "destructive");
                }
              }

              showToast("Sukses", `Pendaftaran berhasil. Periksa ${email} untuk konfirmasi (cek spam jika tidak ada).`);
              authModal.style.display = "none"; // Sembunyikan modal setelah registrasi
              await checkUser();
            } catch (error) {
              console.error("Authentication error:", error.message);
              showToast("Error", error.message || "Terjadi kesalahan. Coba lagi.", "destructive");
            }
          });
          // END: Event listener untuk tombol register

          // START: Fungsi showToast (dipertahankan)
          function showToast(type, message, variant = "default") {
            const toastContainer = document.getElementById("toastContainer");
            if (!toastContainer) {
              console.error("Toast container not found. Add <div id='toastContainer'></div> to your HTML.");
              return;
            }

            const toast = document.createElement("div");
            toast.className = `fixed bottom-5 right-5 z-50 px-4 py-2 rounded-lg shadow-lg transform transition-transform duration-300 ease-in-out translate-y-0 opacity-100
              ${variant === "default" ? "bg-slate-800 text-white" : ""}
              ${variant === "success" ? "bg-green-600 text-white" : ""}
              ${variant === "destructive" ? "bg-red-600 text-white" : ""}`;
            toast.innerHTML = `<strong>${type}</strong><br /><small>${message}</small>`;
            toastContainer.appendChild(toast);

            setTimeout(() => {
              toast.classList.remove("translate-y-0", "opacity-100");
              toast.classList.add("translate-y-20", "opacity-0");
              setTimeout(() => toast.remove(), 500);
            }, 3000);
          }
          // END: Fungsi showToast

          // START: Event listener untuk tombol Google Auth
          googleAuthBtn.addEventListener("click", async () => {
            try {
              const { error } = await supabase.auth.signInWithOAuth({
                provider: "google",
                options: { redirectTo: window.location.origin }
              });
              if (error) throw error;
            } catch (error) {
              console.error("Google auth error:", error.message);
              showToast("Error", error.message || "Gagal autentikasi Google.", "destructive");
            }
          });
          // END: Event listener untuk tombol Google Auth

          // START: Fungsi untuk menangani autentikasi wallet
          async function handleWalletAuth(walletType) {
            try {
              let walletAddress;
              switch (walletType) {
                case "metamask":
                  if (!window.ethereum) {
                    showToast("Error", "Silakan instal MetaMask.", "destructive");
                    return;
                  }
                  [walletAddress] = await window.ethereum.request({ method: 'eth_requestAccounts' });
                  break;
                case "phantom":
                  if (!window.solana || !window.solana.isPhantom) {
                    showToast("Error", "Silakan instal Phantom.", "destructive");
                    return;
                  }
                  const res = await window.solana.connect();
                  walletAddress = res.publicKey.toString();
                  break;
                case "okx":
                  if (!window.okxwallet) {
                    showToast("Error", "Silakan instal OKX Wallet.", "destructive");
                    return;
                  }
                  const accounts = await window.okxwallet.request({ method: 'eth_requestAccounts' });
                  walletAddress = accounts[0];
                  break;
                default:
                  throw new Error("Tipe wallet tidak valid.");
              }

              const { data: { session }, error: sessionError } = await supabase.auth.getSession();
              if (sessionError || !session || !session.user) {
                showToast("Error", "Silakan masuk dengan email terlebih dahulu.", "destructive");
                authModal.style.display = "flex";
                return;
              }

              const { error: updateError } = await supabase
                .from("profiles")
                .update({ wallet_address: walletAddress })
                .eq("id", session.user.id);

              if (updateError) throw updateError;

              user.wallet_address = walletAddress;
              updateUI();
              showToast("Sukses", `${walletType} berhasil terhubung.`);
            } catch (error) {
              console.error("Wallet auth error:", error.message);
              showToast("Error", error.message || "Gagal menghubungkan wallet.", "destructive");
            }
          }
          // END: Fungsi untuk menangani autentikasi wallet

          // START: Event listener untuk tombol autentikasi wallet
          metamaskAuthBtn.addEventListener("click", () => handleWalletAuth("metamask"));
          phantomAuthBtn.addEventListener("click", () => handleWalletAuth("phantom"));
          okxAuthBtn.addEventListener("click", () => handleWalletAuth("okx"));
          // END: Event listener untuk tombol autentikasi wallet

          // START: Event listener untuk toggle form autentikasi (login/register)
          toggleAuthBtn.addEventListener("click", () => {
            isLogin = !isLogin;
            loginForm.classList.toggle("hidden", !isLogin);
            registerForm.classList.toggle("hidden", isLogin);
            emailAuthBtn.querySelector("span").textContent = isLogin ? "Continue" : "Create Account";
            toggleAuthBtn.innerHTML = isLogin
              ? 'Need an account? <span class="underline">Register here</span>'
              : 'Already have an account? <span class="underline">Login here</span>';
            fullNameGroup.classList.toggle("hidden", isLogin);
            referralCodeGroup.classList.toggle("hidden", isLogin);
          });
          // END: Event listener untuk toggle form autentikasi (login/register)

          // START: Event listener untuk toggle tema (dark/light)
          const themeToggle = document.getElementById("themeToggle");
          if (themeToggle) {
            themeToggle.addEventListener("click", () => {
              document.documentElement.classList.toggle("dark");
              const currentTheme = document.documentElement.classList.contains("dark") ? "dark" : "light";
              localStorage.setItem("theme", currentTheme);
              themeToggle.innerHTML = `<i data-lucide="${currentTheme === "dark" ? "moon" : "sun"}" class="h-5 w-5"></i>`;
              lucide.createIcons();
            });
          }
          // END: Event listener untuk toggle tema (dark/light)

          // START: Event listener untuk menutup modal autentikasi
          document.getElementById("closeAuthModal")?.addEventListener("click", () => {
            authModal.style.display = "none";
          });
          // END: Event listener untuk menutup modal autentikasi

          // START: Pengecekan status pengguna awal
          checkUser();
          // END: Pengecekan status pengguna awal
        });
      














// =========================================================================
// BAGIAN 1: SIMULASI METRIK SISTEM (Tanpa DOMContentLoaded)
// =========================================================================


function updateSystemMetrics() {
    // Simulasi perubahan nilai metrik
    cpuUsage = Math.min(100, Math.max(20, cpuUsage + (Math.random() - 0.5) * 10));
    memoryUsage = Math.min(100, Math.max(40, memoryUsage + (Math.random() - 0.5) * 8));
    networkStatus = Math.min(100, Math.max(70, networkStatus + (Math.random() - 0.5) * 5));
    securityLevel = Math.min(100, Math.max(60, securityLevel + (Math.random() - 0.5) * 4));
    systemStatus = Math.round((cpuUsage + memoryUsage + networkStatus + securityLevel) / 4);

    // Memperbarui elemen DOM dengan nilai baru
    cpuUsageEl.textContent = `${cpuUsage.toFixed(0)}%`;
    memoryUsageEl.textContent = `${memoryUsage.toFixed(0)}%`;
    networkStatusEl.textContent = `${networkStatus.toFixed(0)}%`;
    securityLevelEl.textContent = `${securityLevel.toFixed(0)}%`;
    systemStatusEl.textContent = `${systemStatus}%`;
    systemLoad.textContent = `${((cpuUsage + memoryUsage) / 2).toFixed(0)}%`;

    // Memperbarui grafik performa (fungsi updatePerformanceChart diasumsikan ada)
    updatePerformanceChart();
}
/**
 * @description Akhir dari fungsi updateSystemMetrics.
 */

// =========================================================================
// BAGIAN 2: STATUS KEAMANAN (Firewall, Intrusion, dll. - Tanpa DOMContentLoaded)
// =========================================================================

// Cek apakah berjalan di lingkungan Electron
const isElectron = typeof require === 'function';

// Elemen DOM untuk status keamanan (diasumsikan ada saat script dieksekusi)
const firewallBadge = document.getElementById("firewallBadge");
const intrusionBadge = document.getElementById("intrusionBadge");
const encryptionBadge = document.getElementById("encryptionBadge");
const threatDbTime = document.getElementById("threatDbTime");
const securityLevelBar = document.getElementById("securityLevelBar");
const securityLevelText = document.getElementById("securityLevelText");
const toastContainer = document.getElementById("toastContainer"); // Container untuk toast


function randomBool(probability = 0.9) {
    return Math.random() < probability;
}

function showToastSecurity(message, type = "info") {
    // Pastikan container ada
    if (!toastContainer) {
        console.error("Toast container (#toastContainer) not found.");
        return;
    }

    const colors = {
        info: "bg-slate-800 border-slate-700 text-slate-200",
        success: "bg-green-900/30 border-green-800 text-green-300",
        warning: "bg-yellow-900/30 border-yellow-800 text-yellow-300",
        danger: "bg-red-900/30 border-red-800 text-red-300"
    };

    const toast = document.createElement("div");
    toast.className = `mb-2 ${colors[type]} px-4 py-2 rounded-md shadow-lg text-sm font-mono border animate-fade-in`;
    toast.textContent = message;

    toastContainer.appendChild(toast);

    // Hapus toast setelah beberapa detik
    setTimeout(() => {
        toast.classList.add("opacity-0");
        // Hapus elemen dari DOM setelah transisi selesai
        setTimeout(() => toast.remove(), 300);
    }, 2000); // Durasi tampil: 2 detik
}

function updateSecurityUI(data) {
    // Update Firewall Badge
    if (firewallBadge) {
        if (data.firewallActive) {
            firewallBadge.textContent = "Active";
            firewallBadge.className = "bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs";
        } else {
            firewallBadge.textContent = "Inactive";
            firewallBadge.className = "bg-gradient-to-r from-red-900/30 to-red-800/20 text-red-400 border border-red-700/50 rounded-md px-2 py-1 text-xs";
        }
    }

    // Update Intrusion Detection Badge
    if (intrusionBadge) {
        if (!data.intrusionDetected) {
            intrusionBadge.textContent = "Active";
            intrusionBadge.className = "bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs";
        } else {
            intrusionBadge.textContent = "⚠️ Threat Detected!";
            intrusionBadge.className = "bg-gradient-to-r from-red-900/30 to-red-800/20 text-red-400 border border-red-700/50 rounded-md px-2 py-1 text-xs animate-pulse";
            // Tampilkan notifikasi toast jika ancaman terdeteksi
            showToastSecurity("⚠️ Ancaman terdeteksi! Periksa aktivitas jaringan.", "danger");
        }
    }

    // Update Encryption Badge
    if (encryptionBadge) {
        if (data.encryptionEnabled) {
            encryptionBadge.textContent = "Active";
            encryptionBadge.className = "bg-gradient-to-r from-green-900/30 to-green-800/20 text-green-400 border border-green-700/50 rounded-md px-2 py-1 text-xs";
        } else {
            encryptionBadge.textContent = "Disabled";
            encryptionBadge.className = "bg-gradient-to-r from-yellow-900/30 to-yellow-800/20 text-yellow-400 border border-yellow-700/50 rounded-md px-2 py-1 text-xs";
        }
    }

    // Update Threat DB Time
    if (threatDbTime) {
        threatDbTime.innerHTML = `Updated <span class="text-slate-500">${data.threatDbUpdated}</span>`;
    }

    // Update Security Level Bar and Text
    if (securityLevelBar && securityLevelText) {
        securityLevelBar.style.width = `${data.securityLevel}%`;
        securityLevelText.textContent = `${data.securityLevel}%`;

        // Ganti warna bar berdasarkan level keamanan
        if (data.securityLevel > 70) {
            securityLevelBar.className = "h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full";
        } else if (data.securityLevel > 40) {
            securityLevelBar.className = "h-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full";
        } else {
            securityLevelBar.className = "h-full bg-gradient-to-r from-red-500 to-pink-500 rounded-full";
        }
    }
}
/**
 * @description Akhir dari fungsi updateSecurityUI.
 */

// Logika utama untuk status keamanan
if (isElectron) {
    // Jika berjalan di Electron, gunakan IPC untuk komunikasi data
    const { ipcRenderer } = require("electron"); // Gunakan require yang aman

    // Terima data update keamanan dari proses main
    ipcRenderer.on("security-update", (event, data) => {
        updateSecurityUI(data);
    });

    // Kirim permintaan data keamanan awal saat siap
    ipcRenderer.send("request-security-data");

} else {
    // Jika berjalan di browser biasa, jalankan simulasi data
    console.warn("Running in browser mode. Simulating security data.");
    setInterval(() => {
        const simulatedData = {
            firewallActive: randomBool(0.95),
            intrusionDetected: !randomBool(0.98), // Lebih sering tidak terdeteksi
            encryptionEnabled: randomBool(0.99),
            threatDbUpdated: `${Math.floor(Math.random() * 60)} min ago`,
            securityLevel: Math.max(30, Math.min(100, Math.floor(Math.random() * 80) + 20)) // Antara 30 dan 100
        };
        // Panggil fungsi update UI dengan data simulasi
        updateSecurityUI(simulatedData);
    }, 5000); // Update simulasi setiap 5 detik
}


// =========================================================================
// BAGIAN 3: SISTEM ALERT (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk alert
    const alertContainer = document.getElementById("systemAlertsContainer");
    // Asumsi library 'si' (systeminformation) sudah di-load jika tidak di Electron
    const si = (typeof require === 'function') ? require('systeminformation') : window.si;
    // Asumsi ipcRenderer sudah ada jika di Electron
    const ipcRenderer = (typeof require === 'function') ? require('electron').ipcRenderer : undefined;

    /**
     * @function getCurrentTime
     * @description Mendapatkan waktu saat ini dalam format string lokal.
     * @returns {string} String waktu (misal: "14:30:55").
     */
    function getCurrentTime() {
        return new Date().toLocaleTimeString();
    }
    /**
     * @description Akhir dari fungsi getCurrentTime.
     */

    /**
     * @function createAlert
     * @description Membuat dan menambahkan elemen alert baru ke container alert.
     * @param {object} options - Opsi untuk alert.
     * @param {string} [options.type="info"] - Tipe alert ('info', 'warning', 'success').
     * @param {string} options.title - Judul alert.
     * @param {string} options.message - Pesan detail alert.
     * @param {string} [options.time=getCurrentTime()] - Waktu kejadian alert.
     */
    function createAlert({ type = "info", title, message, time = getCurrentTime() }) {
        if (!alertContainer) {
            console.error("Alert container (#systemAlertsContainer) not found.");
            return;
        }

        const icons = {
            info: `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`,
            warning: `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>`,
            success: `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>`
        };

        const colors = {
            info: { bg: "bg-blue-900/20", border: "border-blue-700/30", iconBg: "bg-blue-500/20", iconColor: "text-blue-400" },
            warning: { bg: "bg-amber-900/20", border: "border-amber-700/30", iconBg: "bg-amber-500/20", iconColor: "text-amber-400" },
            success: { bg: "bg-green-900/20", border: "border-green-700/30", iconBg: "bg-green-500/20", iconColor: "text-green-400" }
        };

        const alertDiv = document.createElement("div");
        alertDiv.className = `flex items-start space-x-3 p-3 bg-gradient-to-r from-${colors[type].bg} to-${colors[type].bg.replace("/20", "/10")} rounded-lg border ${colors[type].border} transition-all hover:scale-[1.01] mb-2`; // Tambah margin bottom
        alertDiv.innerHTML = `
            <div class="mt-0.5 p-1.5 ${colors[type].iconBg} rounded-full">
                ${icons[type]}
            </div>
            <div class="flex-1">
                <div class="flex items-center">
                    <div class="text-sm font-medium text-slate-200">${title}</div>
                    <div class="ml-2 text-xs text-slate-500">${time}</div>
                </div>
                <div class="text-xs text-slate-400 mt-1">
                    ${message}
                </div>
            </div>
        `;
        // Tambahkan alert baru di bagian atas container
        alertContainer.prepend(alertDiv);
    }
    /**
     * @description Akhir dari fungsi createAlert.
     */

    /**
     * @function checkMemoryUsage
     * @description Memeriksa penggunaan memori sistem menggunakan systeminformation (jika tersedia)
     * dan membuat alert jika penggunaan melebihi batas tertentu.
     */
    async function checkMemoryUsage() {
        // Hanya jalankan jika 'si' tersedia (Electron atau library dimuat manual)
        if (!si || typeof si.mem !== 'function') {
            // console.warn("Systeminformation library (si.mem) not available for memory check.");
            return;
        }
        try {
            const mem = await si.mem();
            const usagePercent = Math.round((mem.active / mem.total) * 100);

            if (usagePercent > 80) {
                createAlert({
                    type: "warning",
                    title: "MemoryWarning",
                    message: `Penggunaan RAM melebihi batas aman: ${usagePercent}% aktif`
                });
            }
        } catch (err) {
            console.warn("Gagal mengambil data RAM:", err.message);
        }
    }
    /**
     * @description Akhir dari fungsi checkMemoryUsage.
     */

    /**
     * @function checkSuspiciousProcesses
     * @description Memeriksa daftar proses yang berjalan (jika 'si' tersedia)
     * dan membuat alert jika ditemukan nama proses yang mencurigakan.
     */
    async function checkSuspiciousProcesses() {
        // Hanya jalankan jika 'si' tersedia (Electron atau library dimuat manual)
        if (!si || typeof si.processes !== 'function') {
            // console.warn("Systeminformation library (si.processes) not available for process check.");
            return;
        }
        try {
            const processes = await si.processes();
            // Filter proses berdasarkan nama yang mengandung kata kunci mencurigakan (case-insensitive)
            const suspicious = processes.list.filter(p => /trojan|virus|malware|keylogger|rms/i.test(p.name));

            if (suspicious.length > 0) {
                createAlert({
                    type: "warning",
                    title: "⚠️ Ancaman Terdeteksi!",
                    message: `Ditemukan ${suspicious.length} proses mencurigakan: ${suspicious.map(p => p.name).slice(0, 3).join(", ") || "Proses tidak diketahui"}`
                });
            }
        } catch (err) {
            console.warn("Gagal memeriksa proses:", err.message);
        }
    }
    /**
     * @description Akhir dari fungsi checkSuspiciousProcesses.
     */

    // Setup listener IPC jika berjalan di Electron
    if (typeof ipcRenderer !== "undefined") {
        // Listener untuk hasil scan keamanan dari proses main
        ipcRenderer.on("security-scan-result", (event, result) => {
            createAlert({
                type: result.success ? "success" : "warning",
                title: result.success ? "Scan Selesai" : "Ancaman Terdeteksi!", // Judul disesuaikan
                message: result.message || (result.success
                    ? "Pemindaian keamanan selesai tanpa ancaman."
                    : "Virus atau potensi ancaman terdeteksi selama pemindaian."),
                time: new Date().toLocaleTimeString()
            });
        });

        // Listener untuk notifikasi backup selesai
        ipcRenderer.on("backup-complete", (event, result) => { // Tambahkan parameter result jika ada
            createAlert({
                type: result && result.success === false ? "warning" : "success", // Cek status sukses
                title: "💾 Backup " + (result && result.success === false ? "Gagal" : "Selesai"),
                message: result && result.message ? result.message : "Data cadangan berhasil disimpan."
            });
        });

        // Listener untuk notifikasi sinkronisasi selesai
        ipcRenderer.on("sync-complete", (event, result) => { // Tambahkan parameter result jika ada
            createAlert({
                type: result && result.success === false ? "warning" : "success", // Cek status sukses
                title: "🔄 Sinkronisasi " + (result && result.success === false ? "Gagal" : "Sukses"),
                message: result && result.message ? result.message : "Data berhasil disinkronkan dengan server."
            });
        });
    }

    // Jalankan pengecekan berkala (Memori & Proses)
    setInterval(() => {
        checkMemoryUsage();
        checkSuspiciousProcesses();
    }, 10000); // Cek setiap 10 detik

    
    // Simulasi alert jika bukan di Electron (untuk testing UI)
   
    const alertHistory = [];
    const alertsPerPage = 5;
    let currentPage = 1;

    // Fungsi untuk menambahkan alert ke riwayat
    function addAlertToHistory(alertData) {
        alertHistory.unshift(alertData); // Masukkan dari depan
        renderPaginatedAlerts();         // Update pagination
        renderActiveAlerts();            // Update alert aktif (maksimal 5)
    }

    // Fungsi untuk menampilkan hanya 5 alert terbaru di UI
    function renderActiveAlerts() {
        const container = document.getElementById("systemAlertsContainer");
        if (!container) return;

        container.innerHTML = ""; // Kosongkan dulu

        const alertsToShow = alertHistory.slice(0, 5); // Ambil 5 alert terbaru

        alertsToShow.forEach(alert => {
            const alertDiv = document.createElement("div");
            alertDiv.className = `bg-slate-800/60 p-3 rounded-lg border-l-4 ${
                alert.type === 'warning' ? 'border-yellow-500' :
                alert.type === 'success' ? 'border-green-500' : 'border-cyan-500'
            }`;

            alertDiv.innerHTML = `
                <div class="flex justify-between items-start">
                    <div>
                        <h4 class="font-medium text-slate-100">${alert.title}</h4>
                        <p class="text-sm text-slate-300 mt-1">${alert.message}</p>
                    </div>
                </div>
            `;
            container.appendChild(alertDiv);
        });
    }

    // Fungsi render pagination
    function renderPaginatedAlerts() {
        const paginationContainer = document.getElementById("alertPaginationContainer");
        if (!paginationContainer) return;

        paginationContainer.innerHTML = "";

        const totalPages = Math.ceil(alertHistory.length / alertsPerPage);
        if (totalPages <= 1) return;

        // Tombol Prev
        const prevBtn = document.createElement("button");
        prevBtn.textContent = "Prev";
        prevBtn.disabled = currentPage === 1;
        prevBtn.className = "px-3 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 disabled:opacity-50";
        prevBtn.onclick = () => {
            if (currentPage > 1) {
                currentPage--;
                renderPaginatedAlerts();
                renderActiveAlerts();
            }
        };
        paginationContainer.appendChild(prevBtn);

        // Halaman
        const maxVisiblePages = 3;
        let startPage = Math.max(1, currentPage - 1);
        let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

        for (let i = startPage; i <= endPage; i++) {
            const btn = document.createElement("button");
            btn.textContent = i;
            btn.className = `px-3 py-1 rounded ${
                i === currentPage ? 'bg-cyan-500 text-white' : 'bg-slate-700 text-white hover:bg-slate-600'
            }`;
            btn.onclick = () => {
                currentPage = i;
                renderPaginatedAlerts();
                renderActiveAlerts();
            };
            paginationContainer.appendChild(btn);
        }

        // Tombol Next
        const nextBtn = document.createElement("button");
        nextBtn.textContent = "Next";
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.className = "px-3 py-1 bg-slate-700 text-white rounded hover:bg-slate-600 disabled:opacity-50";
        nextBtn.onclick = () => {
            if (currentPage < totalPages) {
                currentPage++;
                renderPaginatedAlerts();
                renderActiveAlerts();
            }
        };
        paginationContainer.appendChild(nextBtn);
    }

    // Simulasi alert
    if (typeof ipcRenderer === "undefined") {
        console.warn("Running in browser mode. Simulating system alerts.");
        setInterval(() => {
            const randomNum = Math.random();
            let fakeType = "info";
            let fakeTitle = "System Info";
            let fakeMessage = "Tidak ada aktivitas mencurigakan terdeteksi.";

            if (randomNum > 0.9) {
                fakeType = "warning";
                fakeTitle = "MemoryWarning";
                fakeMessage = "Penggunaan RAM mendekati batas (" + Math.floor(Math.random() * 10 + 80) + "%).";
            } else if (randomNum > 0.8) {
                fakeType = "success";
                fakeTitle = "Operasi Sukses";
                fakeMessage = "Sinkronisasi data cloud selesai tanpa masalah.";
            }

            createAlert({
                type: fakeType,
                title: fakeTitle,
                message: fakeMessage
            });

            addAlertToHistory({
                type: fakeType,
                title: fakeTitle,
                message: fakeMessage
            });
        }, 15000);
    }

    // Inisialisasi awal
    renderActiveAlerts();
    renderPaginatedAlerts();

}); // Akhir DOMContentLoaded

// =========================================================================
// BAGIAN 4: WAKTU & TANGGAL SISTEM (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk waktu dan tanggal
    const systemTime = document.getElementById("systemTime");
    const systemDate = document.getElementById("systemDate");

    /**
     * @function updateSystemTime
     * @description Memperbarui tampilan waktu dan tanggal sistem pada elemen DOM terkait.
     */
    function updateSystemTime() {
        const now = new Date();

        if (systemTime) {
            // Format Waktu: HH:MM:SS (24 jam)
            systemTime.textContent = now.toLocaleTimeString("en-US", { hour12: false });
        }
        if (systemDate) {
            // Format Tanggal: Short Month, Day, Year (e.g., May 5, 2025)
            systemDate.textContent = now.toLocaleDateString("en-US", {
                month: "short",
                day: "numeric",
                year: "numeric",
            });
        }
    }
    /**
     * @description Akhir dari fungsi updateSystemTime.
     */

    // Panggil fungsi sekali saat load untuk menampilkan waktu awal
    updateSystemTime();
    // Set interval untuk memperbarui waktu setiap detik
    setInterval(updateSystemTime, 1000);
}); // Akhir dari DOMContentLoaded untuk Waktu & Tanggal


// =========================================================================
// BAGIAN 5: UPTIME & TIMEZONE (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk uptime dan timezone
    const uptimeDisplay = document.getElementById("uptime");
    const timezoneDisplay = document.getElementById("timezone");

    // Waktu mulai aplikasi (saat script ini dieksekusi)
    const startTime = new Date();

    /**
     * @function formatDuration
     * @description Mengubah durasi dalam milidetik menjadi format "Xd HH:MM:SS".
     * @param {number} ms - Durasi dalam milidetik.
     * @returns {string} String durasi yang diformat.
     */
    function formatDuration(ms) {
        let seconds = Math.floor((ms / 1000) % 60);
        let minutes = Math.floor((ms / (1000 * 60)) % 60); // Perbaikan pembagi menit
        let hours = Math.floor((ms / (1000 * 60 * 60)) % 24); // Perbaikan pembagi jam
        let days = Math.floor(ms / (1000 * 60 * 60 * 24));

        // Pastikan format 2 digit untuk jam, menit, detik
        const paddedHours = String(hours).padStart(2, '0');
        const paddedMinutes = String(minutes).padStart(2, '0');
        const paddedSeconds = String(seconds).padStart(2, '0');

        return `${days}d ${paddedHours}:${paddedMinutes}:${paddedSeconds}`;
    }
    /**
     * @description Akhir dari fungsi formatDuration.
     */

    /**
     * @function updateUptime
     * @description Menghitung dan memperbarui tampilan uptime sistem/aplikasi.
     */
    function updateUptime() {
        if (!uptimeDisplay) return; // Cek jika elemen ada

        const now = new Date();
        const diff = now - startTime; // Selisih waktu dalam milidetik
        uptimeDisplay.textContent = formatDuration(diff);
    }
    /**
     * @description Akhir dari fungsi updateUptime.
     */

    /**
     * @function updateTimezone
     * @description Mendapatkan dan memperbarui tampilan timezone lokal dalam format UTC offset.
     */
    function updateTimezone() {
        if (!timezoneDisplay) return; // Cek jika elemen ada

        // Mendapatkan offset timezone dalam menit dari UTC
        const offsetMin = new Date().getTimezoneOffset();
        // Hitung jam dan menit dari offset
        const offsetHrsAbs = Math.abs(Math.floor(offsetMin / 60));
        const offsetMinsAbs = Math.abs(offsetMin % 60);
        // Tentukan tanda (+ atau -) berdasarkan nilai offset
        const sign = offsetMin <= 0 ? "+" : "-"; // Perhatikan: getTimezoneOffset() positif untuk zona waktu di belakang UTC

        // Format offset menjadi UTC±HH:MM
        const formattedOffset = `UTC${sign}${String(offsetHrsAbs).padStart(2, '0')}:${String(offsetMinsAbs).padStart(2, '0')}`;
        timezoneDisplay.textContent = formattedOffset;
    }
    /**
     * @description Akhir dari fungsi updateTimezone.
     */

    // Jalankan pembaruan awal saat halaman dimuat
    updateUptime();
    updateTimezone();

    // Set interval untuk memperbarui uptime setiap detik
    setInterval(updateUptime, 1000);
    // Timezone biasanya tidak berubah, jadi tidak perlu di-update terus menerus,
    // tapi bisa dipanggil lagi jika ada event perubahan timezone (jarang terjadi).
}); // Akhir dari DOMContentLoaded untuk Uptime & Timezone


// =========================================================================
// BAGIAN 6: TOMBOL AKSI CEPAT (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Ambil elemen tombol
    const btnSecurityScan = document.getElementById("btnSecurityScan");
    const btnSyncData = document.getElementById("btnSyncData");
    const btnBackup = document.getElementById("btnBackup");
    const btnConsole = document.getElementById("btnConsole");

    // Cek apakah ipcRenderer tersedia (di Electron) dan definisikan jika ya
    const isElectronContext = typeof require === "function";
    const ipcRenderer = isElectronContext ? require("electron").ipcRenderer : undefined;

    /**
     * @function showToastActions
     * @description Menampilkan notifikasi toast sementara di pojok kanan bawah.
     * @param {string} message - Pesan yang akan ditampilkan.
     */
    function showToastActions(message) {
        const toast = document.createElement("div");
        // Style toast (fixed position)
        toast.className = "fixed bottom-5 right-5 bg-slate-800 text-slate-200 px-4 py-2 rounded-md shadow-lg text-sm font-mono border border-slate-700 z-50 animate-fade-in-action"; // Gunakan animasi khusus jika perlu
        toast.textContent = message;
        document.body.appendChild(toast);

        // Hapus toast setelah beberapa detik
        setTimeout(() => {
            toast.classList.add("opacity-0", "transition-opacity", "duration-300"); // Tambahkan transisi opacity
            setTimeout(() => toast.remove(), 300); // Hapus setelah transisi
        }, 2000); // Durasi tampil: 2 detik
    }
    /**
     * @description Akhir dari fungsi showToastActions.
     */

    /**
     * @function appendToConsole
     * @description Menambahkan baris teks ke output console modal.
     * @param {string} htmlContent - Teks atau HTML yang akan ditambahkan.
     */
    function appendToConsole(htmlContent) {
        const outputArea = document.getElementById("consoleOutput");
        if (outputArea) {
            const line = document.createElement("div");
            line.innerHTML = htmlContent; // Gunakan innerHTML untuk memungkinkan styling span
            outputArea.appendChild(line);
            // Auto-scroll ke bawah
            outputArea.scrollTop = outputArea.scrollHeight;
        }
    }
    /**
     * @description Akhir dari fungsi appendToConsole.
     */

    // Inject CSS untuk animasi jika belum ada
    if (!document.getElementById("actionAnimations")) {
        const styleSheet = document.createElement("style");
        styleSheet.id = "actionAnimations";
        styleSheet.type = "text/css";
        styleSheet.innerText = `
            @keyframes fade-in-action {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .animate-fade-in-action {
                animation: fade-in-action 0.3s ease-out forwards;
            }
            .animate-spin {
                animation: spin 1s linear infinite;
            }
            @keyframes spin {
                from { transform: rotate(0deg); }
                to { transform: rotate(360deg); }
            }
            /* Tambahkan style untuk opacity transition pada toast */
            .opacity-0 { opacity: 0; }
            .transition-opacity { transition: opacity 0.3s ease-out; }
        `;
        document.head.appendChild(styleSheet);
    }

    // Tambahkan area log untuk hasil scan jika belum ada
    const quickActionsCard = document.querySelector("#btnSecurityScan")?.closest(".p-4"); // Cari parent card
    if (quickActionsCard && !document.getElementById("scanResultLog")) {
        const logArea = document.createElement("div");
        logArea.id = "scanResultLog";
        logArea.className = "mt-4 text-xs font-mono text-slate-400 bg-slate-800/50 p-3 rounded border border-slate-700/50 overflow-y-auto max-h-32"; // Sesuaikan tinggi maks
        logArea.innerHTML = `<div class="text-slate-500 italic">Hasil scan akan muncul di sini...</div>`;
        // Masukkan setelah grid tombol (atau sesuaikan posisi)
        const gridContainer = btnSecurityScan.closest(".grid");
        if (gridContainer && gridContainer.nextSibling) {
             gridContainer.parentNode.insertBefore(logArea, gridContainer.nextSibling);
        } else if (gridContainer) {
             gridContainer.parentNode.appendChild(logArea);
        } else {
            // Fallback jika struktur berbeda
            quickActionsCard.appendChild(logArea);
        }
    }
    const scanResultLog = document.getElementById("scanResultLog"); // Ambil elemen log

    // --- Event Listener untuk Tombol Security Scan ---
    if (btnSecurityScan) {
        btnSecurityScan.addEventListener("click", () => {
            const span = btnSecurityScan.querySelector("span");
            const originalText = span ? span.textContent : "Security Scan"; // Simpan teks asli
            const icon = btnSecurityScan.querySelector("svg"); // Ambil ikon jika ada

            // Nonaktifkan tombol dan ubah teks/ikon
            btnSecurityScan.disabled = true;
            if (span) span.textContent = "Scanning...";
            if (icon) icon.classList.add("animate-spin"); // Tambahkan animasi putar jika ada ikon

            // Dapatkan atau buat container progress bar
            let progressContainer = document.getElementById("scanProgressContainer");
            let progressBar = document.getElementById("scanProgressBar");
            let progressText = document.getElementById("scanProgressText");

            if (!progressContainer) {
                progressContainer = document.createElement("div");
                progressContainer.id = "scanProgressContainer";
                progressContainer.className = "mt-2 w-full"; // Margin top
                progressContainer.innerHTML = `
                    <div class="w-full bg-slate-800/50 rounded-full h-1.5 mb-1 dark:bg-gray-700">
                        <div id="scanProgressBar" class="bg-gradient-to-r from-cyan-500 to-blue-500 h-1.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <div class="text-right text-xs text-slate-500">
                        <span id="scanProgressText">0%</span>
                    </div>
                `;
                // Masukkan progress bar setelah tombol (dalam grid atau setelahnya)
                 const gridContainer = btnSecurityScan.closest(".grid");
                 if (gridContainer) {
                     gridContainer.insertAdjacentElement("afterend", progressContainer);
                 } else {
                     btnSecurityScan.insertAdjacentElement("afterend", progressContainer);
                 }
                progressBar = document.getElementById("scanProgressBar");
                progressText = document.getElementById("scanProgressText");
            } else {
                 // Jika sudah ada, reset dan tampilkan
                 progressContainer.classList.remove("hidden");
                 progressBar = document.getElementById("scanProgressBar");
                 progressText = document.getElementById("scanProgressText");
                 if(progressBar) progressBar.style.width = "0%";
                 if(progressText) progressText.textContent = "0%";
            }

            // Mulai animasi progress bar (simulasi)
            let width = 0;
            const interval = setInterval(() => {
                if (!progressBar || !progressText) { // Hentikan jika elemen hilang
                    clearInterval(interval);
                    return;
                }
                width += Math.random() * 5 + 1; // Kenaikan acak agar lebih realistis
                width = Math.min(width, 99); // Jangan sampai 100% sebelum selesai
                progressBar.style.width = `${width}%`;
                progressText.textContent = `${Math.floor(width)}%`;
                if (width >= 99 && !isElectronContext) { // Hentikan jika simulasi browser
                    clearInterval(interval);
                }
            }, 150); // Interval update progress

            // Kirim event ke Electron atau jalankan simulasi
            if (isElectronContext && ipcRenderer) {
                ipcRenderer.send("start-security-scan");

                // Listener HANYA SEKALI untuk hasil scan
                ipcRenderer.once("security-scan-result", (event, result) => {
                    clearInterval(interval); // Hentikan animasi progress

                    // Set progress ke 100%
                    if (progressBar) progressBar.style.width = "100%";
                    if (progressText) progressText.textContent = "100%";

                     // Tampilkan hasil di log
                    if (scanResultLog) {
                        if (scanResultLog.querySelector(".italic")) { // Hapus pesan awal
                            scanResultLog.innerHTML = '';
                        }
                        const line = document.createElement("div");
                        line.className = `whitespace-pre-wrap ${result.success ? 'text-green-400' : 'text-red-400'}`;
                        line.textContent = `[${new Date().toLocaleTimeString()}] ${result.message || (result.success ? 'Scan complete, no threats found.' : 'Threats detected!')}`;
                        scanResultLog.appendChild(line);
                        scanResultLog.scrollTop = scanResultLog.scrollHeight; // Scroll ke bawah
                    }

                    // Sembunyikan progress bar dan kembalikan tombol setelah jeda
                    setTimeout(() => {
                        if (progressContainer) progressContainer.classList.add("hidden");
                        if (span) span.textContent = originalText;
                        if (icon) icon.classList.remove("animate-spin");
                        btnSecurityScan.disabled = false;
                    }, 1500); // Jeda sebelum reset

                    // Tampilkan toast hasil
                    showToastActions(result.success ? "✅ Scan Complete" : "⚠️ Potential Threat Detected!");
                });
            } else {
                // Simulasi jika bukan di Electron
                console.warn("Simulating security scan (browser mode)...");
                const fakeScanSuccess = Math.random() < 0.85; // 85% simulasi sukses
                const fakeMessage = fakeScanSuccess
                    ? "Simulation: No threats found during scan."
                    : "Simulation: Suspicious file detected (example.dll)!";

                setTimeout(() => { // Simulasi waktu scan
                    clearInterval(interval); // Hentikan progress

                    // Set progress ke 100%
                    if (progressBar) progressBar.style.width = "100%";
                    if (progressText) progressText.textContent = "100%";

                    // Tampilkan hasil di log
                    if (scanResultLog) {
                        if (scanResultLog.querySelector(".italic")) {
                             scanResultLog.innerHTML = '';
                         }
                        const line = document.createElement("div");
                        line.className = `whitespace-pre-wrap ${fakeScanSuccess ? 'text-green-400' : 'text-red-400'}`;
                        line.textContent = `[${new Date().toLocaleTimeString()}] ${fakeMessage}`;
                        scanResultLog.appendChild(line);
                        scanResultLog.scrollTop = scanResultLog.scrollHeight;
                    }

                    // Sembunyikan progress bar dan kembalikan tombol
                    setTimeout(() => {
                         if (progressContainer) progressContainer.classList.add("hidden");
                         if (span) span.textContent = originalText;
                         if (icon) icon.classList.remove("animate-spin");
                         btnSecurityScan.disabled = false;
                    }, 1500);

                    // Tampilkan toast hasil simulasi
                    showToastActions(fakeScanSuccess ? "🛡️ Scan simulation complete." : "⚠️ Simulated threat found!");

                }, Math.random() * 2000 + 3000); // Durasi simulasi 3-5 detik
            }
        });
    }

    // --- Event Listener untuk Tombol Sync Data ---
    if (btnSyncData) {
        btnSyncData.addEventListener("click", () => {
            const span = btnSyncData.querySelector("span");
            const icon = btnSyncData.querySelector("svg");
            const originalText = span ? span.textContent : "Sync Data";

            // Ubah tampilan tombol menjadi loading
            btnSyncData.disabled = true;
            if (span) span.textContent = "Syncing...";
            if (icon) icon.classList.add("animate-spin");

            // Kirim event ke Electron atau simulasi
            if (isElectronContext && ipcRenderer) {
                ipcRenderer.send("start-data-sync");

                // Listener HANYA SEKALI untuk hasil sync
                ipcRenderer.once("sync-complete", (event, result) => {
                    const success = !(result && result.success === false); // Anggap sukses jika tidak ada info gagal
                    const message = result && result.message ? result.message : (success ? "Data synced successfully." : "Sync failed.");

                     if (span) span.textContent = success ? "✅ Synced" : "❌ Sync Failed";
                     showToastActions(success ? "🔄 Sync successful!" : "⚠️ Sync error!");

                     // Kembalikan tombol setelah jeda
                    setTimeout(() => {
                        if (span) span.textContent = originalText;
                        if (icon) icon.classList.remove("animate-spin");
                        btnSyncData.disabled = false;
                    }, 2000);
                });

                // Timeout fallback jika tidak ada respons dari main process
                setTimeout(() => {
                     if (btnSyncData.disabled && span && span.textContent === "Syncing...") {
                         console.error("Sync operation timed out.");
                         if (span) span.textContent = "Timeout";
                         showToastActions("⌛ Sync timed out.");
                         setTimeout(() => {
                            if (span) span.textContent = originalText;
                            if (icon) icon.classList.remove("animate-spin");
                             btnSyncData.disabled = false;
                         }, 2000);
                     }
                }, 15000); // Timeout 15 detik

            } else {
                // Simulasi jika bukan di Electron
                console.warn("Simulating data sync (browser mode)...");
                setTimeout(() => {
                    if (span) span.textContent = "✅ Synced";
                    showToastActions("🔄 Sync simulation complete!");

                    // Kembalikan tombol setelah jeda
                    setTimeout(() => {
                        if (span) span.textContent = originalText;
                        if (icon) icon.classList.remove("animate-spin");
                        btnSyncData.disabled = false;
                    }, 2000);
                }, 1500 + Math.random() * 1000); // Simulasi 1.5 - 2.5 detik
            }
        });
    }

    // --- Event Listener untuk Tombol Backup ---
    if (btnBackup) {
        btnBackup.addEventListener("click", () => {
            const span = btnBackup.querySelector("span");
            const originalText = span ? span.textContent : "Backup";
            const icon = btnBackup.querySelector("svg");

            // Nonaktifkan tombol dan ubah teks
            btnBackup.disabled = true;
            if (span) span.textContent = "Backing up...";
            if (icon) icon.classList.add("animate-spin"); // Tambahkan animasi jika ada ikon

            // Dapatkan atau buat progress bar untuk backup
            let backupProgressContainer = document.getElementById("backupProgressContainer");
            let backupProgressBarFill = document.getElementById("backupProgressBarFill");

            if (!backupProgressContainer) {
                 backupProgressContainer = document.createElement("div");
                 backupProgressContainer.id = "backupProgressContainer";
                 backupProgressContainer.className = "w-full h-1 bg-slate-700 mt-2 rounded overflow-hidden";
                 backupProgressContainer.innerHTML = `<div id="backupProgressBarFill" class="h-full bg-cyan-500 w-0 transition-width duration-300 ease-linear"></div>`; // ID untuk fill div
                 // Masukkan progress bar di dalam tombol atau setelahnya
                 const container = btnBackup.querySelector("div") || btnBackup; // Target di dalam tombol jika ada div
                 container.appendChild(backupProgressContainer);
                 backupProgressBarFill = document.getElementById("backupProgressBarFill");
            } else {
                 backupProgressContainer.classList.remove("hidden");
                 backupProgressBarFill = document.getElementById("backupProgressBarFill");
                 if (backupProgressBarFill) backupProgressBarFill.style.width = "0%";
            }

            // Mulai animasi progress bar (simulasi)
             let width = 0;
             const interval = setInterval(() => {
                 if (!backupProgressBarFill) { // Hentikan jika elemen hilang
                     clearInterval(interval);
                     return;
                 }
                 width += Math.random() * 8 + 2; // Kenaikan acak
                 width = Math.min(width, 100);
                 backupProgressBarFill.style.width = `${width}%`;
                 if (width >= 100) {
                     clearInterval(interval);
                     // Jangan ubah teks di sini jika menunggu konfirmasi IPC
                 }
             }, 200); // Interval update

            // Kirim event ke Electron atau simulasi
            if (isElectronContext && ipcRenderer) {
                 ipcRenderer.send("start-backup");

                 // Listener HANYA SEKALI untuk hasil backup
                 ipcRenderer.once("backup-complete", (event, result) => {
                     clearInterval(interval); // Hentikan animasi progress
                     if (backupProgressBarFill) backupProgressBarFill.style.width = "100%"; // Pastikan 100%

                     const success = !(result && result.success === false);
                     const message = result && result.message ? result.message : (success ? "Backup completed successfully." : "Backup failed.");

                     if (span) span.textContent = success ? "✅ Backup Done" : "❌ Backup Failed";
                     showToastActions(success ? "💾 Backup successful!" : "⚠️ Backup error!");

                     // Sembunyikan progress bar dan kembalikan tombol setelah jeda
                     setTimeout(() => {
                         if (backupProgressContainer) backupProgressContainer.classList.add("hidden");
                         if (span) span.textContent = originalText;
                          if (icon) icon.classList.remove("animate-spin");
                         btnBackup.disabled = false;
                     }, 2000);
                 });

                 // Timeout fallback
                  setTimeout(() => {
                      if (btnBackup.disabled && span && span.textContent === "Backing up...") {
                          console.error("Backup operation timed out.");
                          clearInterval(interval);
                           if (span) span.textContent = "Timeout";
                          showToastActions("⌛ Backup timed out.");
                          setTimeout(() => {
                             if (backupProgressContainer) backupProgressContainer.classList.add("hidden");
                             if (span) span.textContent = originalText;
                             if (icon) icon.classList.remove("animate-spin");
                              btnBackup.disabled = false;
                          }, 2000);
                      }
                 }, 20000); // Timeout 20 detik

            } else {
                // Simulasi jika bukan di Electron
                console.warn("Simulating backup (browser mode)...");
                // Tunggu interval selesai atau timeout simulasi
                 const simulationDuration = Math.random() * 2000 + 3000; // 3-5 detik
                 setTimeout(() => {
                    if (backupProgressBarFill && parseFloat(backupProgressBarFill.style.width) < 100) {
                        clearInterval(interval); // Hentikan jika belum 100%
                        if (backupProgressBarFill) backupProgressBarFill.style.width = "100%";
                    }
                    // Pastikan interval sudah selesai sebelum lanjut
                     setTimeout(()=> {
                        if (span) span.textContent = "✅ Backup Done";
                        showToastActions("💾 Backup simulation completed.");

                        // Sembunyikan progress bar dan kembalikan tombol
                        setTimeout(() => {
                            if (backupProgressContainer) backupProgressContainer.classList.add("hidden");
                            // Hapus progress bar dari DOM agar tidak menumpuk
                            // if (backupProgressContainer) backupProgressContainer.remove();
                            if (span) span.textContent = originalText;
                             if (icon) icon.classList.remove("animate-spin");
                            btnBackup.disabled = false;
                        }, 2000);
                    }, 100); // Jeda kecil

                }, simulationDuration);
            }
        });
    }

    // --- Event Listener untuk Tombol Console ---
    if (btnConsole) {
        // Cek atau buat modal console
        let consoleModal = document.getElementById("consoleModal");

        if (!consoleModal) {
            consoleModal = document.createElement("div");
            consoleModal.id = "consoleModal";
            // Modal container: full screen, background semi-transparan, flex center
            consoleModal.className = "fixed inset-0 hidden items-center justify-center bg-black/70 z-50 p-4 backdrop-blur-sm";
            // Modal content: background gelap, border, rounded, ukuran maks, flex column
            consoleModal.innerHTML = `
                <div class="bg-slate-900 border border-slate-700 rounded-lg w-full max-w-2xl max-h-[80vh] flex flex-col shadow-xl">
                    <div class="p-3 bg-slate-800 border-b border-slate-700 flex justify-between items-center rounded-t-lg">
                        <span class="text-sm font-mono text-cyan-400 flex items-center">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 21h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>
                           root@server:~#
                        </span>
                        <button id="closeConsoleBtn" title="Close Console" class="text-lg text-slate-400 hover:text-red-500 transition-colors">&times;</button>
                    </div>
                    <div id="consoleOutput" class="flex-1 p-3 overflow-y-auto font-mono text-sm text-slate-300 space-y-1 h-64 bg-black/20">
                       <div class="text-yellow-500">Welcome to the simulated console. Type 'help' for commands.</div>
                    </div>
                    <div class="p-2 bg-slate-800 border-t border-slate-700 flex items-center rounded-b-lg">
                       <span class="text-cyan-400 font-mono text-sm mr-1">$</span>
                       <input id="consoleInput" type="text" placeholder="Enter command..." class="w-full bg-transparent outline-none text-slate-200 text-sm font-mono" autocomplete="off" />
                    </div>
                </div>
            `;
            document.body.appendChild(consoleModal);
        }

        // Ambil elemen-elemen di dalam modal
        const closeBtn = document.getElementById("closeConsoleBtn");
        const consoleInput = document.getElementById("consoleInput");
        const consoleOutput = document.getElementById("consoleOutput");

        // Event listener untuk membuka modal
        btnConsole.addEventListener("click", () => {
            if (consoleModal) {
                consoleModal.classList.remove("hidden");
                consoleModal.classList.add("flex"); // Gunakan flex untuk centering
                 if(consoleInput) consoleInput.focus(); // Fokus ke input saat dibuka
            }
        });

        // Event listener untuk menutup modal
        if (closeBtn) {
            closeBtn.addEventListener("click", () => {
                if (consoleModal) {
                     consoleModal.classList.add("hidden");
                     consoleModal.classList.remove("flex");
                }
            });
        }
         // Event listener untuk menutup modal jika klik di luar area konten
         if (consoleModal) {
             consoleModal.addEventListener('click', (event) => {
                 // Cek jika target klik adalah background modal itu sendiri
                 if (event.target === consoleModal) {
                     consoleModal.classList.add("hidden");
                     consoleModal.classList.remove("flex");
                 }
             });
         }


        // Event listener untuk input command
        if (consoleInput && consoleOutput) {
            consoleInput.addEventListener("keydown", function (e) {
                if (e.key === "Enter") {
                    const cmd = consoleInput.value.trim();
                    consoleInput.value = ""; // Kosongkan input

                    // Tampilkan command yang diketik
                    appendToConsole(`<span class="text-gray-500">&gt;</span> ${cmd}`);

                    // Proses command (simulasi)
                    if (cmd === "help") {
                        appendToConsole("Available commands: help, ls, clear, date, whoami, ping [host], exit");
                    } else if (cmd === "ls") {
                        appendToConsole("<span class='text-blue-400'>backup.log</span>  config.yaml  <span class='text-green-400'>run.sh</span>  <span class='text-purple-400'>logs/</span>");
                    } else if (cmd === "whoami") {
                        appendToConsole("user: <span class='text-yellow-400'>admin</span>");
                    } else if (cmd === "date") {
                         appendToConsole(new Date().toString());
                    } else if (cmd === "clear") {
                        consoleOutput.innerHTML = '<div class="text-yellow-500">Console cleared.</div>'; // Beri pesan setelah clear
                    } else if (cmd.startsWith("ping ")) {
                         const host = cmd.substring(5);
                         appendToConsole(`Pinging ${host}...`);
                         setTimeout(() => appendToConsole(`Reply from ${host}: time=12ms TTL=64`), 500);
                         setTimeout(() => appendToConsole(`Reply from ${host}: time=15ms TTL=64`), 1000);
                    } else if (cmd === "exit") {
                         appendToConsole("Closing console...");
                         setTimeout(() => {
                            if (consoleModal) {
                                consoleModal.classList.add("hidden");
                                consoleModal.classList.remove("flex");
                            }
                         }, 500);
                    } else if (cmd === "") {
                        // Abaikan input kosong, tidak perlu output
                    } else {
                        appendToConsole(`<span class="text-red-500">Command not found:</span> ${cmd}`);
                    }
                }
            });
        }
    } // Akhir dari if (btnConsole)

}); // Akhir dari DOMContentLoaded untuk Tombol Aksi Cepat


// =========================================================================
// BAGIAN 7: ALOKASI SUMBER DAYA (Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Elemen DOM untuk bar dan persentase
    const procBar = document.getElementById("procBar");
    const memBar = document.getElementById("memBar");
    const netBar = document.getElementById("netBar");

    const procPercent = document.getElementById("procPercent");
    const memPercent = document.getElementById("memPercent");
    const netPercent = document.getElementById("netPercent");

    // Elemen DOM untuk slider prioritas
    const prioritySlider = document.getElementById("prioritySlider");
    const priorityValue = document.getElementById("priorityValue");

    // Inisialisasi nilai awal (variabel lokal untuk scope ini)
    let currentCpuUsage = 40; // Gunakan nama berbeda jika ada global
    let currentMemUsage = 68;
    let currentNetUsage = 35;

    /**
     * @function updateResourceUI
     * @description Memperbarui tampilan bar dan teks persentase untuk alokasi sumber daya.
     */
    function updateResourceUI() {
        // Update Processor Allocation
        if (procBar) procBar.style.width = `${currentCpuUsage}%`;
        if (procPercent) procPercent.textContent = `${currentCpuUsage.toFixed(0)}% allocated`;

        // Update Memory Allocation
        if (memBar) memBar.style.width = `${currentMemUsage}%`;
        if (memPercent) memPercent.textContent = `${currentMemUsage.toFixed(0)}% allocated`;

        // Update Network Allocation
        if (netBar) netBar.style.width = `${currentNetUsage}%`;
        if (netPercent) netPercent.textContent = `${currentNetUsage.toFixed(0)}% allocated`;
    }
    /**
     * @description Akhir dari fungsi updateResourceUI.
     */

    // Panggil update UI awal
    updateResourceUI();

    // --- Estimasi CPU Load menggunakan PerformanceObserver (jika didukung browser) ---
    if (typeof PerformanceObserver !== "undefined" && typeof performance !== "undefined") {
        let lastFrameTime = performance.now();
        const observer = new PerformanceObserver((list) => {
            const entries = list.getEntriesByName("task-measure", "measure"); // Dapatkan measure spesifik
            if (entries.length > 0) {
                 const entry = entries[entries.length - 1]; // Ambil yang terbaru
                const duration = entry.duration; // Durasi task
                const now = performance.now();
                const elapsed = now - lastFrameTime; // Waktu sejak frame terakhir

                // Estimasi CPU load kasar berdasarkan rasio waktu task terhadap waktu frame
                // Dibatasi agar tidak terlalu ekstrem dan lebih halus
                const estimatedLoad = Math.min(95, Math.max(10, (duration / elapsed) * 100 * 1.5)); // Kalibrasi multiplier
                // Gunakan Exponential Moving Average (EMA) untuk menghaluskan nilai
                currentCpuUsage = currentCpuUsage * 0.8 + estimatedLoad * 0.2;
                currentCpuUsage = Math.round(currentCpuUsage); // Bulatkan

                lastFrameTime = now;
                // Update UI setelah perhitungan CPU
                // updateResourceUI(); // Dipanggil di interval simulasi saja agar tidak terlalu sering
            }
        });

        try {
             observer.observe({ entryTypes: ["measure"] });
        } catch (e) {
            console.warn("PerformanceObserver couldn't observe 'measure'. CPU estimation might be less accurate.", e);
        }

        // Jalankan task ringan secara berkala untuk diukur oleh PerformanceObserver
        setInterval(() => {
             performance.mark("start-task-measure");
             // Simulasi pekerjaan CPU (loop sederhana)
             let result = 0;
             for (let i = 0; i < 5e5; i++) { // Kurangi iterasi agar tidak terlalu berat
                 result += Math.sqrt(i);
             }
             performance.mark("end-task-measure");
             try {
                performance.measure("task-measure", "start-task-measure", "end-task-measure");
             } catch(e) {
                // abaikan error jika mark sudah ada atau dihapus
             }

        }, 500); // Jalankan task pengukuran setiap 500ms

    } else {
        console.warn("PerformanceObserver or performance API not fully supported. Using basic CPU simulation.");
        // Fallback simulasi CPU jika PerformanceObserver tidak ada
         setInterval(() => {
            currentCpuUsage += (Math.random() - 0.5) * 8; // Fluktuasi lebih acak
            currentCpuUsage = Math.min(95, Math.max(10, currentCpuUsage));
            currentCpuUsage = Math.round(currentCpuUsage);
        }, 2000);
    }


    // --- Simulasi Perubahan Memori dan Jaringan ---
    setInterval(() => {
        // Simulasi fluktuasi Memori
        currentMemUsage += (Math.random() * 6 - 3); // Fluktuasi -3 sampai +3
        currentMemUsage = Math.max(30, Math.min(90, currentMemUsage)); // Batasi 30-90%

        // Simulasi fluktuasi Jaringan
        currentNetUsage += (Math.random() * 8 - 4); // Fluktuasi -4 sampai +4
        currentNetUsage = Math.max(5, Math.min(75, currentNetUsage)); // Batasi 5-75%

        // Update UI secara berkala
        updateResourceUI();
    }, 2000); // Update simulasi Mem/Net setiap 2 detik

    // --- Event Listener untuk Slider Prioritas ---
    if (prioritySlider && priorityValue) {
        // Set nilai awal teks slider
        priorityValue.textContent = `${prioritySlider.value}/5`;

        // Update teks saat nilai slider berubah
        prioritySlider.addEventListener("input", function () {
            priorityValue.textContent = `${this.value}/5`;
            // Di sini bisa ditambahkan logika untuk mengirim perubahan prioritas
            // console.log(`Priority set to: ${this.value}`);
            // if (isElectronContext && ipcRenderer) {
            //     ipcRenderer.send('set-resource-priority', this.value);
            // }
        });
    }
}); // Akhir dari DOMContentLoaded untuk Alokasi Sumber Daya


// =========================================================================
// BAGIAN 8: PENGATURAN SISTEM (TOGGLES - Dalam DOMContentLoaded)
// =========================================================================
document.addEventListener("DOMContentLoaded", function () {
    // Ambil elemen toggle
    const powerManagementToggle = document.getElementById("powerManagementToggle");
    const securityProtocolToggle = document.getElementById("securityProtocolToggle");
    const powerSavingModeToggle = document.getElementById("powerSavingModeToggle");
    const autoShutdownToggle = document.getElementById("autoShutdownToggle");

    // Variabel lokal untuk log aktivitas dan timeout shutdown
    let activityLog = [];
    let shutdownTimeout = null; // Untuk menyimpan ID timeout auto shutdown

    /**
     * @function showToastSettings
     * @description Menampilkan notifikasi toast sementara (versi untuk settings).
     * @param {string} message - Pesan yang akan ditampilkan.
     * @param {string} [type="info"] - Tipe notifikasi ('info', 'success', 'warning', 'danger').
     */
    function showToastSettings(message, type = "info") {
        const colors = {
            info: "bg-slate-800 border-slate-700 text-slate-200",
            success: "bg-green-900/30 border-green-800 text-green-300",
            warning: "bg-yellow-900/30 border-yellow-800 text-yellow-300",
            danger: "bg-red-900/30 border-red-800 text-red-300"
        };

        const toast = document.createElement("div");
        // Gunakan style fixed yang sama seperti di Actions
        toast.className = `fixed bottom-5 right-5 ${colors[type]} px-4 py-2 rounded-md shadow-lg text-sm font-mono border z-50 animate-fade-in-action`; // Re-use animasi
        toast.textContent = message;
        document.body.appendChild(toast);

        // Hapus toast setelah beberapa detik
        setTimeout(() => {
            toast.classList.add("opacity-0", "transition-opacity", "duration-300");
            setTimeout(() => toast.remove(), 300);
        }, 2500); // Durasi tampil sedikit lebih lama: 2.5 detik

        // Tambahkan juga ke log internal
        addLog(message);
    }
    /**
     * @description Akhir dari fungsi showToastSettings.
     */

    /**
     * @function addLog
     * @description Menambahkan entri log ke array activityLog dengan timestamp.
     * @param {string} message - Pesan log.
     */
    function addLog(message) {
        const timestamp = new Date().toLocaleTimeString();
        const logEntry = `[${timestamp}] ${message}`;
        activityLog.push(logEntry);
        // console.log("Activity Log:", logEntry); // Tampilkan di console jika perlu debug
        // Batasi ukuran log jika perlu
        if (activityLog.length > 100) {
            activityLog.shift(); // Hapus log terlama
        }
    }
    /**
     * @description Akhir dari fungsi addLog.
     */

    /**
     * @function toggleVisualEffect
     * @description Menambah atau menghapus efek visual (ring border) pada elemen parent toggle.
     * @param {HTMLElement} element - Elemen toggle (input checkbox).
     * @param {boolean} isActive - Status aktif toggle.
     */
    function toggleVisualEffect(element, isActive) {
        // Cari elemen parent terdekat yang memiliki class 'border' untuk diberi efek ring
        const parentBorder = element.closest(".border");
        if (parentBorder) {
            if (isActive) {
                // Tambahkan kelas untuk efek aktif (misal: ring biru)
                parentBorder.classList.add("ring-2", "ring-cyan-500/50", "border-cyan-600/70");
                 parentBorder.classList.remove("border-slate-700"); // Hapus border default
            } else {
                // Hapus kelas efek aktif dan kembalikan border default
                parentBorder.classList.remove("ring-2", "ring-cyan-500/50", "border-cyan-600/70");
                 parentBorder.classList.add("border-slate-700");
            }
        }
    }
    /**
     * @description Akhir dari fungsi toggleVisualEffect.
     */

    /**
     * @function simulateAsyncAction
     * @description Mensimulasikan aksi asynchronous (misalnya API call) dengan delay.
     * @param {string} actionName - Nama aksi untuk logging.
     * @param {number} [duration=1000] - Durasi simulasi dalam milidetik.
     * @returns {Promise<string>} Promise yang resolve dengan pesan sukses.
     */
    function simulateAsyncAction(actionName, duration = 1000) {
        // console.log(`Starting async action: ${actionName}...`);
        return new Promise(resolve => {
            setTimeout(() => {
                const message = `${actionName} configuration applied successfully.`;
                // console.log(`Finished async action: ${actionName}`);
                resolve(message);
            }, duration);
        });
    }
    /**
     * @description Akhir dari fungsi simulateAsyncAction.
     */

    // --- Event Listener untuk Toggle Power Management ---
    if (powerManagementToggle) {
        // Set visual awal berdasarkan state checked
        toggleVisualEffect(powerManagementToggle, powerManagementToggle.checked);

        powerManagementToggle.addEventListener("change", async function () {
            const isActive = this.checked;
            toggleVisualEffect(this, isActive); // Update visual

            this.disabled = true; // Nonaktifkan sementara
            const actionName = isActive ? "Power Management Activation" : "Power Management Deactivation";
            const toastMessage = isActive ? "⚡ Power Management: Activated — Optimizing..." : "🛑 Power Management: Deactivated";
            const toastType = isActive ? "success" : "warning";

            showToastSettings(toastMessage, toastType);
            try {
                 const result = await simulateAsyncAction(actionName, isActive ? 1200 : 800);
                 addLog(result); // Log hasil sukses
            } catch (error) {
                 console.error(`${actionName} failed:`, error);
                 showToastSettings(`Error during ${actionName}`, "danger");
            } finally {
                 this.disabled = false; // Aktifkan kembali toggle
            }
        });
    }

    // --- Event Listener untuk Toggle Security Protocol ---
    if (securityProtocolToggle) {
         // Set visual awal
         toggleVisualEffect(securityProtocolToggle, securityProtocolToggle.checked);

         securityProtocolToggle.addEventListener("change", async function () {
             const isActive = this.checked;
             toggleVisualEffect(this, isActive);

             this.disabled = true;
             const actionName = isActive ? "Security Protocol Enhancement" : "Security Protocol Relaxation";
             const toastMessage = isActive ? "🔐 Security Protocol: Enhanced" : "🔓 Security Protocol: Standard";
             const toastType = isActive ? "success" : "warning";

             showToastSettings(toastMessage, toastType);
             try {
                const result = await simulateAsyncAction(actionName, 1000);
                 addLog(result);
             } catch(error) {
                console.error(`${actionName} failed:`, error);
                showToastSettings(`Error during ${actionName}`, "danger");
             } finally {
                this.disabled = false;
             }
         });
     }

    // --- Event Listener untuk Toggle Power Saving Mode ---
    if (powerSavingModeToggle) {
         // Set visual awal
         toggleVisualEffect(powerSavingModeToggle, powerSavingModeToggle.checked);

         powerSavingModeToggle.addEventListener("change", async function () {
             const isActive = this.checked;
             toggleVisualEffect(this, isActive);

             this.disabled = true;
             const actionName = isActive ? "Entering Low-Power Mode" : "Leaving Low-Power Mode";
             const toastMessage = isActive ? "🌙 Power Saving Mode: Activated" : "💡 Power Saving Mode: Deactivated";
             const toastType = isActive ? "success" : "info";

             showToastSettings(toastMessage, toastType);
             try {
                const result = await simulateAsyncAction(actionName, isActive ? 1000 : 800);
                 addLog(result);
             } catch(error) {
                console.error(`${actionName} failed:`, error);
                showToastSettings(`Error during ${actionName}`, "danger");
             } finally {
                this.disabled = false;
             }
         });
     }

    // --- Event Listener untuk Toggle Auto Shutdown ---
    if (autoShutdownToggle) {
         // Set visual awal
         toggleVisualEffect(autoShutdownToggle, autoShutdownToggle.checked);

         autoShutdownToggle.addEventListener("change", async function () {
             const isActive = this.checked;
             toggleVisualEffect(this, isActive);

             if (isActive) {
                 // Aktifkan auto shutdown
                 const shutdownDelay = 30000; // 30 detik
                 showToastSettings(`⏰ Auto Shutdown: Activated — System will shut down in ${shutdownDelay / 1000} seconds`, "danger");
                 addLog(`Auto Shutdown scheduled in ${shutdownDelay / 1000} seconds.`);

                 // Hapus timeout sebelumnya jika ada
                 if (shutdownTimeout) clearTimeout(shutdownTimeout);

                 // Set timeout baru
                 shutdownTimeout = setTimeout(() => {
                     showToastSettings("🔴 SYSTEM SHUTDOWN INITIATED (SIMULATED)", "danger");
                     addLog("Simulated Auto Shutdown executed.");
                     // Di aplikasi nyata, di sini akan memanggil fungsi shutdown sistem
                     // Contoh: if (ipcRenderer) ipcRenderer.send('shutdown-system');

                     // Reset toggle secara visual setelah shutdown (simulasi)
                     this.checked = false;
                     toggleVisualEffect(this, false);
                     shutdownTimeout = null; // Reset ID timeout

                 }, shutdownDelay);

             } else {
                 // Batalkan auto shutdown jika dinonaktifkan
                 if (shutdownTimeout) {
                     clearTimeout(shutdownTimeout); // Batalkan timeout yang terjadwal
                     shutdownTimeout = null;
                     showToastSettings("⏸️ Auto Shutdown: Canceled", "info");
                     addLog("Auto Shutdown schedule canceled by user.");
                 } else {
                     // Jika tidak ada timeout aktif, tidak perlu notifikasi pembatalan
                     addLog("Auto Shutdown was not active.");
                 }
             }
         });
     }

    // Opsi untuk menampilkan log aktivitas di console secara berkala (untuk debug)
    const showActivityLogInConsole = false; // Ubah ke true jika ingin melihat log di console
    if (showActivityLogInConsole) {
        setInterval(() => {
             if (activityLog.length > 0) {
                console.groupCollapsed(`Activity Log (${activityLog.length} entries)`);
                console.table(activityLog.slice(-10)); // Tampilkan 10 log terakhir dalam tabel
                console.groupEnd();
             }
        }, 10000); // Tampilkan setiap 10 detik
    }

}); // Akhir dari DOMContentLoaded untuk Pengaturan Sistem





        // END: Variabel state

        // Performance chart
        let performanceData = {
            cpu: Array(20).fill(0).map(() => Math.random() * 100),
            memory: Array(20).fill(0).map(() => Math.random() * 100),
            network: Array(20).fill(0).map(() => Math.random() * 100),
        };

        function updatePerformanceChart() {
            performanceData.cpu.shift();
            performanceData.cpu.push(cpuUsage);
            performanceData.memory.shift();
            performanceData.memory.push(memoryUsage);
            performanceData.network.shift();
            performanceData.network.push(networkStatus);
            performanceChart.innerHTML = "";
            const maxPoints = 20;
            const barWidth = 100 / maxPoints;
            for (let i = 0; i < maxPoints; i++) {
                const cpuHeight = (performanceData.cpu[i] / 100) * 100;
                const memoryHeight = (performanceData.memory[i] / 100) * 100;
                const networkHeight = (performanceData.network[i] / 100) * 100;
                const div = document.createElement("div");
                div.className = "flex flex-col justify-end items-center";
                div.style.width = `${barWidth}%`;
                div.innerHTML = `
                    <div class="w-1/3 bg-cyan-500/50 rounded-t-sm" style="height: ${cpuHeight}%"></div>
                    <div class="w-1/3 bg-purple-500/50 rounded-t-sm" style="height: ${memoryHeight}%"></div>
                    <div class="w-1/3 bg-blue-500/50 rounded-t-sm" style="height: ${networkHeight}%"></div>
                `;
                performanceChart.appendChild(div);
            }
        }

        // Tab switching
        tabPerformance.addEventListener("click", () => {
            tabPerformance.classList.add("text-cyan-400", "bg-slate-700");
            tabProcesses.classList.remove("text-cyan-400", "bg-slate-700");
            tabStorage.classList.remove("text-cyan-400", "bg-slate-700");
            performanceTab.classList.remove("hidden");
            processesTab.classList.add("hidden");
            storageTab.classList.add("hidden");
        });
        tabProcesses.addEventListener("click", () => {
            tabProcesses.classList.add("text-cyan-400", "bg-slate-700");
            tabPerformance.classList.remove("text-cyan-400", "bg-slate-700");
            tabStorage.classList.remove("text-cyan-400", "bg-slate-700");
            processesTab.classList.remove("hidden");
            performanceTab.classList.add("hidden");
            storageTab.classList.add("hidden");
        });
        tabStorage.addEventListener("click", () => {
            tabStorage.classList.add("text-cyan-400", "bg-slate-700");
            tabPerformance.classList.remove("text-cyan-400", "bg-slate-700");
            tabProcesses.classList.remove("text-cyan-400", "bg-slate-700");
            storageTab.classList.remove("hidden");
            performanceTab.classList.add("hidden");
            processesTab.classList.add("hidden");
        });

        // Hitung skor perangkat pengguna
        function calculateDeviceScore() {
            const cores = navigator.hardwareConcurrency || 4;
            const memory = (navigator.deviceMemory || 4) * 1024; // dalam MB
            const isHighPerformance = window.matchMedia("(prefers-reduced-motion: no-preference)").matches;

            deviceScore = (cores * 10 + memory / 100) * (isHighPerformance ? 1.2 : 1);
            deviceScore = Math.min(deviceScore, 100); // Batas maksimal 100

            if (currentDeviceScore) {
                currentDeviceScore.textContent = deviceScore.toFixed(2);
            }
        }

        // Mulai proses mining
        function startMining() {
            if (!window.currentUser) {
                showToast("Error", "Please login to start mining", "destructive");
                authModal.style.display = "flex";
                return;
            }

            isMining = true;
            miningStatus.textContent = "Active";
            miningStatus.className = "inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-500/20 text-green-400 border border-green-500/50";

            toggleMiningBtn.textContent = "Stop Mining";

            miningInterval = setInterval(async () => {
                const miningSpeed = window.currentUser.profile.mining_speed || 1;
                const basePoints = (deviceScore / 100) * boosterSpeed * miningSpeed;
                points += basePoints;
                console.log(`Points earned: ${basePoints.toFixed(2)}, Total points: ${points.toFixed(2)}`);

                localStorage.setItem("mining_points", points.toString());

                if (userPoints) userPoints.textContent = points.toFixed(2);
                if (currentPoints) currentPoints.textContent = points.toFixed(2);

                try {
                    const { data, error } = await supabase
                        .from("profiles")
                        .select("points")
                        .eq("id", window.currentUser.id)
                        .single();
                    if (error) throw error;
                    if (data.points !== points) {
                        const { error: updateError } = await supabase
                            .from("profiles")
                            .update({ points })
                            .eq("id", window.currentUser.id);
                        if (updateError) throw updateError;
                        console.log(`Points synced to Supabase: ${points.toFixed(2)}`);
                    }
                } catch (error) {
                    showToast("Error", "Failed to sync points: " + error.message, "destructive");
                    console.error("Sync error:", error);
                }
            }, 5000);
        }

        // Hentikan proses mining
        function stopMining() {
            isMining = false;
            miningStatus.textContent = "Inactive";
            miningStatus.className = "inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-500/20 text-red-400 border border-red-500/50";

            toggleMiningBtn.textContent = "Start Mining";

            clearInterval(miningInterval);
            miningInterval = null;
        }

        // Enhanced Mining Toggle Button with Elegant UI
        toggleMiningBtn.addEventListener("click", (e) => {
            // Create ripple effect
            const ripple = document.createElement("span");
            ripple.className = "mining-ripple";
            ripple.style.left = `${e.clientX - e.target.getBoundingClientRect().left}px`;
            ripple.style.top = `${e.clientY - e.target.getBoundingClientRect().top}px`;
            e.target.appendChild(ripple);
            
            // Remove ripple after animation
            setTimeout(() => ripple.remove(), 600);
            
            // Toggle mining state with animations
            if (isMining) {
                toggleMiningBtn.classList.add("stopping");
                setTimeout(() => {
                    stopMining();
                    toggleMiningBtn.classList.remove("stopping");
                    toggleMiningBtn.classList.add("starting");
                    setTimeout(() => toggleMiningBtn.classList.remove("starting"), 300);
                }, 200);
            } else {
                toggleMiningBtn.classList.add("starting");
                setTimeout(() => {
                    startMining();
                    toggleMiningBtn.classList.remove("starting");
                }, 200);
            }
        });

        // === INISIALISASI SAAT HALAMAN SIAP ===
        document.addEventListener("DOMContentLoaded", async () => {
            // Inisialisasi skor perangkat
            calculateDeviceScore();

            // Inisialisasi boosterSpeed
            boosterSpeed = window.currentUser && window.currentUser.profile.booster ? boosterConfig[window.currentUser.profile.booster]?.speed || 1 : 1;

            // Inisialisasi poin dari Supabase atau localStorage
            if (window.currentUser && window.currentUser.profile) {
                points = window.currentUser.profile.points || 0;
            } else if (localStorage.getItem("mining_points")) {
                points = parseFloat(localStorage.getItem("mining_points")) || 0;
            } else {
                points = 0;
            }

            // Sinkronkan poin ke Supabase jika perlu
            if (window.currentUser) {
                try {
                    const { data, error } = await supabase
                        .from("profiles")
                        .select("points")
                        .eq("id", window.currentUser.id)
                        .single();
                    if (error) throw error;
                    if (data.points !== points) {
                        points = data.points; // Prioritaskan nilai dari Supabase
                        localStorage.setItem("mining_points", points.toString());
                    }
                } catch (error) {
                    console.error("Initial sync error:", error);
                }
            }

            // Tampilkan poin terakhir
            if (userPoints) userPoints.textContent = points.toFixed(2);
            if (currentPoints) currentPoints.textContent = points.toFixed(2);
        });
        //end of ini





//purchase booster
function showToast(title, description, variant = "default") {
  const toast = document.createElement("div");
  toast.className = `fixed bottom-4 right-4 p-4 rounded-md text-white shadow-lg ${
    variant === "destructive" ? "bg-red-600" : "bg-gradient-to-r from-cyan-600 to-blue-600"
  }`;
  toast.innerHTML = `
    <div class="flex items-start gap-3 max-w-xs">
      <i data-lucide="${variant === "destructive" ? "alert-circle" : "check-circle"}" 
         class="w-5 h-5 mt-0.5 flex-shrink-0"></i>
      <div>
        <div class="font-bold text-sm">${title}</div>
        <div class="text-xs opacity-90">${description}</div>
      </div>
    </div>
  `;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 3000);
}

async function handlePurchase(walletType, booster, price) {
  try {
    let provider, walletAddress;
    const toAddress = "0x597c2c69f5a3538e9809f563274a8f5168bc9907";

    switch (walletType) {
      case "metamask":
        provider = window.ethereum;
        if (!provider) throw new Error("MetaMask is not installed");
        const metaAccounts = await provider.request({ method: "eth_requestAccounts" });
        walletAddress = metaAccounts[0];
        await provider.request({
          method: "eth_sendTransaction",
          params: [{
            from: walletAddress,
            to: toAddress,
            value: (parseFloat(price) * 1e18).toString(16),
          }],
        });
        break;
      case "phantom":
        provider = window.solana;
        if (!provider || !provider.isPhantom) throw new Error("Phantom is not installed");
        const { publicKey } = await provider.connect();
        walletAddress = publicKey.toString();
        throw new Error("Phantom purchases require a cross-chain bridge");
      case "okx":
        provider = window.okxwallet;
        if (!provider) throw new Error("OKX Wallet is not installed");
        const okxAccounts = await provider.request({ method: "eth_requestAccounts" });
        walletAddress = okxAccounts[0];
        await provider.request({
          method: "eth_sendTransaction",
          params: [{
            from: walletAddress,
            to: toAddress,
            value: (parseFloat(price) * 1e18).toString(16),
          }],
        });
        break;
    }

    const { data: { user } } = await supabase.auth.getUser();
    if (!user) throw new Error("User not logged in");

    const validityDays = { elite: 30, epic: 45, pro: 60, diamond: 90 };
    const speedMultiplier = { elite: 3, epic: 5, pro: 10, diamond: 15 };
    const expiresAt = new Date();
    expiresAt.setDate(expiresAt.getDate() + validityDays[booster]);

    await supabase.from("boosters").insert({
      user_id: user.id,
      booster_type: booster,
      speed_multiplier: speedMultiplier[booster],
      price: parseFloat(price),
      wallet_address: walletAddress,
      expires_at: expiresAt.toISOString(),
    });

    showToast("Success", `${booster.charAt(0).toUpperCase() + booster.slice(1)} Booster activated!`);
  } catch (error) {
    console.error("Purchase error:", error);
    showToast("Error", error.message || "Purchase failed", "destructive");
  }
}

document.querySelectorAll(".purchase-btn").forEach(btn => {
  btn.addEventListener("click", async () => {
    const booster = btn.dataset.booster;
    const price = btn.dataset.price;
    const boosterName = booster.charAt(0).toUpperCase() + booster.slice(1);

    // Create modal overlay
    const overlay = document.createElement("div");
    overlay.className = "fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4";
    
    // Create modal container
    const modal = document.createElement("div");
    modal.className = "bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl shadow-2xl border border-slate-700/50 w-full max-w-md overflow-hidden";
    modal.innerHTML = `
      <div class="p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="text-xl font-bold text-slate-100 flex items-center gap-2">
            <i data-lucide="wallet" class="w-5 h-5 text-cyan-400"></i>
            Select Payment Method
          </h3>
          <button class="close-btn text-slate-400 hover:text-slate-200">
            <i data-lucide="x" class="w-5 h-5"></i>
          </button>
        </div>
        
        <div class="mb-6">
          <div class="bg-slate-700/30 rounded-lg p-4 mb-3">
            <div class="text-xs text-slate-400 mb-1">Purchasing</div>
            <div class="font-medium text-slate-100">${boosterName} Booster</div>
          </div>
          <div class="bg-slate-700/30 rounded-lg p-4">
            <div class="text-xs text-slate-400 mb-1">Amount</div>
            <div class="font-medium text-slate-100">${price} ETH</div>
          </div>
        </div>
        
        <div class="space-y-3 mb-6">
          <button class="wallet-btn flex items-center gap-4 p-4 w-full rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-colors border border-slate-600/50" data-wallet="metamask">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="MetaMask" class="w-8 h-8">
            <span class="text-slate-100 font-medium">MetaMask</span>
            <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-400"></i>
          </button>
          
          <button class="wallet-btn flex items-center gap-4 p-4 w-full rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-colors border border-slate-600/50" data-wallet="phantom">
            <img src="https://mate.tools/s/dGOqmKUm" alt="Phantom" class="w-8 h-8 rounded-full">
            <span class="text-slate-100 font-medium">Phantom</span>
            <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-400"></i>
          </button>
          
          <button class="wallet-btn flex items-center gap-4 p-4 w-full rounded-lg bg-slate-700/50 hover:bg-slate-700/70 transition-colors border border-slate-600/50" data-wallet="okx">
            <img src="https://mate.tools/s/WNjPYxYj" alt="OKX" class="w-8 h-8 rounded-full">
            <span class="text-slate-100 font-medium">OKX Wallet</span>
            <i data-lucide="chevron-right" class="ml-auto w-5 h-5 text-slate-400"></i>
          </button>
        </div>
        
        <div class="text-xs text-slate-500 text-center">
          Your wallet will open to confirm the transaction
        </div>
      </div>
    `;
    
    overlay.appendChild(modal);
    document.body.appendChild(overlay);
    document.body.style.overflow = "hidden";
    
    // Initialize icons
    if (window.lucide) {
      window.lucide.createIcons();
    }
    
    // Close modal handlers
    const closeModal = () => {
      document.body.removeChild(overlay);
      document.body.style.overflow = "";
    };
    
    overlay.querySelector(".close-btn").addEventListener("click", closeModal);
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeModal();
    });
    
    // Wallet selection handler
    const walletBtns = overlay.querySelectorAll(".wallet-btn");
    walletBtns.forEach(btn => {
      btn.addEventListener("click", async () => {
        const walletType = btn.dataset.wallet;
        modal.innerHTML = `
          <div class="p-6 flex flex-col items-center justify-center h-64">
            <div class="animate-spin mb-4">
              <i data-lucide="loader" class="w-8 h-8 text-cyan-400"></i>
            </div>
            <h3 class="text-lg font-medium text-slate-100 mb-2">Connecting to ${btn.querySelector("span").textContent}</h3>
            <p class="text-sm text-slate-400 text-center">Please check your wallet to confirm the connection</p>
          </div>
        `;
        
        if (window.lucide) {
          window.lucide.createIcons();
        }
        
        try {
          await handlePurchase(walletType, booster, price);
          closeModal();
        } catch (error) {
          console.error("Wallet connection error:", error);
          closeModal();
          showToast("Error", error.message || "Wallet connection failed", "destructive");
        }
      });
    });
  });
});
//end of purchase








// Run security scan
async function runSecurityScan() {
    const userResult = await supabase.auth.getUser();
    const user = userResult.data.user;

    if (!user) {
        alert("User belum login.");
        return;
    }

    const userAgent = navigator.userAgent;
    document.getElementById('userAgent').textContent = userAgent;

    const devtoolsStatus = document.getElementById('devtoolsStatus');
    const isDevToolsOpen = () => {
        const threshold = 100;
        const widthDiff = window.outerWidth - window.innerWidth;
        const heightDiff = window.outerHeight - window.innerHeight;
        return widthDiff > threshold || heightDiff > threshold;
    };
    const devOpen = isDevToolsOpen();
    devtoolsStatus.innerHTML = devOpen
        ? `<span class="w-2 h-2 mr-2 rounded-full bg-red-400 animate-pulse"></span> Open`
        : `<span class="w-2 h-2 mr-2 rounded-full bg-green-400 animate-pulse"></span> Closed`;
    devtoolsStatus.className = devOpen
        ? 'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-red-900/30 text-red-400 border border-red-700/50'
        : 'inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-900/30 text-green-400 border border-green-700/50';

    let fingerprint = "Unavailable";
    try {
        const fp = await FingerprintJS.load();
        const result = await fp.get();
        fingerprint = result.visitorId;
        document.getElementById('deviceFingerprint').textContent = fingerprint;
    } catch (error) {
        document.getElementById('deviceFingerprint').textContent = "Error";
    }

    let ip = "Unknown", location = "Unknown";
    try {
        const res = await fetch('https://ipinfo.io/json?token=d5d6936f036032');
        const data = await res.json();
        ip = data.ip;
        location = `${data.city}, ${data.region}, ${data.country}`;
        document.getElementById('ipAddress').textContent = ip;
        document.getElementById('locationInfo').textContent = location;
    } catch (error) {
        document.getElementById('ipAddress').textContent = "Error";
        document.getElementById('locationInfo').textContent = "Error";
    }

    const { data: existingData, error: fetchError } = await supabase
        .from("security_scans")
        .select("id")
        .eq("user_id", user.id)
        .eq("fingerprint", fingerprint)
        .eq("ip_address", ip)
        .limit(1);

    if (fetchError) {
        console.error("Error cek duplikasi:", fetchError.message);
        return;
    }

    if (existingData.length > 0) {
        console.log("Data sudah ada. Tidak akan disimpan.");
        return;
    }

    const logContainer = document.getElementById('securityLog');
    const logEntry = document.createElement('div');
    logEntry.className = "bg-slate-800/60 border border-slate-700 rounded-lg p-4 space-y-2 text-slate-300";
    logEntry.innerHTML = `
        <div class="flex items-center text-sm">
            <i data-lucide="monitor" class="h-4 w-4 mr-2 text-blue-400"></i>
            <span class="font-medium">User Agent:</span> <span class="ml-2 truncate">${userAgent}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="code" class="h-4 w-4 mr-2 ${devOpen ? 'text-red-400' : 'text-green-400'}"></i>
            <span class="font-medium">DevTools:</span> <span class="ml-2">${devOpen ? 'Open' : 'Closed'}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="fingerprint" class="h-4 w-4 mr-2 text-purple-400"></i>
            <span class="font-medium">Fingerprint:</span> <span class="ml-2">${fingerprint}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="globe" class="h-4 w-4 mr-2 text-yellow-400"></i>
            <span class="font-medium">IP Address:</span> <span class="ml-2">${ip}</span>
        </div>
        <div class="flex items-center text-sm">
            <i data-lucide="map-pin" class="h-4 w-4 mr-2 text-pink-400"></i>
            <span class="font-medium">Location:</span> <span class="ml-2">${location}</span>
        </div>
    `;
    logContainer.prepend(logEntry);
    lucide.createIcons();

    const email = user.email;
    const { data: insertData, error } = await supabase
        .from("security_scans")
        .insert([
            {
                user_id: user.id,
                email: email,
                user_agent: userAgent,
                devtools_open: devOpen,
                fingerprint: fingerprint,
                ip_address: ip,
                location: location,
                created_at: new Date().toISOString()
            }
        ]);

    if (error) {
        console.error("Gagal simpan ke Supabase:", error.message, error.details);
    } else {
        console.log("✅ Data berhasil dikirim ke Supabase.");
    }
}

document.getElementById('runSecurityScanBtn').addEventListener('click', runSecurityScan);

document.getElementById('clearSecurityLogBtn').addEventListener('click', () => {
    document.getElementById('securityLog').innerHTML = '';
});

// Fungsi untuk menyembunyikan sebagian alamat wallet
function maskWalletAddress(address) {
    if (!address) return '';
    const visibleChars = 6;
    return address.length > visibleChars * 2
        ? `${address.slice(0, visibleChars)}...${address.slice(-visibleChars)}`
        : address;
}
//end of security scan








// Leaderboard Function
async function loadLeaderboard() {
    try {
        

        const { data, error } = await supabase
            .from("profiles")
            .select("full_name, email, points, booster, wallet_address, avatar_url")
            .order("points", { ascending: false })
            .limit(10);

        if (error) throw error;

        const leaderboardList = document.getElementById("leaderboardList");
        leaderboardList.innerHTML = "";

        const rankIcons = {
            1: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-400" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>`,
            2: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-400" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>`,
            3: `<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-amber-600" viewBox="0 0 20 20" fill="currentColor">
                  <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                </svg>`,
            4: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">4</div>`,
            5: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">5</div>`,
            6: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">6</div>`,
            7: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">7</div>`,
            8: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">8</div>`,
            9: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">9</div>`,
            10: `<div class="h-5 w-5 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold text-slate-300">10</div>`
        };

        for (const [index, entry] of data.entries()) {
            const rank = index + 1;
            const displayName = entry.full_name || entry.email || "Anonymous";
            const pointsDisplay = entry.points.toFixed(2);
            const boosterDisplay = entry.booster
                ? `<span class="bg-amber-500/10 text-amber-400 px-2 py-1 rounded-md text-xs">${entry.booster.charAt(0).toUpperCase() + entry.booster.slice(1)}</span>`
                : '<span class="text-slate-500 text-xs">None</span>';

            let avatarHTML = `
                <div class="h-8 w-8 rounded-full bg-gradient-to-br from-cyan-600 to-slate-800 text-white flex items-center justify-center text-sm font-bold shadow">
                    ${displayName[0].toUpperCase()}
                </div>
            `;

            if (entry.avatar_url) {
                const { data: avatarData, error: avatarError } = await supabase
                    .storage
                    .from("avatars")
                    .getPublicUrl(entry.avatar_url);
                if (!avatarError && avatarData.publicUrl) {
                    avatarHTML = `<img src="${avatarData.publicUrl}" class="h-8 w-8 rounded-full object-cover shadow" alt="Avatar" />`;
                }
            }

            const row = document.createElement("div");
            row.className = "grid grid-cols-12 py-4 items-center hover:bg-slate-800/30 transition-colors";
            row.innerHTML = `
                <div class="col-span-1 flex justify-center items-center">
                    ${rank <= 10 ? rankIcons[rank] : `<div class="text-xs text-slate-500">${rank}</div>`}
                </div>
                <div class="col-span-1">${avatarHTML}</div>
                <div class="col-span-5">
                    <div class="text-sm font-medium text-slate-200">${displayName}</div>
                    <div class="text-xs text-slate-500 truncate">${maskWalletAddress(entry.wallet_address || '')}</div>
                </div>
                <div class="col-span-2">${boosterDisplay}</div>
                <div class="col-span-3 text-right">
                    <div class="text-sm font-bold text-amber-400">${pointsDisplay}</div>
                    <div class="text-xs text-slate-500">points</div>
                </div>
            `;
            leaderboardList.appendChild(row);
        }
    } catch (error) {
        showToast("Error", error.message, "destructive");
    } finally {
        loadingOverlay.classList.add("hidden");
    }
}
//end leaderboard function






let messagesList = [];
let adminMessagesList = [];
let isChatInitialized = false;
let supabaseChannels = [];
let eventListeners = [];
let onlineUsers = [];
let latencyInterval;
let lastChatTime = {};
let lastMediaTime = {};
const CHAT_COOLDOWN = 60 * 1000; // 60 detik
const MEDIA_COOLDOWN = 30 * 60 * 1000; // 30 menit



// Sanitize HTML untuk mencegah XSS
function sanitizeHTML(str) {
    const div = document.createElement("div");
    div.textContent = str;
    return div.innerHTML;
}

// Filter kata kasar
const badWords = ["tolol", "anjing", "asu", "fuckyou", "babi", "bapak kau", "bujang", "kontol", "memek", "perek", "jancuk"];
function filterBadWords(content) {
    let filteredContent = content;
    let hasBadWord = false;
    badWords.forEach(word => {
        const regex = new RegExp(`\\b${word}\\b`, 'gi');
        if (regex.test(filteredContent)) {
            hasBadWord = true;
            filteredContent = filteredContent.replace(regex, "[Kata Dihapus]");
        }
    });
    if (hasBadWord) {
        showToast("Peringatan", "Kata kasar telah dihapus dari pesan Anda!", "destructive");
    }
    return filteredContent;
}

// Format waktu relatif
function timeAgo(date) {
    const now = new Date();
    const seconds = Math.floor((now - new Date(date)) / 1000);
    if (seconds < 60) return `${seconds} sec ago`;
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return `${minutes} min ago`;
    const hours = Math.floor(minutes / 60);
    if (hours < 24) return `${hours} hours ago`;
    return new Date(date).toLocaleDateString("id-ID");
}

// Validasi UUID
function isValidUuid(uuid) {
    const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    return uuidRegex.test(uuid);
}

// Normalisasi struktur likes
function normalizeLikes(likes) {
    if (!Array.isArray(likes)) {
        return [];
    }
    return likes.filter(like => like && like.type && like.user_id && isValidUuid(like.user_id));
}

// Mendapatkan jumlah like per tipe
function getLikesCount(likes, type) {
    return normalizeLikes(likes).filter(like => like.type === type).length;
}

// Fungsi untuk menambahkan satu pesan admin ke DOM
async function appendAdminMessage(msg) {
    const adminMessages = document.getElementById("adminMessages");
    if (!adminMessages) return;

    const adminMessageEl = document.createElement("div");
    adminMessageEl.className = `
        mb-4 last:mb-0 
        bg-gradient-to-br from-purple-700/30 to-indigo-800/20 
        border border-purple-500/30 
        rounded-xl 
        p-4 
        text-slate-100 
        shadow-md 
        animate-fade-in
    `;
    adminMessageEl.setAttribute("data-admin-message-id", msg.id);

    const timestamp = new Date(msg.created_at).toLocaleString("id-ID", {
        hour: "numeric",
        minute: "numeric",
        hour12: true,
        day: "numeric",
        month: "short",
        year: "numeric",
    });

    const sanitizedContent = sanitizeHTML(msg.content);

    adminMessageEl.innerHTML = `
        <div class="flex items-start gap-3">
            <div class="flex-shrink-0 p-2 bg-purple-700/30 rounded-full">
                <i data-lucide="megaphone" class="h-6 w-6 text-purple-300"></i>
            </div>
            <div class="flex-1">
                <div class="flex items-center justify-between mb-1">
                    <div class="font-semibold text-purple-300 text-base flex items-center gap-1">
                        <span>📢 Pesan Admin</span>
                    </div>
                    <div class="text-xs text-slate-400 flex items-center">
                        <i data-lucide="clock" class="h-3 w-3 mr-1"></i>
                        <span>${timestamp}</span>
                    </div>
                </div>
                <div class="text-lg leading-relaxed text-slate-100">
                    ${sanitizedContent}
                </div>
            </div>
        </div>
    `;

    adminMessages.appendChild(adminMessageEl);
    lucide.createIcons();
}


// Fungsi untuk menambahkan satu pesan ke DOM
async function appendMessage(msg, updateOnly = false) {
    const chatMessages = document.getElementById("chatMessages");
    if (!chatMessages) return;

    const existingMessage = document.querySelector(`[data-message-id="${msg.id}"]`);
    if (existingMessage && !updateOnly) return;

    if (!isValidUuid(msg.id)) {
        console.error(`ID pesan tidak valid: ${msg.id}`);
        showToast("Error", "ID pesan tidak valid", "destructive");
        return;
    }

    const isMine = msg.user_id === window.currentUser?.id;
    const messageEl = existingMessage || document.createElement("div");
    messageEl.className = `flex mb-4 last:mb-0 ${isMine ? "flex-row-reverse" : ""}`;
    messageEl.setAttribute("data-message-id", msg.id);

    let avatarContent = msg.full_name ? msg.full_name[0].toUpperCase() : 'A';
    let avatarColor = "blue";
    if (isMine) avatarColor = "cyan";
    if (msg.full_name?.includes("Sarah")) avatarColor = "purple";

    if (msg.avatar_url) {
        try {
            const { data: avatarData } = await supabase.storage
                .from("avatars")
                .getPublicUrl(msg.avatar_url);
            if (avatarData?.publicUrl) {
                avatarContent = `<img src="${avatarData.publicUrl}" class="h-8 w-8 rounded-full object-cover" alt="Avatar" />`;
            }
        } catch (error) {
            console.error("Gagal ambil avatar:", error);
        }
    }

    const timestamp = new Date(msg.created_at).toLocaleString("id-ID", {
        hour: "numeric",
        minute: "numeric",
        hour12: true,
    });

    const highlightedContent = highlightMentions(sanitizeHTML(msg.content));
    const sanitizedFullName = sanitizeHTML(msg.full_name || "Anonim");
    const isMentioned = Array.isArray(msg.mentions) && msg.mentions.includes(window.currentUser?.id);

    const scrollPosition = chatMessages.scrollTop;
    const isAtBottom = isScrolledToBottom(chatMessages);

    messageEl.innerHTML = `
        <div class="flex-shrink-0 ${isMine ? "ml-3" : "mr-3"}">
            <div class="h-8 w-8 rounded-full bg-gradient-to-br from-${avatarColor}-500/20 to-${avatarColor}-600/20 border border-${avatarColor}-500/30 flex items-center justify-center shadow-sm">
                ${avatarContent}
            </div>
        </div>
        <div class="flex-1 min-w-0 ${isMine ? "text-right" : ""}">
            <div class="flex items-baseline mb-1 ${isMine ? "justify-end" : ""}">
                <div class="text-xs ${isMine ? "text-slate-500 flex items-center mr-2" : "font-medium text-" + avatarColor + "-400 mr-2"}">
                    ${isMine ? `<i data-lucide="clock" class="h-3 w-3 mr-1"></i><span>${timestamp}</span>` : sanitizedFullName}
                </div>
                ${isMine ? `<div class="text-xs font-medium text-cyan-400">You</div>` : `<div class="text-xs text-slate-500 flex items-center"><i data-lucide="clock" class="h-3 w-3 mr-1"></i><span>${timestamp}</span></div>`}
            </div>
            <div class="text-sm text-slate-300 ${isMine ? "bg-gradient-to-r from-cyan-600/20 to-blue-600/20 border border-cyan-500/30 inline-block" : "bg-slate-800/50 border border-slate-700/30"} rounded-lg p-3 ${isMentioned ? "border-cyan-500/50" : ""}">
                ${highlightedContent}
            </div>
    `;

    if (msg.image_url) {
        const imgContainer = document.createElement("div");
        imgContainer.className = "grid grid-cols-2 gap-2 mt-2";
        imgContainer.innerHTML = `
            <div class="bg-slate-800/70 border border-slate-700/40 rounded-lg overflow-hidden cursor-pointer hover:border-cyan-500/40 transition-all duration-200">
                <img src="${msg.image_url}" alt="Image" class="max-w-[200px] h-auto">
            </div>
        `;
        messageEl.querySelector(".text-sm").appendChild(imgContainer);
    }

    if (msg.audio_url) {
        const voiceContainer = document.createElement("div");
        voiceContainer.className = "voice-message-container mt-2";
        const duration = msg.duration || Math.floor(Math.random() * 30) + 5;
        const minutes = Math.floor(duration / 60);
        const seconds = duration % 60;

        voiceContainer.innerHTML = `
            <div class="voice-message ${isMine ? 'bg-gradient-to-r from-cyan-600/20 to-blue-600/20 border border-cyan-500/30' : 'bg-slate-800/50 border border-slate-700/30'} rounded-lg p-2 flex items-center">
                <button class="play-pause-btn p-2 bg-${isMine ? 'cyan' : 'slate'}-500/20 rounded-full">
                    <svg class="play-icon" width="16" height="16" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M8 5v14l11-7z"/>
                    </svg>
                    <svg class="pause-icon" width="16" height="16" viewBox="0 0 24 24" style="display:none">
                        <path fill="currentColor" d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
                    </svg>
                </button>
                <div class="waveform-container flex-1 mx-2">
                    <div class="waveform h-6 bg-slate-700/50 rounded-full overflow-hidden">
                        <div class="progress h-full bg-${isMine ? 'cyan' : 'blue'}-500/50" style="width: 0%"></div>
                    </div>
                </div>
                <span class="duration text-xs text-slate-400">${minutes}:${seconds.toString().padStart(2, '0')}</span>
            </div>
            <audio src="${msg.audio_url}" preload="none"></audio>
        `;
        messageEl.querySelector(".text-sm").appendChild(voiceContainer);

        const playBtn = voiceContainer.querySelector('.play-pause-btn');
        const audio = voiceContainer.querySelector('audio');
        const playIcon = voiceContainer.querySelector('.play-icon');
        const pauseIcon = voiceContainer.querySelector('.pause-icon');
        const progress = voiceContainer.querySelector('.progress');

        playBtn.addEventListener('click', () => {
            if (audio.paused) {
                audio.play();
                playIcon.style.display = 'none';
                pauseIcon.style.display = 'block';
                const startTime = Date.now();
                const animate = () => {
                    const elapsed = (Date.now() - startTime) / 1000;
                    const percentage = Math.min((elapsed / duration) * 100, 100);
                    progress.style.width = `${percentage}%`;
                    if (!audio.paused && percentage < 100) {
                        requestAnimationFrame(animate);
                    }
                };
                animate();
            } else {
                audio.pause();
                playIcon.style.display = 'block';
                pauseIcon.style.display = 'none';
            }
        });

        audio.addEventListener('ended', () => {
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
            progress.style.width = '0%';
        });

        audio.addEventListener('pause', () => {
            playIcon.style.display = 'block';
            pauseIcon.style.display = 'none';
        });
    }

    const actions = document.createElement("div");
    actions.className = `flex items-center mt-2 space-x-3 ${isMine ? "justify-end" : ""}`;
    const likes = normalizeLikes(msg.likes);
    actions.innerHTML = `
        <div class="like-container flex space-x-2">
            <button class="like-btn like-thumbs-up text-xs text-slate-400 hover:text-cyan-400 flex items-center" data-message-id="${msg.id}" data-type="thumbsUp">
                <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                <span>${getLikesCount(likes, "thumbsUp")}</span>
            </button>
            <button class="like-btn like-heart text-xs text-slate-400 hover:text-red-400 flex items-center" data-message-id="${msg.id}" data-type="heart">
                ❤️<span class="ml-1">${getLikesCount(likes, "heart")}</span>
            </button>
            <button class="like-btn like-laugh text-xs text-slate-400 hover:text-yellow-400 flex items-center" data-message-id="${msg.id}" data-type="laugh">
                😆<span class="ml-1">${getLikesCount(likes, "laugh")}</span>
            </button>
            <button class="like-btn like-wow text-xs text-slate-400 hover:text-indigo-400 flex items-center" data-message-id="${msg.id}" data-type="wow">
                😮<span class="ml-1">${getLikesCount(likes, "wow")}</span>
            </button>
            <button class="like-btn like-sad text-xs text-slate-400 hover:text-blue-400 flex items-center" data-message-id="${msg.id}" data-type="sad">
                😢<span class="ml-1">${getLikesCount(likes, "sad")}</span>
            </button>
            <button class="like-btn like-angry text-xs text-slate-400 hover:text-orange-400 flex items-center" data-message-id="${msg.id}" data-type="angry">
                😡<span class="ml-1">${getLikesCount(likes, "angry")}</span>
            </button>
            <button class="like-btn like-love text-xs text-slate-400 hover:text-pink-400 flex items-center" data-message-id="${msg.id}" data-type="love">
                🥰<span class="ml-1">${getLikesCount(likes, "love")}</span>
            </button>
        </div>
        ${!isMine ? `
        <button class="reply-btn text-xs text-slate-400 hover:text-amber-400 flex items-center" data-message-id="${msg.id}">
            <i data-lucide="message-square" class="h-3 w-3 mr-1"></i>
            <span>Reply</span>
        </button>
        <button class="report-btn text-xs text-slate-400 hover:text-rose-400 flex items-center" data-message-id="${msg.id}">
            <i data-lucide="flag" class="h-3 w-3 mr-1"></i>
            <span>Report</span>
        </button>` : `
        <span class="text-xs text-slate-500 flex items-center">
            <i data-lucide="check" class="h-3 w-3 mr-1 text-emerald-400"></i>
            <span>${msg.status || "Delivered"}</span>
        </span>`}
    `;
    messageEl.querySelector(".flex-1").appendChild(actions);

    const likeButtons = actions.querySelectorAll('.like-btn');
    likeButtons.forEach(button => {
        button.addEventListener('click', async (e) => {
            e.preventDefault(); // Mencegah default behavior
            e.stopPropagation(); // Mencegah event bubbling

            const messageId = button.dataset.messageId;
            const likeType = button.dataset.type;

            if (!isValidUuid(messageId) || !isValidUuid(window.currentUser.id)) {
                console.error(`ID tidak valid: messageId=${messageId}, userId=${window.currentUser.id}`);
                showToast("Error", "ID tidak valid", "destructive");
                return;
            }

            let likes = normalizeLikes(msg.likes);
            const userLike = likes.find(like => like.user_id === window.currentUser.id);

            if (userLike) {
                if (userLike.type === likeType) {
                    likes = likes.filter(like => like.user_id !== window.currentUser.id);
                } else {
                    likes = likes.filter(like => like.user_id !== window.currentUser.id);
                    likes.push({ type: likeType, user_id: window.currentUser.id });
                }
            } else {
                likes.push({ type: likeType, user_id: window.currentUser.id });
            }

            const { error } = await supabase.from("messages").update({ likes }).eq("id", messageId);
            if (error) {
                console.error("Gagal menyimpan like ke Supabase:", error);
                showToast("Error", "Gagal menyimpan like: " + error.message, "destructive");
                return;
            }

            const index = messagesList.findIndex(m => m.id === messageId);
            if (index !== -1) {
                messagesList[index].likes = likes;
            }

            // Update hanya bagian like tanpa render ulang seluruh pesan
            const likeContainer = messageEl.querySelector('.like-container');
            const updatedLikes = normalizeLikes(likes);
            likeContainer.innerHTML = `
                <button class="like-btn like-thumbs-up text-xs text-slate-400 hover:text-cyan-400 flex items-center" data-message-id="${msg.id}" data-type="thumbsUp">
                    <i data-lucide="thumbs-up" class="h-3 w-3 mr-1"></i>
                    <span>${getLikesCount(updatedLikes, "thumbsUp")}</span>
                </button>
                <button class="like-btn like-heart text-xs text-slate-400 hover:text-red-400 flex items-center" data-message-id="${msg.id}" data-type="heart">
                    ❤️<span class="ml-1">${getLikesCount(updatedLikes, "heart")}</span>
                </button>
                <button class="like-btn like-laugh text-xs text-slate-400 hover:text-yellow-400 flex items-center" data-message-id="${msg.id}" data-type="laugh">
                    😆<span class="ml-1">${getLikesCount(updatedLikes, "laugh")}</span>
                </button>
                <button class="like-btn like-wow text-xs text-slate-400 hover:text-indigo-400 flex items-center" data-message-id="${msg.id}" data-type="wow">
                    😮<span class="ml-1">${getLikesCount(updatedLikes, "wow")}</span>
                </button>
                <button class="like-btn like-sad text-xs text-slate-400 hover:text-blue-400 flex items-center" data-message-id="${msg.id}" data-type="sad">
                    😢<span class="ml-1">${getLikesCount(updatedLikes, "sad")}</span>
                </button>
                <button class="like-btn like-angry text-xs text-slate-400 hover:text-orange-400 flex items-center" data-message-id="${msg.id}" data-type="angry">
                    😡<span class="ml-1">${getLikesCount(updatedLikes, "angry")}</span>
                </button>
                <button class="like-btn like-love text-xs text-slate-400 hover:text-pink-400 flex items-center" data-message-id="${msg.id}" data-type="love">
                    🥰<span class="ml-1">${getLikesCount(updatedLikes, "love")}</span>
                </button>
            `;

            // Reattach event listeners ke tombol like yang baru
            const newLikeButtons = likeContainer.querySelectorAll('.like-btn');
            newLikeButtons.forEach(newButton => {
                newButton.addEventListener('click', async (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    const newMessageId = newButton.dataset.messageId;
                    const newLikeType = newButton.dataset.type;

                    if (!isValidUuid(newMessageId) || !isValidUuid(window.currentUser.id)) {
                        console.error(`ID tidak valid: messageId=${newMessageId}, userId=${window.currentUser.id}`);
                        showToast("Error", "ID tidak valid", "destructive");
                        return;
                    }

                    let newLikes = normalizeLikes(messagesList[index].likes);
                    const newUserLike = newLikes.find(like => like.user_id === window.currentUser.id);

                    if (newUserLike) {
                        if (newUserLike.type === newLikeType) {
                            newLikes = newLikes.filter(like => like.user_id !== window.currentUser.id);
                        } else {
                            newLikes = newLikes.filter(like => like.user_id !== window.currentUser.id);
                            newLikes.push({ type: newLikeType, user_id: window.currentUser.id });
                        }
                    } else {
                        newLikes.push({ type: newLikeType, user_id: window.currentUser.id });
                    }

                    const { error } = await supabase.from("messages").update({ likes: newLikes }).eq("id", newMessageId);
                    if (error) {
                        console.error("Gagal menyimpan like ke Supabase:", error);
                        showToast("Error", "Gagal menyimpan like: " + error.message, "destructive");
                        return;
                    }

                    messagesList[index].likes = newLikes;
                    await appendMessage(messagesList[index], true);
                });
            });

            // Pulihkan posisi scroll
          
        });
    });

    const replyBtn = actions.querySelector('.reply-btn');
    if (replyBtn) {
        replyBtn.addEventListener('click', () => {
            const chatInput = document.getElementById("chatInput");
            chatInput.value = `Replying to ${msg.full_name}: ${msg.content}\n`;
            chatInput.focus();
        });
    }

    const reportBtn = actions.querySelector('.report-btn');
    if (reportBtn) {
        reportBtn.addEventListener('click', () => {
            const popup = document.createElement("div");
            popup.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
            popup.innerHTML = `
                <div class="bg-slate-800 p-4 rounded-lg shadow-lg w-80">
                    <h3 class="text-lg font-semibold text-white mb-2">Laporkan Pesan</h3>
                    <textarea id="reportReason" class="w-full h-24 p-2 bg-slate-700 text-white rounded mb-4" placeholder="Masukkan alasan pelaporan..."></textarea>
                    <div class="flex justify-end space-x-2">
                        <button id="cancelReport" class="px-4 py-2 bg-slate-600 text-white rounded hover:bg-slate-500">Batal</button>
                        <button id="submitReport" class="px-4 py-2 bg-rose-600 text-white rounded hover:bg-rose-500">Kirim</button>
                    </div>
                </div>
            `;
            document.body.appendChild(popup);

            document.getElementById("cancelReport").addEventListener("click", () => popup.remove());
            document.getElementById("submitReport").addEventListener("click", async () => {
                const reason = document.getElementById("reportReason").value.trim();
                if (reason) {
                    await supabase.from("reports").insert({
                        message_id: msg.id,
                        user_id: window.currentUser.id,
                        reason,
                    });
                    showToast("Info", "Pesan telah dilaporkan", "default");
                }
                popup.remove();
            });
        });
    }

    lucide.createIcons();
    if (!existingMessage) {
        chatMessages.appendChild(messageEl);
    }

    if (isScrolledToBottom(chatMessages)) {
        chatMessages.scrollTo({ top: chatMessages.scrollHeight, behavior: 'instant' });
    }
}

// Cek apakah pengguna di bawah
function isScrolledToBottom(element) {
    return element.scrollHeight - element.scrollTop <= element.clientHeight + 10;
}

// Highlight text @username
function highlightMentions(text) {
    return text.replace(/@([\w\s]+)/g, '<span class="text-cyan-400 font-semibold">@$1</span>');
}

// Deteksi mention @username
function detectMentions(content) {
    const mentions = content.match(/@([\w\s]+)/g) || [];
    return mentions.map(m => m.substring(1).trim());
}

// Ambil daftar pengguna yang pernah mengirim pesan
async function fetchChatParticipants(query = "") {
    try {
        const { data, error } = await supabase
            .from("profiles")
            .select("id, full_name, avatar_url")
            .ilike("full_name", `%${query}%`)
            .limit(10);
        if (error) throw error;
        return data;
    } catch (error) {
        console.error("Gagal mengambil daftar pengguna:", error);
        return [];
    }
}

// Tampilkan daftar saran autocompletion
async function showMentionSuggestions(query, chatInput, suggestionList) {
    if (!suggestionList) return;

    const participants = await fetchChatParticipants(query);
    suggestionList.innerHTML = "";
    suggestionList.classList.add("hidden");

    if (participants.length === 0) return;

    participants.forEach(user => {
        const item = document.createElement("div");
        item.className = "suggestion-item flex items-center space-x-2 p-2 hover:bg-gray-100 cursor-pointer";
        const initial = user.full_name ? user.full_name[0].toUpperCase() : "A";
        item.innerHTML = `
            <div class="avatar w-8 h-8 rounded-full bg-blue-500 text-white flex items-center justify-center">
                ${initial}
            </div>
            <span>${sanitizeHTML(user.full_name)}</span>
        `;
        item.dataset.userId = user.id;
        item.dataset.fullName = user.full_name;
        item.addEventListener("click", () => {
            const cursorPos = chatInput.selectionStart;
            const textBefore = chatInput.value.substring(0, cursorPos).replace(/@[\w\s]*$/, `@${user.full_name} `);
            const textAfter = chatInput.value.substring(cursorPos);
            chatInput.value = textBefore + textAfter;
            suggestionList.classList.add("hidden");
            chatInput.focus();
        });
        suggestionList.appendChild(item);
    });

    suggestionList.classList.remove("hidden");
}

// Ambil data profil pengguna
async function fetchUserProfile(userId) {
    try {
        const { data: profile, error } = await supabase
            .from("profiles")
            .select("full_name, avatar_url")
            .eq("id", userId)
            .single();
        if (error) throw error;
        return {
            full_name: profile?.full_name || "Anonim",
            avatar_url: profile?.avatar_url || "",
        };
    } catch (error) {
        console.error("Gagal mengambil profil:", error);
        return { full_name: "Anonim", avatar_url: "" };
    }
}

// Fungsi kirim pesan dengan cooldown
async function sendMessage(content, image_url = null, audio_url = null) {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    const suggestionList = document.getElementById("mentionSuggestions");

    if (!chatInput || !sendMessageBtn) {
        console.error("Elemen chatInput atau sendMessageBtn tidak ditemukan");
        showToast("Error", "Elemen input tidak ditemukan", "destructive");
        return;
    }

    const userId = window.currentUser.id;
    const now = Date.now();

    if (content && lastChatTime[userId] && (now - lastChatTime[userId] < CHAT_COOLDOWN)) {
        const remaining = Math.ceil((CHAT_COOLDOWN - (now - lastChatTime[userId])) / 1000);
        showToast("Peringatan", `Tunggu ${remaining} detik lagi untuk chat!`, "destructive");
        startChatTimer(remaining);
        return;
    }

    if ((image_url || audio_url) && lastMediaTime[userId] && (now - lastMediaTime[userId] < MEDIA_COOLDOWN)) {
        const remaining = Math.ceil((MEDIA_COOLDOWN - (now - lastMediaTime[userId])) / 1000 / 60);
        showToast("Peringatan", `Tunggu ${remaining} menit lagi untuk mengirim media!`, "destructive");
        return;
    }

    if (!content && !image_url && !audio_url) return;

    let filteredContent = content ? filterBadWords(content) : content;
    console.log("Mengirim pesan:", { content: filteredContent, image_url, audio_url });

    chatInput.disabled = true;
    sendMessageBtn.disabled = true;
    sendMessageBtn.innerHTML = `<i data-lucide="loader" class="h-4 w-4 animate-spin"></i>`;
    lucide.createIcons();

    try {
        const profile = window.currentUser.profile || (await fetchUserProfile(window.currentUser.id));
        window.currentUser.profile = profile;

        const messageData = {
            user_id: window.currentUser.id,
            full_name: profile.full_name,
            avatar_url: profile.avatar_url,
            content: filteredContent || "[Media]",
            status: "Delivered",
            likes: [],
        };

        if (image_url) messageData.image_url = image_url;
        if (audio_url) messageData.audio_url = audio_url;

        let mentionedUserIds = [];
        if (filteredContent) {
            const mentionedUsernames = detectMentions(filteredContent);
            for (const username of mentionedUsernames) {
                const { data: taggedUser, error } = await supabase
                    .from("profiles")
                    .select("id")
                    .eq("full_name", username)
                    .maybeSingle();
                if (error) {
                    console.error(`Gagal mencari pengguna ${username}:`, error);
                    continue;
                }
                if (taggedUser) {
                    mentionedUserIds.push(taggedUser.id);
                }
            }
        }

        if (mentionedUserIds.length > 0) {
            messageData.mentions = mentionedUserIds;
        }

        const { error: sendError } = await supabase.from("messages").insert(messageData);
        if (sendError) throw sendError;

        if (content) {
            lastChatTime[userId] = now;
            startChatTimer(CHAT_COOLDOWN / 1000);
        }
        if (image_url || audio_url) {
            lastMediaTime[userId] = now;
        }

        if (filteredContent) {
            const mentionedUsernames = detectMentions(filteredContent);
            for (const username of mentionedUsernames) {
                const { data: taggedUser, error } = await supabase
                    .from("profiles")
                    .select("id")
                    .eq("full_name", username)
                    .maybeSingle();
                if (error) {
                    console.error(`Gagal mencari pengguna untuk notifikasi ${username}:`, error);
                    continue;
                }
                if (taggedUser) {
                    const { error: notifyError } = await supabase.from("notifications").insert({
                        user_id: taggedUser.id,
                        type: "mention",
                        content: `${profile.full_name} menyebut Anda dalam pesan: "${filteredContent}"`,
                        is_read: false,
                    });
                    if (notifyError) {
                        console.error(`Gagal mengirim notifikasi untuk ${username}:`, notifyError);
                    } else {
                        showToast("Info", `Pengguna @${username} telah ditag`, "default");
                    }
                }
            }
        }

        if (filteredContent) chatInput.value = "";
        if (suggestionList) {
            suggestionList.classList.add("hidden");
        }
        showToast("Sukses", "Pesan terkirim", "default");

    } catch (err) {
        console.error("Gagal mengirim pesan:", err);
        showToast("Error", "Gagal mengirim pesan: " + err.message, "destructive");
    } finally {
        chatInput.disabled = false;
        sendMessageBtn.disabled = false;
        sendMessageBtn.innerHTML = `<i data-lucide="send" class="h-4 w-4 text-white"></i>`;
        lucide.createIcons();
    }
}

// Fungsi timer cooldown chat
function startChatTimer(seconds) {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    let timeLeft = seconds;
    chatInput.disabled = true;
    sendMessageBtn.disabled = true;

    const timer = setInterval(() => {
        timeLeft--;
        if (timeLeft <= 0) {
            clearInterval(timer);
            chatInput.disabled = false;
            sendMessageBtn.disabled = false;
            chatInput.placeholder = "Type your message...";
        } else {
            chatInput.placeholder = `Tunggu ${timeLeft} detik untuk chat lagi...`;
        }
    }, 1000);
}

// Fungsi untuk memperbarui latensi koneksi
function updateConnectionLatency() {
    const start = Date.now();
    supabase.from("messages").select("id").limit(1).then(() => {
        const latency = Date.now() - start;
        const connectionLatency = document.getElementById("connectionLatency");
        if (connectionLatency) {
            connectionLatency.textContent = `${latency}ms`;
            connectionLatency.parentElement.classList.remove("text-red-400");
            connectionLatency.parentElement.classList.add("text-slate-400");
        }
    }).catch(() => {
        const connectionLatency = document.getElementById("connectionLatency");
        if (connectionLatency) {
            connectionLatency.textContent = "Disconnected";
            connectionLatency.parentElement.classList.remove("text-slate-400");
            connectionLatency.parentElement.classList.add("text-red-400");
        }
    });
}

// Fungsi untuk memperbarui daftar pengguna online
function updateOnlineUsers(users) {
    const onlineUsersList = document.getElementById("onlineUsersList");
    if (!onlineUsersList) {
        console.error("Elemen onlineUsersList tidak ditemukan di DOM");
        return;
    }

    onlineUsersList.innerHTML = "";
    if (users.length === 0) {
        onlineUsersList.innerHTML = `<div class="text-center text-slate-400 py-2">Tidak ada pengguna online</div>`;
        return;
    }

    users.forEach(user => {
        const userEl = document.createElement("div");
        userEl.className = "flex flex-col items-center";
        const color = user.full_name.includes("Sarah") ? "purple" :
                      user.full_name.includes("Mike") ? "amber" :
                      user.full_name.includes("Lisa") ? "emerald" :
                      user.full_name.includes("Alex") ? "rose" : "blue";
        const statusColor = user.full_name === "Alex" ? "amber" : "emerald";
        let avatarContent = user.full_name ? user.full_name[0].toUpperCase() : "A";
        if (user.avatar_url) {
            try {
                const { data: avatarData } = supabase.storage
                    .from("avatars")
                    .getPublicUrl(user.avatar_url);
                if (avatarData?.publicUrl) {
                    avatarContent = `<img src="${avatarData.publicUrl}" class="h-8 w-8 rounded-full object-cover" alt="Avatar" />`;
                }
            } catch (error) {
                console.error("Gagal ambil avatar:", error);
            }
        }
        userEl.innerHTML = `
            <div class="relative">
                <div class="h-8 w-8 rounded-full bg-gradient-to-br from-${color}-500/20 to-${color}-600/20 border border-${color}-500/30 flex items-center justify-center shadow-sm">
                    ${avatarContent}
                </div>
                <div class="absolute bottom-0 right-0 h-2 w-2 bg-${statusColor}-500 rounded-full border border-slate-900"></div>
            </div>
            <span class="text-xs text-slate-400 mt-1 truncate w-10 text-center">${sanitizeHTML(user.full_name.split(' ')[0])}</span>
        `;
        onlineUsersList.appendChild(userEl);
    });

    const onlineCount = document.querySelector("#onlineUsersList").parentElement.querySelector("span");
    if (onlineCount) {
        onlineCount.textContent = `Online (${users.length})`;
    }
    lucide.createIcons();
}

// Fungsi untuk membersihkan event listener dan subscription
function cleanupChat() {
    eventListeners.forEach(({ element, event, handler }) => {
        element.removeEventListener(event, handler);
    });
    eventListeners = [];

    supabaseChannels.forEach(channel => {
        supabase.removeChannel(channel);
    });
    supabaseChannels = [];

    if (latencyInterval) {
        clearInterval(latencyInterval);
    }

    messagesList = [];
    adminMessagesList = [];
    onlineUsers = [];
    isChatInitialized = false;
    localStorage.removeItem("chatMessages");
    lastChatTime = {};
    lastMediaTime = {};
}

// Fungsi untuk mengikat event listener
function bindEventListeners() {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    const uploadImageButton = document.getElementById("uploadImageButton");
    const imageInput = document.getElementById("imageInput");
    const recordVoiceBtn = document.getElementById("recordVoiceBtn");
    const suggestionList = document.getElementById("mentionSuggestions");
    const emojiPickerBtn = document.getElementById("emojiPickerBtn");
    const voiceCallBtn = document.getElementById("voiceCallBtn");
    const videoCallBtn = document.getElementById("videoCallBtn");
    const refreshChatBtn = document.getElementById("refreshChatBtn");
    const expandUsersBtn = document.getElementById("expandUsersBtn");

    if (!chatInput || !sendMessageBtn) {
        console.error("Elemen chatInput atau sendMessageBtn tidak ditemukan");
        return;
    }

    const sendMessageHandler = async () => {
        const content = chatInput.value.trim();
        if (content) await sendMessage(content);
        chatInput.focus();
        if (suggestionList) {
            suggestionList.classList.add("hidden");
        }
    };
    sendMessageBtn.addEventListener("click", sendMessageHandler);
    eventListeners.push({ element: sendMessageBtn, event: "click", handler: sendMessageHandler });

    const keypressHandler = async (e) => {
        if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            const content = chatInput.value.trim();
            if (content) await sendMessage(content);
            chatInput.focus();
            if (suggestionList) {
                suggestionList.classList.add("hidden");
            }
        }
    };
    chatInput.addEventListener("keypress", keypressHandler);
    eventListeners.push({ element: chatInput, event: "keypress", handler: keypressHandler });

    let isTyping = false;
    let typingChannel = null;
    const inputHandler = async () => {
        if (!typingChannel) {
            typingChannel = supabase.channel("typing");
            typingChannel.subscribe((status) => {
                if (status === "SUBSCRIBED") {
                    if (isTyping) {
                        typingChannel.track({
                            user_id: window.currentUser.id,
                            full_name: window.currentUser.profile.full_name,
                            isTyping: true
                        }).catch(err => console.error("Gagal track typing:", err));
                    }
                }
            });
            supabaseChannels.push(typingChannel);
        }

        if (!isTyping) {
            isTyping = true;
            if (typingChannel.state === "SUBSCRIBED") {
                typingChannel.track({
                    user_id: window.currentUser.id,
                    full_name: window.currentUser.profile.full_name,
                    isTyping: true
                }).catch(err => console.error("Gagal track typing:", err));
            }
        }
        clearTimeout(window.typingTimeout);
        window.typingTimeout = setTimeout(() => {
            isTyping = false;
            if (typingChannel.state === "SUBSCRIBED") {
                typingChannel.track({
                    user_id: window.currentUser.id,
                    full_name: window.currentUser.profile.full_name,
                    isTyping: false
                }).catch(err => console.error("Gagal untrack typing:", err));
            }
        }, 2000);

        const cursorPos = chatInput.selectionStart;
        const textBeforeCursor = chatInput.value.substring(0, cursorPos);
        const mentionMatch = textBeforeCursor.match(/@([\w\s]*)$/);
        if (mentionMatch) {
            const query = mentionMatch[1];
            await showMentionSuggestions(query, chatInput, suggestionList);
        } else {
            if (suggestionList) {
                suggestionList.classList.add("hidden");
            }
        }

        chatInput.style.height = "auto";
        chatInput.style.height = `${chatInput.scrollHeight}px`;
    };
    chatInput.addEventListener("input", inputHandler);
    eventListeners.push({ element: chatInput, event: "input", handler: inputHandler });

    if (uploadImageButton && imageInput) {
        const triggerImageInput = () => {
            imageInput.click();
        };
        uploadImageButton.addEventListener("click", triggerImageInput);
        eventListeners.push({ element: uploadImageButton, event: "click", handler: triggerImageInput });

        const handleImageUpload = async (event) => {
            const file = event.target.files[0];
            if (!file) return;

            const userId = window.currentUser.id;
            const now = Date.now();
            if (lastMediaTime[userId] && (now - lastMediaTime[userId] < MEDIA_COOLDOWN)) {
                const remaining = Math.ceil((MEDIA_COOLDOWN - (now - lastMediaTime[userId])) / 1000 / 60);
                showToast("Peringatan", `Tunggu ${remaining} menit lagi untuk mengirim gambar!`, "destructive");
                return;
            }

            showToast("Info", "Mengunggah gambar...", "default");

            try {
                const filePath = `chat_images/${Date.now()}_${file.name}`;
                const { error } = await supabase.storage
                    .from("chat-media")
                    .upload(filePath, file);

                if (error) throw error;

                const { data } = supabase.storage
                    .from("chat-media")
                    .getPublicUrl(filePath);

                const img = new Image();
                img.crossOrigin = "anonymous";
                img.src = data.publicUrl;
                await new Promise(resolve => img.onload = resolve);
                const canvas = document.createElement("canvas");
                const ctx = canvas.getContext("2d");
                const maxWidth = 200;
                let width = img.width;
                let height = img.height;
                if (width > maxWidth) {
                    height *= maxWidth / width;
                    width = maxWidth;
                }
                canvas.width = width;
                canvas.height = height;
                ctx.drawImage(img, 0, 0, width, height);
                const resizedUrl = canvas.toDataURL("image/jpeg");
                await sendMessage("🖼️", resizedUrl);
                showToast("Sukses", "Gambar terkirim", "default");
            } catch (error) {
                console.error("Gagal mengunggah gambar:", error);
                showToast("Error", "Gagal mengunggah gambar: " + error.message, "destructive");
            } finally {
                event.target.value = "";
            }
        };
        imageInput.addEventListener("change", handleImageUpload);
        eventListeners.push({ element: imageInput, event: "change", handler: handleImageUpload });
    }

    if (recordVoiceBtn) {
        const handleVoiceRecord = async () => {
            const userId = window.currentUser.id;
            const now = Date.now();
            if (lastMediaTime[userId] && (now - lastMediaTime[userId] < MEDIA_COOLDOWN)) {
                const remaining = Math.ceil((MEDIA_COOLDOWN - (now - lastMediaTime[userId])) / 1000 / 60);
                showToast("Peringatan", `Tunggu ${remaining} menit lagi untuk mengirim voice!`, "destructive");
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                const mediaRecorder = new MediaRecorder(stream);
                let audioChunks = [];

                mediaRecorder.ondataavailable = (e) => {
                    audioChunks.push(e.data);
                };

                mediaRecorder.onstop = async () => {
                    const blob = new Blob(audioChunks, { type: "audio/webm" });
                    const fileName = `voice_notes/${Date.now()}.webm`;

                    try {
                        const { error } = await supabase.storage
                            .from("chat-media")
                            .upload(fileName, blob, { contentType: "audio/webm" });

                        if (error) throw error;

                        const { data } = supabase.storage
                            .from("chat-media")
                            .getPublicUrl(fileName);

                        await sendMessage("🔊", null, data.publicUrl);
                        showToast("Sukses", "Voice note terkirim", "default");
                    } catch (error) {
                        console.error("Gagal mengunggah voice note:", error);
                        showToast("Error", "Gagal mengunggah suara: " + error.message, "destructive");
                    } finally {
                        stream.getTracks().forEach(track => track.stop());
                    }
                };

                mediaRecorder.start();
                showToast("Info", "Rekam suara dimulai...", "default");

                setTimeout(() => {
                    mediaRecorder.stop();
                }, 5000);

            } catch (err) {
                console.error("Gagal merekam suara:", err);
                showToast("Error", "Gagal merekam suara: " + err.message, "destructive");
            }
        };
        recordVoiceBtn.addEventListener("click", handleVoiceRecord);
        eventListeners.push({ element: recordVoiceBtn, event: "click", handler: handleVoiceRecord });
    }

    if (emojiPickerBtn) {
        const emojis = ["😊", "😂", "👍", "❤️", "🔥", "👀", "🙌", "💡"];
        const picker = document.createElement("div");
        picker.className = "absolute bottom-12 left-0 bg-slate-808/90 border border-slate-700/30 rounded-lg p-2 shadow-lg z-10 hidden flex-wrap gap-2";
        emojis.forEach(emoji => {
            const btn = document.createElement("button");
            btn.className = "text-lg hover:bg-slate-700/50 rounded p-1";
            btn.textContent = emoji;
            btn.addEventListener("click", () => {
                chatInput.value += emoji;
                picker.classList.add("hidden");
                chatInput.focus();
            });
            picker.appendChild(btn);
        });

        emojiPickerBtn.parentElement.appendChild(picker);

        emojiPickerBtn.addEventListener("click", () => {
            picker.classList.toggle("hidden");
        });
        eventListeners.push({ element: emojiPickerBtn, event: "click", handler: () => picker.classList.toggle("hidden") });
    }

    if (voiceCallBtn) {
        voiceCallBtn.addEventListener("click", () => {
            showToast("Info", "Fitur panggilan suara belum tersedia", "default");
        });
        eventListeners.push({ element: voiceCallBtn, event: "click", handler: () => showToast("") });
    }

    if (videoCallBtn) {
        videoCallBtn.addEventListener("click", () => {
            showToast("Info", "Fitur panggilan video belum tersedia", "default");
        });
        eventListeners.push({ element: videoCallBtn, event: "click", handler: () => showToast("") });
    }

    if (refreshChatBtn) {
        refreshChatBtn.addEventListener("click", async () => {
            refreshChatBtn.disabled = true;
            refreshChatBtn.querySelector("i").classList.add("animate-spin");
            await initializeChat();
            refreshChatBtn.disabled = false;
            refreshChatBtn.querySelector("i").classList.remove("animate-spin");
        });
        eventListeners.push({ element: refreshChatBtn, event: "click", handler: async () => {
            refreshChatBtn.disabled = true;
            refreshChatBtn.querySelector("i").classList.add("animate-spin");
            await initializeChat();
            refreshChatBtn.disabled = false;
            refreshChatBtn.querySelector("i").classList.remove("animate-spin");
        } });
    }

    // Expand Users
    if (expandUsersBtn) {
        expandUsersBtn.addEventListener("click", () => {
            const onlineUsersList = document.getElementById("onlineUsersList");
            onlineUsersList.classList.toggle("hidden");
            const icon = expandUsersBtn.querySelector("i");
            icon.classList.toggle("rotate-180");
        });
        eventListeners.push({ element: expandUsersBtn, event: "click", handler: () => {
            const onlineUsersList = document.getElementById("onlineUsersList");
            onlineUsersList.classList.toggle("hidden");
            const icon = expandUsersBtn.querySelector("i");
            icon.classList.toggle("rotate-180");
        } });
    }
}

// Inisialisasi chat
async function initializeChat() {
    if (isChatInitialized) {
        console.log("Chat sudah diinisialisasi, melewati...");
        return;
    }

    if (!window.currentUser) {
        console.log("Tidak ada pengguna, menonaktifkan chat...");
        disableChat();
        return;
    }

    if (!isValidUuid(window.currentUser.id)) {
        console.error(`ID pengguna tidak valid: ${window.currentUser.id}`);
        showToast("Error", "ID pengguna tidak valid", "destructive");
        disableChat();
        return;
    }

    console.log("Menginisialisasi chat...");
    isChatInitialized = true;

    try {
        const chatInput = document.getElementById("chatInput");
        const sendMessageBtn = document.getElementById("sendMessageBtn");
        const chatMessages = document.getElementById("chatMessages");
        const adminMessages = document.getElementById("adminMessages");

        if (!chatInput || !sendMessageBtn || !chatMessages || !adminMessages) {
            console.error("Elemen DOM tidak ditemukan");
            showToast("Error", "Elemen DOM tidak ditemukan", "destructive");
            return;
        }

        const profile = await fetchUserProfile(window.currentUser.id);
        window.currentUser.profile = profile;

        chatInput.disabled = false;
        sendMessageBtn.disabled = false;
        chatInput.placeholder = "Type your message...";

        const { data: adminData, error: adminError } = await supabase
            .from("admin_messages")
            .select("*")
            .order("created_at", { ascending: true })
            .limit(10);
        if (adminError) throw adminError;

        adminMessagesList = adminData || [];
        adminMessages.innerHTML = "";
        for (const msg of adminMessagesList) {
            await appendAdminMessage(msg);
        }

        const cached = JSON.parse(localStorage.getItem("chatMessages") || "[]");
        messagesList = cached;

        for (const msg of messagesList) {
            await appendMessage(msg);
        }

        const { data, error } = await supabase
            .from("messages")
            .select("*, profiles(full_name, avatar_url)")
            .order("created_at", { ascending: true })
            .limit(50);
        if (error) throw error;

        messagesList = data || [];
        localStorage.setItem("chatMessages", JSON.stringify(messagesList));
        chatMessages.innerHTML = "";
        for (const msg of messagesList) {
            await appendMessage(msg);
        }

        const adminChannel = supabase
            .channel("realtime-admin-messages")
            .on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "admin_messages",
                },
                async (payload) => {
                    const msg = payload.new;
                    if (adminMessagesList.some(existingMsg => existingMsg.id === msg.id)) return;

                    adminMessagesList.push(msg);
                    await appendAdminMessage(msg);
                    showToast("Info", "Pesan admin baru", "default");
                }
            )
            .subscribe();
        supabaseChannels.push(adminChannel);

        const messagesChannel = supabase
            .channel("realtime-messages")
            .on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "messages",
                },
                async (payload) => {
                    const msg = payload.new;

                    if (messagesList.some(existingMsg => existingMsg.id === msg.id)) return;

                    const profile = await fetchUserProfile(msg.user_id);
                    msg.full_name = profile.full_name;
                    msg.avatar_url = profile.avatar_url;

                    messagesList.push(msg);
                    localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                    await appendMessage(msg);

                    if (Array.isArray(msg.mentions) && msg.mentions.includes(window.currentUser?.id)) {
                        showToast("Info", `${msg.full_name} menyebut Anda!`, "default");
                    }
                }
            )
            .on(
                "postgres_changes",
                {
                    event: "UPDATE",
                    schema: "public",
                    table: "messages",
                },
                async (payload) => {
                    const updatedMsg = payload.new;
                    const index = messagesList.findIndex(msg => msg.id === updatedMsg.id);
                    if (index !== -1) {
                        const profile = await fetchUserProfile(updatedMsg.user_id);
                        updatedMsg.full_name = profile.full_name;
                        updatedMsg.avatar_url = profile.avatar_url;
                        messagesList[index] = { ...messagesList[index], ...updatedMsg };
                        localStorage.setItem("chatMessages", JSON.stringify(messagesList.slice(-100)));
                        await appendMessage(messagesList[index], true);
                    }
                }
            )
            .subscribe();
        supabaseChannels.push(messagesChannel);

        const presenceChannel = supabase
            .channel("presence")
            .on("presence", { event: "sync" }, async () => {
                const state = presenceChannel.presenceState();

                const users = Object.values(state).flat();

                const filteredUsers = users.filter(p => {
                    if (!window.currentUser || !window.currentUser.id) {
                        console.warn("window.currentUser atau window.currentUser.id tidak tersedia");
                        return true;
                    }
                    return p.user_id !== window.currentUser.id;
                });

                const typingUsers = filteredUsers.filter(user => user.isTyping);
                const typingIndicator = document.getElementById("typingIndicator");
                if (typingIndicator) {
                    if (typingUsers.length > 0) {
                        typingIndicator.classList.remove("hidden");
                        typingIndicator.querySelector("span").textContent = `${typingUsers[0].full_name} is typing...`;
                    } else {
                        typingIndicator.classList.add("hidden");
                    }
                }

                onlineUsers = filteredUsers.map(user => ({
                    user_id: user.user_id,
                    full_name: user.full_name,
                    avatar_url: user.avatar_url,
                    isTyping: user.isTyping,
                }));
                updateOnlineUsers(onlineUsers);

                const participantCount = document.querySelector("#pageCommunications .text-xs.text-slate-400 span");
                if (participantCount) {
                    const totalUsers = users.length;
                    participantCount.textContent = `${totalUsers} active participants`;
                }
            })
            .subscribe((status) => {
                if (status === "SUBSCRIBED") {
                    if (!window.currentUser || !window.currentUser.id || !window.currentUser.profile) {
                        console.warn("window.currentUser tidak lengkap:", window.currentUser);
                        return;
                    }
                    presenceChannel.track({
                        user_id: window.currentUser.id,
                        full_name: window.currentUser.profile.full_name,
                        avatar_url: window.currentUser.profile.avatar_url,
                        isTyping: false,
                    }).catch(err => {
                        console.error("Gagal track pengguna:", err);
                    });
                } else if (status === "CLOSED" || status === "TIMED_OUT") {
                    console.warn("Subscription presence gagal, mencoba ulang...");
                    setTimeout(() => presenceChannel.subscribe(), 2000);
                }
            });
        supabaseChannels.push(presenceChannel);

        updateConnectionLatency();
        latencyInterval = setInterval(updateConnectionLatency, 10000);

        bindEventListeners();

    } catch (err) {
        console.error("Inisialisasi chat gagal:", err);
        showToast("Error", "Gagal inisialisasi chat: " + err.message, "destructive");
        disableChat();
        isChatInitialized = false;
    }
}

// Fungsi nonaktifkan chat
function disableChat() {
    const chatInput = document.getElementById("chatInput");
    const sendMessageBtn = document.getElementById("sendMessageBtn");
    const chatMessages = document.getElementById("chatMessages");

    if (chatInput) {
        chatInput.disabled = true;
        chatInput.placeholder = "Login untuk chat...";
    }

    if (sendMessageBtn) {
        sendMessageBtn.disabled = true;
        sendMessageBtn.classList.add("opacity-50", "cursor-not-allowed");
    }

    if (chatMessages) {
        chatMessages.innerHTML = `
            <div class="text-center text-slate-400 py-4">Silakan login untuk mengakses chat</div>
        `;
    }
}

// Fungsi tampilkan toast
function showToast(title, message, type = "default") {
    const toastContainer = document.getElementById("toastContainer");
    if (!toastContainer) return;

    const toast = document.createElement("div");
    toast.className = `
        pointer-events-auto px-4 py-2 rounded-lg shadow-lg transform transition-transform duration-300 ease-in-out translate-y-0 opacity-100
        ${type === "default" ? "bg-slate-800 text-white" : ""}
        ${type === "success" ? "bg-green-600 text-white" : ""}
        ${type === "error" || type === "destructive" ? "bg-red-600 text-white" : ""}
    `;
    toast.innerHTML = `<strong>${title}</strong><br /><small>${message}</small>`;
    toastContainer.appendChild(toast);

    setTimeout(() => {
        toast.classList.remove("translate-y-0", "opacity-100");
        toast.classList.add("translate-y-20", "opacity-0");
        setTimeout(() => toast.remove(), 500);
    }, 3000);
}

// Event listener untuk navigasi halaman
function handlePageNavigation() {
    const navCommunications = document.getElementById("navCommunications");
    if (navCommunications) {
        navCommunications.addEventListener("click", () => {
            console.log("Navigasi ke halaman Communications, menginisialisasi chat...");
            cleanupChat();
            setTimeout(initializeChat, 100);
        });
    }
}

// Event listener DOM loaded
document.addEventListener("DOMContentLoaded", () => {
    console.log("DOM loaded, memulai inisialisasi...");
    lucide.createIcons();
    handlePageNavigation();
    initializeChat();
});




// Initialize Settings Page
async function initSettings() {
  await checkUser();
  setupEventListeners();
  await loadSettings();
}

// Setup Event Listeners
function setupEventListeners() {
  const changeProfilePictureBtn = document.getElementById("changeProfilePictureBtn");
  const profilePictureInput = document.getElementById("profilePictureInput");
  const removeProfilePictureBtn = document.getElementById("removeProfilePictureBtn");
  const saveProfileBtn = document.getElementById("saveProfileBtn");
  const changePasswordBtn = document.getElementById("changePasswordBtn");
  const deleteAccountBtn = document.getElementById("deleteAccountBtn");
  const cancelDeleteBtn = document.getElementById("cancelDeleteBtn");
  const confirmDeleteBtn = document.getElementById("confirmDeleteBtn");
  const copyReferralBtn = document.getElementById("copyReferralBtn");

  if (!changeProfilePictureBtn || !profilePictureInput || !removeProfilePictureBtn ||
      !saveProfileBtn || !changePasswordBtn || !deleteAccountBtn || !cancelDeleteBtn ||
      !confirmDeleteBtn || !copyReferralBtn) {
    console.error("One or more elements not found in settings page");
    showToast("Error", "Some required elements are missing", "destructive");
    return;
  }

  // Profile Picture Events
  changeProfilePictureBtn.addEventListener("click", () => profilePictureInput.click());
  profilePictureInput.addEventListener("change", handleProfilePictureUpload);
  removeProfilePictureBtn.addEventListener("click", removeProfilePicture);

  // Save Profile
  saveProfileBtn.addEventListener("click", saveProfile);

  // Password Visibility Toggle
  document.querySelectorAll(".password-toggle").forEach((icon, index) => {
    const inputs = [
      document.getElementById("currentPasswordInput"),
      document.getElementById("newPasswordInput"),
      document.getElementById("confirmNewPasswordInput")
    ];
    if (!inputs[index]) return;
    icon.addEventListener("click", () => togglePasswordVisibility(inputs[index], icon));
  });

  // Change Password
  changePasswordBtn.addEventListener("click", changePassword);

  // Delete Account Modal
  deleteAccountBtn.addEventListener("click", () => {
    const modal = document.getElementById("deleteAccountModal");
    if (modal) modal.classList.remove("hidden");
  });
  cancelDeleteBtn.addEventListener("click", () => {
    const modal = document.getElementById("deleteAccountModal");
    if (modal) modal.classList.add("hidden");
  });
  confirmDeleteBtn.addEventListener("click", deleteAccount);

  // Copy Referral Code
  copyReferralBtn.addEventListener("click", () => {
    const referralCodeInput = document.getElementById("referralCodeInput");
    if (!referralCodeInput) return;
    navigator.clipboard.writeText(referralCodeInput.value)
      .then(() => showToast("Sukses", "Kode referral disalin!"))
      .catch(err => {
        console.error("Gagal menyalin:", err);
        showToast("Error", "Gagal menyalin kode referral", "destructive");
      });
  });

  // Connect Wallet Button
  const connectWalletBtn = document.getElementById("connectWalletBtn");
  if (connectWalletBtn) {
    connectWalletBtn.addEventListener("click", connectWallet);
  }
}

// Load User Settings Data
async function loadSettings() {
  if (!user) return;

  try {
    showLoading();

    // Get Elements
    const fullNameInput = document.getElementById("settingsFullNameInput");
    const walletAddressInput = document.getElementById("walletAddressInput");
    const emailDisplay = document.getElementById("emailDisplay");
    const profilePicturePreview = document.getElementById("profilePicturePreview");
    const sidebarProfilePicture = document.getElementById("sidebarProfilePicture");
    const referralCodeInput = document.getElementById("referralCodeInput");
    const invitedUsersCount = document.getElementById("invitedUsersCount");

    if (!fullNameInput || !walletAddressInput || !emailDisplay || !profilePicturePreview || !referralCodeInput || !invitedUsersCount) {
      throw new Error("Some input fields are missing from the DOM");
    }

    // Fetch fresh auth data
    const { data: authData, error: authError } = await supabase.auth.getUser();
    if (authError) throw authError;
    user = authData.user;

    // Fetch profile data
    const { data, error } = await supabase
      .from("profiles")
      .select("full_name, wallet_address, avatar_url, email, referral_code")
      .eq("id", user.id)
      .single();

    if (error) throw error;

    // Update Inputs
    fullNameInput.value = data.full_name || "";
    walletAddressInput.value = data.wallet_address || "";
    emailDisplay.value = data.email || user.email;
    referralCodeInput.value = data.referral_code || "Tidak tersedia";

    // Count Invited Users
    const { count, error: countError } = await supabase
      .from("profiles")
      .select("id", { count: "exact" })
      .eq("referred_by", data.referral_code);

    if (countError) throw countError;
    invitedUsersCount.textContent = count || 0;

    // Update Avatar
    updateProfilePicture(data.avatar_url, data.full_name || user.email);

    // Update Wallet Display (if exists)
    const userWallet = document.getElementById("userWallet");
    if (userWallet) userWallet.textContent = data.wallet_address || "Belum ditentukan";

  } catch (err) {
    console.error("Error loading settings:", err);
    showToast("Error", "Gagal memuat profil", "destructive");
  } finally {
    hideLoading();
  }
}

// Update Profile Picture Preview
function updateProfilePicture(avatarUrl, nameOrEmail) {
  const initial = (nameOrEmail || "U")[0].toUpperCase();
  const preview = document.getElementById("profilePicturePreview");
  const sidebar = document.getElementById("sidebarProfilePicture");

  if (!preview || !sidebar) return;

  if (avatarUrl) {
    const { data } = supabase.storage.from("avatars").getPublicUrl(avatarUrl);
    preview.innerHTML = `<img src="${data.publicUrl}" class="h-28 w-28 rounded-full object-cover" alt="Profile" />`;
    sidebar.innerHTML = `<img src="${data.publicUrl}" class="h-12 w-12 rounded-full object-cover" alt="Profile" />`;
  } else {
    preview.innerHTML = `
      <div class="h-28 w-28 rounded-full bg-gradient-to-br from-cyan-600 to-slate-800 text-white flex items-center justify-center text-3xl font-bold shadow-lg">
        ${initial}
      </div>`;
    sidebar.innerHTML = `
      <div class="h-12 w-12 rounded-full bg-gradient-to-br from-cyan-600 to-slate-800 text-white flex items-center justify-center text-xl font-bold">
        ${initial}
      </div>`;
  }
}

// Handle Upload Profile Picture
async function handleProfilePictureUpload(e) {
  if (!user) return showToast("Error", "Silakan login terlebih dahulu", "destructive");

  const file = e.target.files[0];
  if (!file) return;

  if (file.size > 15 * 1024 * 1024) {
    showToast("Error", "Ukuran file maksimal 15MB", "destructive");
    return;
  }
  if (!["image/png", "image/jpeg"].includes(file.type)) {
    showToast("Error", "Format file harus PNG atau JPEG", "destructive");
    return;
  }

  try {
    showLoading();

    const fileName = `${user.email.replace(/[@.]/g, "_")}/AQULA_${Math.floor(Math.random() * 90000 + 10000)}.${file.name.split(".").pop()}`;
    const { error: uploadError } = await supabase
      .storage
      .from("avatars")
      .upload(fileName, file, { upsert: true });

    if (uploadError) throw uploadError;

    const { error: updateError } = await supabase
      .from("profiles")
      .update({ avatar_url: fileName })
      .eq("id", user.id);

    if (updateError) throw updateError;

    await updateAvatarAcrossApp(fileName);
    showToast("Sukses", "Foto profil berhasil diubah");
  } catch (err) {
    console.error("Error uploading avatar:", err);
    showToast("Error", "Gagal mengunggah foto profil", "destructive");
  } finally {
    hideLoading();
    profilePictureInput.value = "";
  }
}

// Update Avatar Across Application
async function updateAvatarAcrossApp(avatarUrl) {
  const preview = document.getElementById("profilePicturePreview");
  const sidebar = document.getElementById("sidebarProfilePicture");

  if (!preview || !sidebar) return;

  const { data } = supabase.storage.from("avatars").getPublicUrl(avatarUrl);
  preview.innerHTML = `<img src="${data.publicUrl}" class="h-28 w-28 rounded-full object-cover" alt="Profile" />`;
  sidebar.innerHTML = `<img src="${data.publicUrl}" class="h-12 w-12 rounded-full object-cover" alt="Profile" />`;

  try {
    await supabase
      .from("messages")
      .update({ avatar_url: avatarUrl })
      .eq("user_id", user.id);

    const cached = JSON.parse(localStorage.getItem("chatMessages") || "[]");
    const updated = cached.map(msg => msg.user_id === user.id ? { ...msg, avatar_url: avatarUrl } : msg);
    localStorage.setItem("chatMessages", JSON.stringify(updated));

    if (typeof messagesList !== "undefined" && typeof renderMessages === "function") {
      messagesList = messagesList.map(msg => msg.user_id === user.id ? { ...msg, avatar_url: avatarUrl } : msg);
      await renderMessages();
    }
  } catch (err) {
    console.error("Error updating avatar in messages:", err);
  }
}

// Remove Profile Picture
async function removeProfilePicture() {
  if (!user) return showToast("Error", "Silakan login", "destructive");

  try {
    showLoading();

    const { error } = await supabase
      .from("profiles")
      .update({ avatar_url: null })
      .eq("id", user.id);

    if (error) throw error;

    const fullNameInput = document.getElementById("settingsFullNameInput");
    const name = fullNameInput?.value || user.email;
    updateProfilePicture(null, name);

    await supabase
      .from("messages")
      .update({ avatar_url: null })
      .eq("user_id", user.id);

    const cached = JSON.parse(localStorage.getItem("chatMessages") || "[]");
    const updated = cached.map(msg => msg.user_id === user.id ? { ...msg, avatar_url: null } : msg);
    localStorage.setItem("chatMessages", JSON.stringify(updated));

    showToast("Sukses", "Foto profil dihapus");
  } catch (err) {
    console.error("Error removing avatar:", err);
    showToast("Error", "Gagal menghapus foto profil", "destructive");
  } finally {
    hideLoading();
  }
}

// Save Profile Changes
async function saveProfile() {
  if (!user) return showToast("Error", "Silakan login", "destructive");

  try {
    showLoading();

    const fullNameInput = document.getElementById("settingsFullNameInput");
    const walletAddressInput = document.getElementById("walletAddressInput");

    if (!fullNameInput || !walletAddressInput) {
      throw new Error("Input tidak ditemukan");
    }

    const fullName = fullNameInput.value.trim();
    const walletAddress = walletAddressInput.value.trim();

    if (!fullName) throw new Error("Nama lengkap tidak boleh kosong");
    if (walletAddress && !/^0x[a-fA-F0-9]{40}$/.test(walletAddress)) {
      throw new Error("Alamat dompet tidak valid");
    }

    const { data: currentProfile, error: fetchError } = await supabase
      .from("profiles")
      .select("full_name, wallet_address, avatar_url")
      .eq("id", user.id)
      .single();

    if (fetchError) throw fetchError;

    const hasNameChange = fullName !== currentProfile.full_name;
    const hasWalletChange = walletAddress !== currentProfile.wallet_address;

    if (!hasNameChange && !hasWalletChange) {
      showToast("Info", "Tidak ada perubahan yang ditemukan");
      return;
    }

    const updates = {};
    if (hasNameChange) updates.full_name = fullName;
    if (hasWalletChange) updates.wallet_address = walletAddress || null;

    const { error: updateError } = await supabase
      .from("profiles")
      .update(updates)
      .eq("id", user.id);

    if (updateError) throw updateError;

    if (hasNameChange) {
      await updateNameAcrossApp(fullName);
      if (!currentProfile.avatar_url) {
        updateProfilePicture(null, fullName);
      }
    }

    const userWallet = document.getElementById("userWallet");
    if (userWallet && hasWalletChange) {
      userWallet.textContent = walletAddress || "Belum ditentukan";
    }

    showToast("Sukses", "Profil berhasil diperbarui");
    await loadSettings();
  } catch (err) {
    console.error("Error saving profile:", err);
    showToast("Error", err.message, "destructive");
  } finally {
    hideLoading();
  }
}

// Update Name Across App
async function updateNameAcrossApp(fullName) {
  try {
    await supabase
      .from("messages")
      .update({ full_name: fullName })
      .eq("user_id", user.id);

    const cached = JSON.parse(localStorage.getItem("chatMessages") || "[]");
    const updated = cached.map(msg => msg.user_id === user.id ? { ...msg, full_name: fullName } : msg);
    localStorage.setItem("chatMessages", JSON.stringify(updated));

    if (typeof messagesList !== "undefined" && typeof renderMessages === "function") {
      messagesList = messagesList.map(msg => msg.user_id === user.id ? { ...msg, full_name: fullName } : msg);
      await renderMessages();
    }
  } catch (err) {
    console.error("Error saat memperbarui nama di seluruh aplikasi:", err);
  }
}

// Change Password
async function changePassword() {
  if (!user) return showToast("Error", "Silakan login", "destructive");

  try {
    showLoading();

    const currentInput = document.getElementById("currentPasswordInput");
    const newInput = document.getElementById("newPasswordInput");
    const confirmInput = document.getElementById("confirmNewPasswordInput");

    const currentPass = currentInput.value;
    const newPass = newInput.value;
    const confirmPass = confirmInput.value;

    if (!currentPass || !newPass || !confirmPass) {
      throw new Error("Semua kolom harus diisi");
    }
    if (newPass !== confirmPass) {
      throw new Error("Konfirmasi kata sandi tidak cocok");
    }
    if (newPass.length < 6) {
      throw new Error("Kata sandi minimal 6 karakter");
    }

    const { error: signInError } = await supabase.auth.signInWithPassword({
      email: user.email,
      password: currentPass
    });
    if (signInError) throw signInError;

    const { error: updateError } = await supabase.auth.updateUser({ password: newPass });
    if (updateError) throw updateError;

    currentInput.value = "";
    newInput.value = "";
    confirmInput.value = "";

    showToast("Sukses", "Kata sandi berhasil diubah");
  } catch (err) {
    console.error("Error changing password:", err);
    showToast("Error", err.message, "destructive");
  } finally {
    hideLoading();
  }
}

// Delete Account
async function deleteAccount() {
  if (!user) return showToast("Error", "Silakan login", "destructive");

  try {
    showLoading();

    const { error: profileError } = await supabase
      .from("profiles")
      .delete()
      .eq("id", user.id);

    if (profileError) throw profileError;

    const { error: authError } = await supabase.auth.admin.deleteUser(user.id);
    if (authError) throw authError;

    await supabase.auth.signOut();
    localStorage.removeItem("mining_points");
    window.currentUser = null;
    user = null;

    const modal = document.getElementById("deleteAccountModal");
    if (modal) modal.classList.add("hidden");

    showToast("Sukses", "Akun berhasil dihapus");
    setTimeout(() => location.href = "/", 1500);
  } catch (err) {
    console.error("Error deleting account:", err);
    showToast("Error", err.message, "destructive");
  } finally {
    hideLoading();
  }
}

// 🔥 TAMBAHAN: Fungsi Connect Wallet
async function connectWallet() {
  if (!window.ethereum) {
    showToast("Error", "MetaMask tidak terdeteksi", "destructive");
    return;
  }

  try {
    showLoading();

    // Buka pop-up MetaMask
    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    const walletAddress = accounts[0];

    const walletInput = document.getElementById("walletAddressInput");
    if (!walletInput) throw new Error("Input alamat dompet tidak ditemukan");

    walletInput.value = walletAddress;

    if (user && user.id) {
      const { error } = await supabase
        .from("profiles")
        .update({ wallet_address: walletAddress })
        .eq("id", user.id);

      if (error) throw error;

      showToast("Sukses", "Dompet berhasil terhubung dan tersimpan");

      const userWallet = document.getElementById("userWallet");
      if (userWallet) {
        userWallet.textContent = walletAddress;
      }
    }

  } catch (err) {
    console.error("Gagal menghubungkan dompet:", err);
    if (err.code === 4001) {
      showToast("Info", "Pengguna menolak koneksi dompet");
    } else {
      showToast("Error", "Gagal menghubungkan dompet", "destructive");
    }
  } finally {
    hideLoading();
  }
}

// Helper Functions
function showLoading() {
  const overlay = document.getElementById("");
  if (overlay) overlay.classList.remove("hidden");
}
function hideLoading() {
  const overlay = document.getElementById("");
  if (overlay) overlay.classList.add("hidden");
}
function togglePasswordVisibility(input, icon) {
  if (!input || !icon) return;
  const isPassword = input.type === "password";
  input.type = isPassword ? "text" : "password";
  icon.innerHTML = isPassword
    ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875..."/>`
    : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12..."/>`;
}

// Init App
async function init() {
  await checkUser();
  await initSettings();
  supabase.auth.onAuthStateChange((event) => {
    if (event === 'SIGNED_IN' || event === 'USER_UPDATED') {
      loadSettings();
    }
  });
}

document.addEventListener("DOMContentLoaded", () => {
  init();
});





  document.addEventListener('DOMContentLoaded', () => {
    // Initialize Three.js scene
    const container = document.getElementById('particleContainer');
    const width = container.clientWidth;
    const height = container.clientHeight;
    
    // Create scene with subtle fog
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0f172a);
    scene.fog = new THREE.FogExp2(0x0f172a, 0.005);
    
    // Create camera with optimal view
    const camera = new THREE.PerspectiveCamera(60, width / height, 0.1, 1000);
    camera.position.set(0, 0, 50);
    
    // Create high-quality renderer
    const renderer = new THREE.WebGLRenderer({ 
      antialias: true,
      powerPreference: "high-performance"
    });
    renderer.setSize(width, height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);
    
    // Lighting setup for clarity
    const ambientLight = new THREE.AmbientLight(0x404040, 0.5);
    scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0x7dd3fc, 0.8);
    directionalLight.position.set(1, 1, 1);
    scene.add(directionalLight);
    
    // Create particle system
    const particleCount = 2500;
    const geometry = new THREE.BufferGeometry();
    const positions = new Float32Array(particleCount * 3);
    const colors = new Float32Array(particleCount * 3);
    const sizes = new Float32Array(particleCount);
    
    // Color palette (blue gradient)
    const colorPalette = [
      new THREE.Color(0x7dd3fc),
      new THREE.Color(0x38bdf8), 
      new THREE.Color(0x0ea5e9),
      new THREE.Color(0x0284c7)
    ];
    
    // Define clear letter paths for A-Q-U-L-A
    const letterPaths = {
      'A': [
        [-8,-10,0], [-4,10,0], [0,-10,0], [4,10,0], [8,-10,0], // Outer shape
        [-6,0,0], [6,0,0] // Crossbar (less prominent)
      ],
      'Q': [
        [0,10,0], [6,8,0], [8,4,0], [8,-4,0], [6,-8,0], // Main circle
        [0,-10,0], [-6,-8,0], [-8,-4,0], [-8,4,0], [-6,8,0],
        [4,-6,0], [8,-10,0] // Tail
      ],
      'U': [
        [-8,10,0], [-8,-4,0], [-6,-8,0], [-2,-10,0], // Left curve
        [2,-10,0], [6,-8,0], [8,-4,0], [8,10,0]  // Right curve
      ],
      'L': [
        [-8,10,0], [-8,-10,0], [8,-10,0] // Simple L shape
      ],
      'A2': [
        [-8,-10,0], [-4,10,0], [0,-10,0], [4,10,0], [8,-10,0], // Outer shape
        [-6,0,0], [6,0,0] // Crossbar (less prominent)
      ]
    };
    
    // Position letters with good spacing
    const letterPositions = {
      'A': -44,
      'Q': -22,
      'U': 0,
      'L': 22,
      'A2': 44
    };
    
    // Create particles along letter paths (ensuring readability)
    let pIndex = 0;
    const particlesPerLetter = particleCount / 5;
    const particleDensity = 3; // Higher density for clearer letters
    
    for (const [letter, path] of Object.entries(letterPaths)) {
      for (let i = 0; i < particlesPerLetter && pIndex < particleCount; i++) {
        // Distribute particles evenly along path
        const segment = i % (path.length - 1);
        const progress = (i % particleDensity) / particleDensity;
        
        const start = path[segment];
        const end = path[segment + 1] || path[0];
        
        // Position with slight randomness but constrained to maintain shape
        positions[pIndex * 3] = THREE.MathUtils.lerp(
          start[0] + letterPositions[letter],
          end[0] + letterPositions[letter],
          progress
        ) + (Math.random() - 0.5) * 1.5;
        
        positions[pIndex * 3 + 1] = THREE.MathUtils.lerp(
          start[1],
          end[1],
          progress
        ) + (Math.random() - 0.5) * 1.5;
        
        positions[pIndex * 3 + 2] = THREE.MathUtils.lerp(
          start[2],
          end[2],
          progress
        ) + (Math.random() - 0.5) * 8;
        
        // Color based on letter position
        const colorIndex = Math.floor(pIndex / (particleCount / colorPalette.length)) % colorPalette.length;
        colors[pIndex * 3] = colorPalette[colorIndex].r;
        colors[pIndex * 3 + 1] = colorPalette[colorIndex].g; 
        colors[pIndex * 3 + 2] = colorPalette[colorIndex].b;
        
        // Slightly larger particles for better visibility
        sizes[pIndex] = Math.random() * 0.6 + 0.8;
        
        pIndex++;
      }
    }
    
    // Set geometry attributes
    geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geometry.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    geometry.setAttribute('size', new THREE.BufferAttribute(sizes, 1));
    
    // Create particle material with clear visibility
    const material = new THREE.PointsMaterial({
      size: 1.2,
      vertexColors: true,
      transparent: true,
      opacity: 0.95,
      blending: THREE.AdditiveBlending,
      sizeAttenuation: true,
      alphaTest: 0.1
    });
    
    const particles = new THREE.Points(geometry, material);
    scene.add(particles);
    
    // Animation variables
    let time = 0;
    const rotationSpeed = 0.15;
    
    // Animation loop with constrained movement
    function animate() {
      requestAnimationFrame(animate);
      time += 0.01;
      
      // Gentle rotation that doesn't obscure letters
      particles.rotation.y = Math.sin(time * rotationSpeed) * 0.15;
      particles.rotation.x = Math.cos(time * rotationSpeed * 0.8) * 0.1;
      
      // Subtle floating movement while maintaining shape
      const positions = geometry.attributes.position.array;
      for (let i = 0; i < positions.length; i += 3) {
        // Only modify Z position for depth movement
        positions[i + 2] += Math.sin(time + i * 0.01) * 0.1;
      }
      geometry.attributes.position.needsUpdate = true;
      
      renderer.render(scene, camera);
    }
    
    // Handle window resize
    function onWindowResize() {
      camera.aspect = container.clientWidth / container.clientHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, container.clientHeight);
    }
    
    window.addEventListener('resize', onWindowResize);
    animate();
  });
</script>
<div id="toastContainer" class="fixed bottom-5 right-5 z-[200] flex flex-col gap-3"></div>


  </body>
</html>
